<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.91.2"><meta name=theme-color content="#16171d"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>39-40.NoSQL数据库入门 | Hanxin</title><link rel=stylesheet href=/css/meme.min.88c90dc75021618344ec926f4ed6ac307f30ba48911294816b16370a41e5f137.css><script src=/js/meme.min.f460a174bb100a60a7e275913695161f1e09aab1378fe99cfd30cde14da70888.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Satisfy&family=Klee+One:wght@400;600&family=Great+Vibes&display=swap" media=print onload="this.media='all'"><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Satisfy&family=Klee+One:wght@400;600&family=Great+Vibes&display=swap"></noscript><meta name=author content="骆昊"><meta name=description content="NoSQL入门 NoSQL概述 如今，大多数的计算机系统（包括服务器、PC、移动设备等）……"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="Hanxin"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="Hanxin"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=/python/39-40.nosql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8/><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","datePublished":"2021-08-23T17:34:44+08:00","dateModified":"2022-01-16T09:24:35+00:00","url":"/python/39-40.nosql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8/","name":"39-40.NoSQL数据库入门","description":"NoSQL入门 NoSQL概述 如今，大多数的计算机系统（包括服务器、PC、移动设备等）……","image":"/icons/apple-touch-icon.png","license":"本文采用[「CC BY-NC-SA 4.0」](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)协议，转载请注明出处。","publisher":{"@type":"Organization","name":"Hanxin","logo":{"@type":"ImageObject","url":"/icons/apple-touch-icon.png"},"url":"/"},"mainEntityOfPage":{"@type":"WebSite","@id":"/"}}</script><meta name=twitter:card content="summary"><meta property="og:title" content="39-40.NoSQL数据库入门"><meta property="og:description" content="NoSQL入门 NoSQL概述 如今，大多数的计算机系统（包括服务器、PC、移动设备等）……"><meta property="og:url" content="/python/39-40.nosql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8/"><meta property="og:site_name" content="Hanxin"><meta property="og:locale" content="zh"><meta property="og:image" content="/icons/apple-touch-icon.png"><meta property="og:type" content="website"></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>Hanxin</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/life/><span class=menu-item-name>生活</span></a></li><li class=menu-item><a href=/tech/><span class=menu-item-name>技术</span></a></li><li class=menu-item><a href=/tags/><span class=menu-item-name>标签</span></a></li><li class=menu-item><a href=/about/><span class=menu-item-name>关于</span></a></li><li class=menu-item><a href=/blogroll/><span class=menu-item-name>友链</span></a></li><li class=menu-item><a href=/python/><span class=menu-item-name>Python-100天</span></a></li><li class=menu-item><a id=theme-switcher href=#><span class="icon theme-icon-light">🌞</span><span class="icon theme-icon-dark">🌙</span></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=python data-toc-num=true><h1 class="post-title p-name">39-40.NoSQL数据库入门</h1><div class=post-meta><time datetime=2021-08-23T17:34:44+08:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2021.8.23</time>
<time datetime=2022-01-16T09:24:35+00:00 class="post-meta-item modified dt-updated"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2022.1.16</time>
<span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;6922</span>
<span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;14&nbsp;分钟</span></div><div class="post-body e-content"><h2 id=nosql入门><a href=#nosql入门 class=anchor-link>#</a>NoSQL入门</h2><h3 id=nosql概述><a href=#nosql概述 class=anchor-link>#</a>NoSQL概述</h3><p>如今，大多数的计算机系统（包括服务器、PC、移动设备等）都会产生庞大的数据量。其实，早在2012年的时候，全世界每天产生的数据量就达到了2.5EB（艾字节，$$1EB\approx10^{18}B$$）。这些数据有很大一部分是由关系型数据库来存储和管理的。 早在1970年，E.F.Codd发表了论述关系型数据库的著名论文“<em>A relational model of data for large shared data banks</em>”，这篇文章奠定了关系型数据库的基础并在接下来的数十年时间内产生了深远的影响。实践证明，关系型数据库是实现数据持久化最为重要的方式，它也是大多数应用在选择持久化方案时的首选技术。</p><p>NoSQL是一项全新的数据库革命性运动，虽然它的历史可以追溯到1998年，但是NoSQL真正深入人心并得到广泛的应用是在进入大数据时候以后，业界普遍认为NoSQL是更适合大数据存储的技术方案，这才使得NoSQL的发展达到了前所未有的高度。2012年《纽约时报》的一篇专栏中写到，大数据时代已经降临，在商业、经济及其他领域中，决策将不再基于经验和直觉而是基于数据和分析而作出。事实上，在天文学、气象学、基因组学、生物学、社会学、互联网搜索引擎、金融、医疗、社交网络、电子商务等诸多领域，由于数据过于密集和庞大，在数据的分析和处理上也遇到了前所未有的限制和阻碍，这一切都使得对大数据处理技术的研究被提升到了新的高度，也使得各种NoSQL的技术方案进入到了公众的视野。</p><p>NoSQL数据库按照其存储类型可以大致分为以下几类：</p><div class=table-container><table><thead><tr><th>类型</th><th>部分代表</th><th>特点</th></tr></thead><tbody><tr><td>列族数据库</td><td>HBase<br>Cassandra<br>Hypertable</td><td>顾名思义是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的I/O优势，适合于批量数据处理和即时查询。</td></tr><tr><td>文档数据库</td><td>MongoDB<br>CouchDB<br>ElasticSearch</td><td>文档数据库一般用类JSON格式存储数据，存储的内容是文档型的。这样也就有机会对某些字段建立索引，实现关系数据库的某些功能，但不提供对参照完整性和分布事务的支持。</td></tr><tr><td>KV数据库</td><td>DynamoDB<br>Redis<br>LevelDB</td><td>可以通过key快速查询到其value，有基于内存和基于磁盘两种实现方案。</td></tr><tr><td>图数据库</td><td>Neo4J<br>FlockDB<br>JanusGraph</td><td>使用图结构进行语义查询的数据库，它使用节点、边和属性来表示和存储数据。图数据库从设计上，就可以简单快速的检索难以在关系系统中建模的复杂层次结构。</td></tr><tr><td>对象数据库</td><td>db4o<br>Versant</td><td>通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td></tr></tbody></table></div><blockquote><p><strong>说明</strong>：想了解更多的NoSQL数据库，可以访问<a href=http://nosql-database.org/ target=_blank rel=noopener>http://nosql-database.org/</a>。</p></blockquote><h3 id=redis概述><a href=#redis概述 class=anchor-link>#</a>Redis概述</h3><p>Redis是一种基于键值对的NoSQL数据库，它提供了对多种数据类型（字符串、哈希、列表、集合、有序集合、位图等）的支持，能够满足很多应用场景的需求。Redis将数据放在内存中，因此读写性能是非常惊人的。与此同时，Redis也提供了持久化机制，能够将内存中的数据保存到硬盘上，在发生意外状况时数据也不会丢掉。此外，Redis还支持键过期、地理信息运算、发布订阅、事务、管道、Lua脚本扩展等功能，总而言之，Redis的功能和性能都非常强大，如果项目中要实现高速缓存和消息队列这样的服务，直接交给Redis就可以了。目前，国内外很多著名的企业和商业项目都使用了Redis，包括：Twitter、Github、StackOverflow、新浪微博、百度、优酷土豆、美团、小米、唯品会等。</p><h4 id=redis简介><a href=#redis简介 class=anchor-link>#</a>Redis简介</h4><p>2008年，一个名为Salvatore Sanfilippo的程序员为他开发的LLOOGG项目定制了专属的数据库（因为之前他无论怎样优化MySQL，系统性能已经无法再提升了），这项工作的成果就是Redis的初始版本。后来他将Redis的代码放到了全球最大的代码托管平台<a href=https://github.com/antirez/redis target=_blank rel=noopener>Github</a>，从那以后，Redis引发了大量开发者的好评和关注，继而有数百人参与了Redis的开发和维护，这使得Redis的功能越来越强大和性能越来越好。</p><p>Redis是REmote DIctionary Server的缩写，它是一个用ANSI C编写的高性能的key-value存储系统，与其他的key-value存储系统相比，Redis有以下一些特点（也是优点）：</p><ul><li>Redis的读写性能极高，并且有丰富的特性（发布/订阅、事务、通知等）。</li><li>Redis支持数据的持久化（RDB和AOF两种方式），可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li><li>Redis支持多种数据类型，包括：string、hash、list、set，zset、bitmap、hyperloglog等。</li><li>Redis支持主从复制（实现读写分析）以及哨兵模式（监控master是否宕机并自动调整配置）。</li><li>Redis支持分布式集群，可以很容易的通过水平扩展来提升系统的整体性能。</li><li>Redis基于TCP提供的可靠传输服务进行通信，很多编程语言都提供了Redis客户端支持。</li></ul><h4 id=redis的应用场景><a href=#redis的应用场景 class=anchor-link>#</a>Redis的应用场景</h4><ol><li>高速缓存 - 将不常变化但又经常被访问的热点数据放到Redis数据库中，可以大大降低关系型数据库的压力，从而提升系统的响应性能。</li><li>排行榜 - 很多网站都有排行榜功能，利用Redis中的列表和有序集合可以非常方便的构造各种排行榜系统。</li><li>商品秒杀/投票点赞 - Redis提供了对计数操作的支持，网站上常见的秒杀、点赞等功能都可以利用Redis的计数器通过+1或-1的操作来实现，从而避免了使用关系型数据的<code>update</code>操作。</li><li>分布式锁 - 利用Redis可以跨多台服务器实现分布式锁（类似于线程锁，但是能够被多台机器上的多个线程或进程共享）的功能，用于实现一个阻塞式操作。</li><li>消息队列 - 消息队列和高速缓存一样，是一个大型网站不可缺少的基础服务，可以实现业务解耦和非实时业务削峰等特性，这些我们都会在后面的项目中为大家展示。</li></ol><h4 id=redis的安装和配置><a href=#redis的安装和配置 class=anchor-link>#</a>Redis的安装和配置</h4><p>可以使用Linux系统的包管理工具（如yum）来安装Redis，也可以通过在Redis的<a href=https://redis.io/ target=_blank rel=noopener>官方网站</a>下载Redis的源代码，解压缩解归档之后通过make工具对源代码进行构建并安装，在更新这篇文档时，Redis官方提供的最新稳定版本是<a href=https://download.redis.io/releases/redis-5.0.10.tar.gz target=_blank rel=noopener>Redis 5.0.10</a>。</p><p>下载：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>wget https://download.redis.io/releases/redis-5.0.10.tar.gz
</code></pre></td></tr></table></div></div></div><p>解压缩和解归档：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>tar -zxf redis-5.0.10.tar.gz
</code></pre></td></tr></table></div></div></div><p>进入Redis源代码目录：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=nb>cd</span> redis-5.0.10
</code></pre></td></tr></table></div></div></div><p>构建和安装：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>make <span class=o>&amp;&amp;</span> make install
</code></pre></td></tr></table></div></div></div><p>在redis源代码目录下有一个名为redis.conf的配置文件，我们可以先查看一下该文件。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>vim redis.conf
</code></pre></td></tr></table></div></div></div><p>下面我们对Redis的配置文件进行一个扼要的介绍。</p><p>配置Redis服务的IP地址和端口：</p><p><img src=/res/redis-bind-and-port.png alt></p><p>配置底层有多少个数据库：</p><p><img src=/res/redis-databases.png alt></p><p>配置Redis的持久化机制 - RDB。</p><p><img src=/res/redis-rdb-1.png alt></p><p><img src=/res/redis-rdb-3.png alt></p><p>配置Redis的持久化机制 - AOF：</p><p><img src=/res/redis-aof.png alt></p><p>配置访问Redis服务器的口令：</p><p><img src=/res/redis-security.png alt></p><p>配置Redis的主从复制（通过主从复制可以实现读写分离）：</p><p><img src=/res/redis-replication.png alt></p><p>配置慢查询：</p><p><img src=/res/redis-slow-logs.png alt></p><p>上面这些内容就是Redis的基本配置，如果你对上面的内容感到困惑也没有关系，先把Redis用起来再回头去推敲这些内容就行了。如果想找一些参考书，<a href=https://item.jd.com/12121730.html target=_blank rel=noopener>《Redis开发与运维》</a>是一本不错的入门读物，而<a href=https://item.jd.com/11791607.html target=_blank rel=noopener>《Redis实战》</a>是不错的进阶读物。</p><h4 id=redis的服务器和客户端><a href=#redis的服务器和客户端 class=anchor-link>#</a>Redis的服务器和客户端</h4><p>接下来启动Redis服务器，下面的方式将以默认的配置启动Redis服务。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>redis-server
</code></pre></td></tr></table></div></div></div><p>如果希望修改Redis的配置（如端口、认证口令、持久化方式等），可以通过下面两种方式。</p><p><strong>方式一</strong>：通过参数指定认证口令和AOF持久化方式。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>redis-server --requirepass yourpass --appendonly yes
</code></pre></td></tr></table></div></div></div><p><strong>方式二</strong>：通过指定的配置文件来修改Redis的配置。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>redis-server /root/redis-5.0.10/redis.conf
</code></pre></td></tr></table></div></div></div><p>下面我们使用第一种方式来启动Redis并将其置于后台运行，将Redis产生的输出重定向到名为redis.log的文件中。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>redis-server --requirepass yourpass &gt; redis.log <span class=p>&amp;</span>
</code></pre></td></tr></table></div></div></div><p>可以通过<code>ps</code>或者<code>netstat</code>来检查Redis服务器是否启动成功。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>ps -ef <span class=p>|</span> grep redis-server
netstat -nap <span class=p>|</span> grep redis-server
</code></pre></td></tr></table></div></div></div><p>接下来，我们尝试用Redis命令行工具<code>redis-cli</code>去连接服务器，该工具默认连接本机的<code>6379</code>端口，如果需要指定Redis服务器和端口，可以使用<code>-h</code>和<code>-p</code>参数分别进行指定。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>redis-cli
</code></pre></td></tr></table></div></div></div><p>进入命令行工具后，就可以通过Redis的命令来操作Redis服务器，如下所示。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>127.0.0.1:6379&gt; auth yourpass
OK
127.0.0.1:6379&gt; ping
PONG
127.0.0.1:6379&gt;
</code></pre></td></tr></table></div></div></div><p>Redis有着非常丰富的数据类型，也有很多的命令来操作这些数据，具体的内容可以查看<a href=http://redisdoc.com/ target=_blank rel=noopener>Redis命令参考</a>，在这个网站上，除了Redis的命令参考，还有Redis的详细文档，其中包括了通知、事务、主从复制、持久化、哨兵、集群等内容。</p><p><img src=/res/redis-data-types.png alt></p><blockquote><p><strong>说明</strong>：上面的插图来自付磊和张益军编著的《Redis开发与运维》一书。</p></blockquote><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>127.0.0.1:6379&gt; <span class=nb>set</span> username admin
OK
127.0.0.1:6379&gt; get username
<span class=s2>&#34;admin&#34;</span>
127.0.0.1:6379&gt; <span class=nb>set</span> password <span class=s2>&#34;123456&#34;</span> ex <span class=m>300</span>
OK
127.0.0.1:6379&gt; get password
<span class=s2>&#34;123456&#34;</span>
127.0.0.1:6379&gt; ttl username
<span class=o>(</span>integer<span class=o>)</span> -1
127.0.0.1:6379&gt; ttl password
<span class=o>(</span>integer<span class=o>)</span> <span class=m>286</span>
127.0.0.1:6379&gt; hset stu1 name hao
<span class=o>(</span>integer<span class=o>)</span> <span class=m>0</span>
127.0.0.1:6379&gt; hset stu1 age <span class=m>38</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; hset stu1 gender male
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; hgetall stu1
1<span class=o>)</span> <span class=s2>&#34;name&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;hao&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;age&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;38&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;gender&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;male&#34;</span>
127.0.0.1:6379&gt; hvals stu1
1<span class=o>)</span> <span class=s2>&#34;hao&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;38&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;male&#34;</span>
127.0.0.1:6379&gt; hmset stu2 name wang age <span class=m>18</span> gender female tel <span class=m>13566778899</span>
OK
127.0.0.1:6379&gt; hgetall stu2
1<span class=o>)</span> <span class=s2>&#34;name&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;wang&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;age&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;18&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;gender&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;female&#34;</span>
7<span class=o>)</span> <span class=s2>&#34;tel&#34;</span>
8<span class=o>)</span> <span class=s2>&#34;13566778899&#34;</span>
127.0.0.1:6379&gt; lpush nums <span class=m>1</span> <span class=m>2</span> <span class=m>3</span> <span class=m>4</span> <span class=m>5</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>5</span>
127.0.0.1:6379&gt; lrange nums <span class=m>0</span> -1
1<span class=o>)</span> <span class=s2>&#34;5&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;4&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;3&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;2&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;1&#34;</span>
127.0.0.1:6379&gt; lpop nums
<span class=s2>&#34;5&#34;</span>
127.0.0.1:6379&gt; lpop nums
<span class=s2>&#34;4&#34;</span>
127.0.0.1:6379&gt; rpop nums
<span class=s2>&#34;1&#34;</span>
127.0.0.1:6379&gt; rpop nums
<span class=s2>&#34;2&#34;</span>
127.0.0.1:6379&gt; sadd fruits apple banana orange apple grape grape
<span class=o>(</span>integer<span class=o>)</span> <span class=m>4</span>
127.0.0.1:6379&gt; scard fruits
<span class=o>(</span>integer<span class=o>)</span> <span class=m>4</span>
127.0.0.1:6379&gt; smembers fruits
1<span class=o>)</span> <span class=s2>&#34;grape&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;orange&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;banana&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;apple&#34;</span>
127.0.0.1:6379&gt; sismember fruits apple
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; sismember fruits durian
<span class=o>(</span>integer<span class=o>)</span> <span class=m>0</span>
127.0.0.1:6379&gt; sadd nums1 <span class=m>1</span> <span class=m>2</span> <span class=m>3</span> <span class=m>4</span> <span class=m>5</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>5</span>
127.0.0.1:6379&gt; sadd nums2 <span class=m>2</span> <span class=m>4</span> <span class=m>6</span> <span class=m>8</span>
<span class=o>(</span>integer<span class=o>)</span> <span class=m>4</span>
127.0.0.1:6379&gt; sinter nums1 nums2
1<span class=o>)</span> <span class=s2>&#34;2&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;4&#34;</span>
127.0.0.1:6379&gt; sunion nums1 nums2
1<span class=o>)</span> <span class=s2>&#34;1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;2&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;3&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;4&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;5&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;6&#34;</span>
7<span class=o>)</span> <span class=s2>&#34;8&#34;</span>
127.0.0.1:6379&gt; sdiff nums1 nums2
1<span class=o>)</span> <span class=s2>&#34;1&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;3&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;5&#34;</span>
127.0.0.1:6379&gt; zadd topsinger <span class=m>5234</span> zhangxy <span class=m>1978</span> chenyx <span class=m>2235</span> zhoujl <span class=m>3520</span> xuezq
<span class=o>(</span>integer<span class=o>)</span> <span class=m>4</span>
127.0.0.1:6379&gt; zrange topsinger <span class=m>0</span> -1 withscores
1<span class=o>)</span> <span class=s2>&#34;chenyx&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;1978&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;zhoujl&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;2235&#34;</span>
5<span class=o>)</span> <span class=s2>&#34;xuezq&#34;</span>
6<span class=o>)</span> <span class=s2>&#34;3520&#34;</span>
7<span class=o>)</span> <span class=s2>&#34;zhangxy&#34;</span>
8<span class=o>)</span> <span class=s2>&#34;5234&#34;</span>
127.0.0.1:6379&gt; zrevrange topsinger <span class=m>0</span> -1
1<span class=o>)</span> <span class=s2>&#34;zhangxy&#34;</span>
2<span class=o>)</span> <span class=s2>&#34;xuezq&#34;</span>
3<span class=o>)</span> <span class=s2>&#34;zhoujl&#34;</span>
4<span class=o>)</span> <span class=s2>&#34;chenyx&#34;</span>
127.0.0.1:6379&gt; zrevrank topsinger zhoujl
<span class=o>(</span>integer<span class=o>)</span> <span class=m>2</span>
127.0.0.1:6379&gt; geoadd pois 116.39738549206541 39.90862689286386 tiananmen
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; geoadd pois 116.27172936413572 39.99135172904494 yiheyuan
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; geoadd pois 117.27766503308104 40.65332064313784 gubeishuizhen
<span class=o>(</span>integer<span class=o>)</span> <span class=m>1</span>
127.0.0.1:6379&gt; geodist pois tiananmen gubeishuizhen km
<span class=s2>&#34;111.5333&#34;</span>
127.0.0.1:6379&gt; geodist pois tiananmen yiheyuan km
<span class=s2>&#34;14.1230&#34;</span>
127.0.0.1:6379&gt; georadius pois 116.86499108288572 40.40149669363615 <span class=m>50</span> km withdist
1<span class=o>)</span> 1<span class=o>)</span> <span class=s2>&#34;gubeishuizhen&#34;</span>
   2<span class=o>)</span> <span class=s2>&#34;44.7408&#34;</span>
</code></pre></td></tr></table></div></div></div><h4 id=在python程序中使用redis><a href=#在python程序中使用redis class=anchor-link>#</a>在Python程序中使用Redis</h4><p>可以使用pip安装名为<code>redis</code>的三方库，该三方库的核心是一个名为<code>Redis</code>的类，<code>Redis</code>对象代表一个Redis客户端，通过该客户端可以向Redis服务器发送命令并获取执行的结果。上面我们在Redis客户端中使用的命令基本上就是<code>Redis</code>对象可以接收的消息，所以如果了解了Redis的命令就可以在Python中玩转Redis。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>pip3 install redis
</code></pre></td></tr></table></div></div></div><p>进入Python交互式环境，使用<code>redis</code>三方库来操作Redis。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>&gt;&gt;&gt; import redis
&gt;&gt;&gt;
&gt;&gt;&gt; <span class=nv>client</span> <span class=o>=</span> redis.Redis<span class=o>(</span><span class=nv>host</span><span class=o>=</span><span class=s1>&#39;127.0.0.1&#39;</span>, <span class=nv>port</span><span class=o>=</span>6379, <span class=nv>password</span><span class=o>=</span><span class=s1>&#39;yourpass&#39;</span><span class=o>)</span>
&gt;&gt;&gt;
&gt;&gt;&gt; client.set<span class=o>(</span><span class=s1>&#39;username&#39;</span>, <span class=s1>&#39;admin&#39;</span><span class=o>)</span>
True
&gt;&gt;&gt; client.hset<span class=o>(</span><span class=s1>&#39;student&#39;</span>, <span class=s1>&#39;name&#39;</span>, <span class=s1>&#39;luohao&#39;</span><span class=o>)</span>
<span class=m>1</span>
&gt;&gt;&gt; client.hset<span class=o>(</span><span class=s1>&#39;student&#39;</span>, <span class=s1>&#39;age&#39;</span>, 40<span class=o>)</span>
<span class=m>1</span>
&gt;&gt;&gt; client.keys<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span>
<span class=o>[</span>b<span class=s1>&#39;username&#39;</span>, b<span class=s1>&#39;student&#39;</span><span class=o>]</span>
&gt;&gt;&gt; client.get<span class=o>(</span><span class=s1>&#39;username&#39;</span><span class=o>)</span>
b<span class=s1>&#39;admin&#39;</span>
&gt;&gt;&gt; client.hgetall<span class=o>(</span><span class=s1>&#39;student&#39;</span><span class=o>)</span>
<span class=o>{</span>b<span class=s1>&#39;name&#39;</span>: b<span class=s1>&#39;luohao&#39;</span>, b<span class=s1>&#39;age&#39;</span>: b<span class=s1>&#39;40&#39;</span><span class=o>}</span>
</code></pre></td></tr></table></div></div></div><h3 id=mongodb概述><a href=#mongodb概述 class=anchor-link>#</a>MongoDB概述</h3><h4 id=mongodb简介><a href=#mongodb简介 class=anchor-link>#</a>MongoDB简介</h4><p>MongoDB是2009年问世的一个面向文档的数据库管理系统，由C++语言编写，旨在为Web应用提供可扩展的高性能数据存储解决方案。虽然在划分类别的时候后，MongoDB被认为是NoSQL的产品，但是它更像一个介于关系数据库和非关系数据库之间的产品，在非关系数据库中它功能最丰富，最像关系数据库。</p><p>MongoDB将数据存储为一个文档，一个文档由一系列的“键值对”组成，其文档类似于JSON对象，但是MongoDB对JSON进行了二进制处理（能够更快的定位key和value），因此其文档的存储格式称为BSON。关于JSON和BSON的差别大家可以看看MongoDB官方网站的文章<a href=https://www.mongodb.com/json-and-bson target=_blank rel=noopener>《JSON and BSON》</a>。</p><p>目前，MongoDB已经提供了对Windows、macOS、Linux、Solaris等多个平台的支持，而且也提供了多种开发语言的驱动程序，Python当然是其中之一。</p><h4 id=mongodb的安装和启动><a href=#mongodb的安装和启动 class=anchor-link>#</a>MongoDB的安装和启动</h4><p>可以从MongoDB的<a href=https://www.mongodb.com/try/download/community target=_blank rel=noopener>官方下载链接</a>下载MongoDB，官方提供了Windows、macOS和多种Linux版本的安装包。下面以CentOS为例，简单说一下如何安装和启动MongoDB。</p><p>下载服务器和命令行的RPM安装包。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>wget https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.4/x86_64/RPMS/mongodb-org-server-4.4.2-1.el7.x86_64.rpm
rpm -ivh mongodb-org-server-4.4.2-1.el7.x86_64.rpm
wget https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.4/x86_64/RPMS/mongodb-org-shell-4.4.2-1.el7.x86_64.rpm
rpm -ivh mongodb-org-shell-4.4.2-1.el7.x86_64.rpm
</code></pre></td></tr></table></div></div></div><p>启动MongoDB服务器，需要先创建保存数据的文件夹。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>mkdir -p /data/db
</code></pre></td></tr></table></div></div></div><p>修改MongoDB的配置文件，将其中<code>bindIp</code>选项的值修改为本机IP地址而不是默认的<code>127.0.0.1</code>，本机IP地址可以通过<code>ifconfig</code>命令进行查看。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>vim /etc/mongod.conf
</code></pre></td></tr></table></div></div></div><p>使用<code>systemctl</code>命令启动服务。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>systemctl start mongod
</code></pre></td></tr></table></div></div></div><h4 id=mongodb基本概念><a href=#mongodb基本概念 class=anchor-link>#</a>MongoDB基本概念</h4><p>我们通过与关系型数据库的比较来说明MongoDB中的一些概念。</p><div class=table-container><table><thead><tr><th>SQL</th><th>MongoDB</th></tr></thead><tbody><tr><td>database</td><td>database</td></tr><tr><td>table（表）</td><td>collection（集合）</td></tr><tr><td>row（行）</td><td>document（文档）</td></tr><tr><td>column（列）</td><td>field（字段）</td></tr><tr><td>index</td><td>index</td></tr><tr><td>table joins（表连接）</td><td>（嵌套文档）</td></tr><tr><td>primary key</td><td>primary key</td></tr></tbody></table></div><h4 id=通过shell操作mongodb><a href=#通过shell操作mongodb class=anchor-link>#</a>通过Shell操作MongoDB</h4><ol start=0><li><p>启动命令行工具，进入交互式环境。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>mongo
</code></pre></td></tr></table></div></div></div><blockquote><p><strong>说明</strong>：</p></blockquote></li><li><p>查看、创建和删除数据库。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=o>&gt;</span> <span class=c1>// 显示所有数据库
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>show</span> <span class=nx>dbs</span>
<span class=nx>admin</span>   <span class=mf>0.000</span><span class=nx>GB</span>
<span class=nx>config</span>  <span class=mf>0.000</span><span class=nx>GB</span>
<span class=nx>local</span>   <span class=mf>0.000</span><span class=nx>GB</span>
<span class=o>&gt;</span> <span class=c1>// 创建并切换到school数据库
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>use</span> <span class=nx>school</span>
<span class=nx>switched</span> <span class=nx>to</span> <span class=nx>db</span> <span class=nx>school</span>
<span class=o>&gt;</span> <span class=c1>// 删除当前数据库
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>dropDatabase</span><span class=p>()</span>
<span class=p>{</span> <span class=s2>&#34;ok&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>}</span>
</code></pre></td></tr></table></div></div></div></li><li><p>创建、删除和查看集合。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=o>&gt;</span> <span class=c1>// 创建并切换到school数据库
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>use</span> <span class=nx>school</span>
<span class=nx>switched</span> <span class=nx>to</span> <span class=nx>db</span> <span class=nx>school</span>
<span class=o>&gt;</span> <span class=c1>// 创建colleges集合
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s1>&#39;colleges&#39;</span><span class=p>)</span>
<span class=p>{</span> <span class=s2>&#34;ok&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 创建students集合
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s1>&#39;students&#39;</span><span class=p>)</span>
<span class=p>{</span> <span class=s2>&#34;ok&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 查看所有集合
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>show</span> <span class=nx>collections</span>
<span class=nx>colleges</span>
<span class=nx>students</span>
<span class=o>&gt;</span> <span class=c1>// 删除colleges集合
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>colleges</span><span class=p>.</span><span class=nx>drop</span><span class=p>()</span>
<span class=kc>true</span>
</code></pre></td></tr></table></div></div></div><blockquote><p><strong>说明</strong>：在MongoDB中插入文档时如果集合不存在会自动创建集合，所以也可以按照下面的方式通过插入文档来创建集合。</p></blockquote></li><li><p>文档的CRUD操作。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=o>&gt;</span> <span class=c1>// 向students集合插入文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=mi>1001</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;骆昊&#39;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>40</span><span class=p>})</span>
<span class=nx>WriteResult</span><span class=p>({</span> <span class=s2>&#34;nInserted&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>})</span>
<span class=o>&gt;</span> <span class=c1>// 向students集合插入文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=mi>1002</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;王大锤&#39;</span><span class=p>,</span> <span class=nx>tel</span><span class=o>:</span> <span class=s1>&#39;13012345678&#39;</span><span class=p>,</span> <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;男&#39;</span><span class=p>})</span>
<span class=nx>WriteResult</span><span class=p>({</span> <span class=s2>&#34;nInserted&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>})</span>
<span class=o>&gt;</span> <span class=c1>// 查看所有文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>()</span>
<span class=p>{</span> <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c72e006ad854460ee70b&#34;</span><span class=p>),</span> <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1001</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;骆昊&#34;</span><span class=p>,</span> <span class=s2>&#34;age&#34;</span> <span class=o>:</span> <span class=mi>38</span> <span class=p>}</span>
<span class=p>{</span> <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c790006ad854460ee70c&#34;</span><span class=p>),</span> <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1002</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span><span class=p>,</span> <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13012345678&#34;</span><span class=p>,</span> <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 更新stuid为1001的文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>update</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=mi>1001</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;$set&#39;</span><span class=o>:</span> <span class=p>{</span><span class=nx>tel</span><span class=o>:</span> <span class=s1>&#39;13566778899&#39;</span><span class=p>,</span> <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;男&#39;</span><span class=p>}})</span>
<span class=nx>WriteResult</span><span class=p>({</span> <span class=s2>&#34;nMatched&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;nUpserted&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;nModified&#34;</span> <span class=o>:</span> <span class=mi>1</span> <span class=p>})</span>
<span class=o>&gt;</span> <span class=c1>// 插入或更新stuid为1003的文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>update</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=mi>1003</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;$set&#39;</span><span class=o>:</span> <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;白元芳&#39;</span><span class=p>,</span> <span class=nx>tel</span><span class=o>:</span> <span class=s1>&#39;13022223333&#39;</span><span class=p>,</span> <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;男&#39;</span><span class=p>}},</span>  <span class=nx>upsert</span><span class=o>=</span><span class=kc>true</span><span class=p>)</span>
<span class=nx>WriteResult</span><span class=p>({</span>
        <span class=s2>&#34;nMatched&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
        <span class=s2>&#34;nUpserted&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
        <span class=s2>&#34;nModified&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c92dd185894d7283efab&#34;</span><span class=p>)</span>
<span class=p>})</span>
<span class=o>&gt;</span> <span class=c1>// 查询所有文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>().</span><span class=nx>pretty</span><span class=p>()</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c72e006ad854460ee70b&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1001</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;骆昊&#34;</span><span class=p>,</span>
        <span class=s2>&#34;age&#34;</span> <span class=o>:</span> <span class=mi>38</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13566778899&#34;</span>
<span class=p>}</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c790006ad854460ee70c&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1002</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13012345678&#34;</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span>
<span class=p>}</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c92dd185894d7283efab&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1003</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;白元芳&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13022223333&#34;</span>
<span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 查询stuid大于1001的文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=p>{</span><span class=s1>&#39;$gt&#39;</span><span class=o>:</span> <span class=mi>1001</span><span class=p>}}).</span><span class=nx>pretty</span><span class=p>()</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c790006ad854460ee70c&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1002</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13012345678&#34;</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span>
<span class=p>}</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c92dd185894d7283efab&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1003</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;白元芳&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13022223333&#34;</span>
<span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 查询stuid大于1001的文档只显示name和tel字段
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=p>{</span><span class=s1>&#39;$gt&#39;</span><span class=o>:</span> <span class=mi>1001</span><span class=p>}},</span> <span class=p>{</span><span class=nx>_id</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>tel</span><span class=o>:</span> <span class=mi>1</span><span class=p>}).</span><span class=nx>pretty</span><span class=p>()</span>
<span class=p>{</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span><span class=p>,</span> <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13012345678&#34;</span> <span class=p>}</span>
<span class=p>{</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;白元芳&#34;</span><span class=p>,</span> <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13022223333&#34;</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 查询name为“骆昊”或者tel为“13022223333”的文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>({</span><span class=s1>&#39;$or&#39;</span><span class=o>:</span> <span class=p>[{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;骆昊&#39;</span><span class=p>},</span> <span class=p>{</span><span class=nx>tel</span><span class=o>:</span> <span class=s1>&#39;13022223333&#39;</span><span class=p>}]},</span> <span class=p>{</span><span class=nx>_id</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>tel</span><span class=o>:</span> <span class=mi>1</span><span class=p>}).</span><span class=nx>pretty</span><span class=p>()</span>
<span class=p>{</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;骆昊&#34;</span><span class=p>,</span> <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13566778899&#34;</span> <span class=p>}</span>
<span class=p>{</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;白元芳&#34;</span><span class=p>,</span> <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13022223333&#34;</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 查询学生文档跳过第1条文档只查1条文档
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>().</span><span class=nx>skip</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>limit</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>pretty</span><span class=p>()</span>
<span class=p>{</span>
        <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=nx>ObjectId</span><span class=p>(</span><span class=s2>&#34;5b13c790006ad854460ee70c&#34;</span><span class=p>),</span>
        <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1002</span><span class=p>,</span>
        <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span><span class=p>,</span>
        <span class=s2>&#34;tel&#34;</span> <span class=o>:</span> <span class=s2>&#34;13012345678&#34;</span><span class=p>,</span>
        <span class=s2>&#34;gender&#34;</span> <span class=o>:</span> <span class=s2>&#34;男&#34;</span>
<span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 对查询结果进行排序(1表示升序，-1表示降序)
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>find</span><span class=p>({},</span> <span class=p>{</span><span class=nx>_id</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>stuid</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=mi>1</span><span class=p>}).</span><span class=nx>sort</span><span class=p>({</span><span class=nx>stuid</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>})</span>
<span class=p>{</span> <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1003</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;白元芳&#34;</span> <span class=p>}</span>
<span class=p>{</span> <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1002</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;王大锤&#34;</span> <span class=p>}</span>
<span class=p>{</span> <span class=s2>&#34;stuid&#34;</span> <span class=o>:</span> <span class=mi>1001</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;骆昊&#34;</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=c1>// 在指定的一个或多个字段上创建索引
</span><span class=c1></span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>students</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span><span class=nx>name</span><span class=o>:</span> <span class=mi>1</span><span class=p>})</span>
<span class=p>{</span>
        <span class=s2>&#34;createdCollectionAutomatically&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
        <span class=s2>&#34;numIndexesBefore&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
        <span class=s2>&#34;numIndexesAfter&#34;</span> <span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
        <span class=s2>&#34;ok&#34;</span> <span class=o>:</span> <span class=mi>1</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div></li></ol><p>使用MongoDB可以非常方便的配置数据复制，通过冗余数据来实现数据的高可用以及灾难恢复，也可以通过数据分片来应对数据量迅速增长的需求。关于MongoDB更多的操作可以查阅<a href=https://mongodb-documentation.readthedocs.io/en/latest/ target=_blank rel=noopener>官方文档</a> ，同时推荐大家阅读Kristina Chodorow写的<a href=http://www.ituring.com.cn/book/1172 target=_blank rel=noopener>《MongoDB权威指南》</a>。</p><h4 id=在python程序中操作mongodb><a href=#在python程序中操作mongodb class=anchor-link>#</a>在Python程序中操作MongoDB</h4><p>可以通过pip安装<code>pymongo</code>来实现对MongoDB的操作。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install pymongo
</code></pre></td></tr></table></div></div></div><p>进入Python交互式环境，就可以执行以下的操作。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>pymongo</span> <span class=kn>import</span> <span class=n>MongoClient</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>client</span> <span class=o>=</span> <span class=n>MongoClient</span><span class=p>(</span><span class=s1>&#39;mongodb://127.0.0.1:27017&#39;</span><span class=p>)</span> 
<span class=o>&gt;&gt;&gt;</span> <span class=n>db</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>school</span>
<span class=o>&gt;&gt;&gt;</span> <span class=k>for</span> <span class=n>student</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>students</span><span class=o>.</span><span class=n>find</span><span class=p>():</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;学号:&#39;</span><span class=p>,</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;stuid&#39;</span><span class=p>])</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;姓名:&#39;</span><span class=p>,</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;电话:&#39;</span><span class=p>,</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;tel&#39;</span><span class=p>])</span>
<span class=o>...</span> 
<span class=n>学号</span><span class=p>:</span> <span class=mf>1001.0</span>
<span class=n>姓名</span><span class=p>:</span> <span class=n>骆昊</span>
<span class=n>电话</span><span class=p>:</span> <span class=mi>13566778899</span>
<span class=n>学号</span><span class=p>:</span> <span class=mf>1002.0</span>
<span class=n>姓名</span><span class=p>:</span> <span class=n>王大锤</span>
<span class=n>电话</span><span class=p>:</span> <span class=mi>13012345678</span>
<span class=n>学号</span><span class=p>:</span> <span class=mf>1003.0</span>
<span class=n>姓名</span><span class=p>:</span> <span class=n>白元芳</span>
<span class=n>电话</span><span class=p>:</span> <span class=mi>13022223333</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>db</span><span class=o>.</span><span class=n>students</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
<span class=mi>3</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>db</span><span class=o>.</span><span class=n>students</span><span class=o>.</span><span class=n>remove</span><span class=p>()</span>
<span class=p>{</span><span class=s1>&#39;n&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>&#39;ok&#39;</span><span class=p>:</span> <span class=mf>1.0</span><span class=p>}</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>db</span><span class=o>.</span><span class=n>students</span><span class=o>.</span><span class=n>find</span><span class=p>()</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
<span class=mi>0</span>
<span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>pymongo</span> <span class=kn>import</span> <span class=n>ASCENDING</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>coll</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>students</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>coll</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=n>ASCENDING</span><span class=p>)],</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=s1>&#39;name_1&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>coll</span><span class=o>.</span><span class=n>insert_one</span><span class=p>({</span><span class=s1>&#39;stuid&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=mi>1001</span><span class=p>),</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;骆昊&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>})</span>
<span class=o>&lt;</span><span class=n>pymongo</span><span class=o>.</span><span class=n>results</span><span class=o>.</span><span class=n>InsertOneResult</span> <span class=nb>object</span> <span class=n>at</span> <span class=mh>0x1050cc6c8</span><span class=o>&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>coll</span><span class=o>.</span><span class=n>insert_many</span><span class=p>([{</span><span class=s1>&#39;stuid&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=mi>1002</span><span class=p>),</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;王大锤&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;stuid&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=mi>1003</span><span class=p>),</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;白元芳&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}])</span>
<span class=o>&lt;</span><span class=n>pymongo</span><span class=o>.</span><span class=n>results</span><span class=o>.</span><span class=n>InsertManyResult</span> <span class=nb>object</span> <span class=n>at</span> <span class=mh>0x1050cc8c8</span><span class=o>&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=k>for</span> <span class=n>student</span> <span class=ow>in</span> <span class=n>coll</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s1>&#39;gender&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}):</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;学号:&#39;</span><span class=p>,</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;stuid&#39;</span><span class=p>])</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;姓名:&#39;</span><span class=p>,</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])</span>
<span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;性别:&#39;</span><span class=p>,</span> <span class=s1>&#39;男&#39;</span> <span class=k>if</span> <span class=n>student</span><span class=p>[</span><span class=s1>&#39;gender&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;女&#39;</span><span class=p>)</span>
<span class=o>...</span> 
<span class=n>学号</span><span class=p>:</span> <span class=mi>1001</span>
<span class=n>姓名</span><span class=p>:</span> <span class=n>骆昊</span>
<span class=n>性别</span><span class=p>:</span> <span class=n>男</span>
<span class=n>学号</span><span class=p>:</span> <span class=mi>1003</span>
<span class=n>姓名</span><span class=p>:</span> <span class=n>白元芳</span>
<span class=n>性别</span><span class=p>:</span> <span class=n>男</span>
</code></pre></td></tr></table></div></div></div><p>关于<a href=https://api.mongodb.com/python/current/tutorial.html target=_blank rel=noopener><code>pymongo</code></a>更多的知识可以通过它的官方文档进行了解，也可以使用<a href=https://pypi.org/project/mongoengine/ target=_blank rel=noopener><code>MongoEngine</code></a>这样的库来简化Python程序对MongoDB的操作，除此之外，还有以异步I/O方式访问MongoDB的三方库<a href=https://pypi.org/project/motor/ target=_blank rel=noopener><code>motor</code></a>都是不错的选择。</p></div><ul class=post-copyright><li class="copyright-item author"><span class=copyright-item-text>作者</span>：<span class="p-author h-card">骆昊</span></li><li class="copyright-item link"><span class=copyright-item-text>链接</span>：<a href=https://github.com/jackfrued/Python-100-Days target=_blank rel=noopener>https://github.com/jackfrued/Python-100-Days</a></li><li class="copyright-item license"><span class=copyright-item-text>许可</span>：本文采用<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>「CC BY-NC-SA 4.0」</a>协议，转载请注明出处。</li></ul></article><div class=related-posts><h2 class=related-title>相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/python/01.%E5%88%9D%E8%AF%86python/ class=related-link>01.初识Python</a></li><li class=related-item><a href=/python/02.%E8%AF%AD%E8%A8%80%E5%85%83%E7%B4%A0/ class=related-link>02.语言元素</a></li><li class=related-item><a href=/python/03.%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84/ class=related-link>03.分支结构</a></li><li class=related-item><a href=/python/04.%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/ class=related-link>04.循环结构</a></li><li class=related-item><a href=/python/05.%E6%9E%84%E9%80%A0%E7%A8%8B%E5%BA%8F%E9%80%BB%E8%BE%91/ class=related-link>05.构造程序逻辑</a></li></ul></div><div class=post-tags><a href=/tags/python/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>python</a></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;2021–2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;hanxin</div><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script>
<text class=poem_sentence></text>
<text class=poem_info></text>
<script type=text/javascript>jinrishici.load(function(a){var b=document.querySelector(".poem_sentence"),c=document.querySelector(".poem_info");b.innerHTML=a.data.content,c.innerHTML='——'+a.data.origin.author})</script></div></footer></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll('div.post-body img'),{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script></body></html>