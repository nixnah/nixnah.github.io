<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.91.2"><meta name=theme-color content="#16171d"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>95.ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›® | Hanxin</title><link rel=stylesheet href=/css/meme.min.88c90dc75021618344ec926f4ed6ac307f30ba48911294816b16370a41e5f137.css><script src=/js/meme.min.f460a174bb100a60a7e275913695161f1e09aab1378fe99cfd30cde14da70888.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Satisfy&family=Klee+One:wght@400;600&family=Great+Vibes&display=swap" media=print onload="this.media='all'"><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Satisfy&family=Klee+One:wght@400;600&family=Great+Vibes&display=swap"></noscript><meta name=author content="éª†æ˜Š"><meta name=description content="ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›® è¯´æ˜ï¼šæœ¬æ–‡çš„éƒ¨åˆ†æ’å›¾æ¥è‡ªäºã€ŠPythoné¡¹ç›®å¼€å‘å®æˆ˜ã€‹å’Œâ€¦â€¦"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="Hanxin"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="Hanxin"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=/python/95.%E4%BD%BF%E7%94%A8django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","datePublished":"2021-08-23T17:33:53+08:00","dateModified":"2022-01-16T09:24:35+00:00","url":"/python/95.%E4%BD%BF%E7%94%A8django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/","name":"95.ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›®","description":"ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›® è¯´æ˜ï¼šæœ¬æ–‡çš„éƒ¨åˆ†æ’å›¾æ¥è‡ªäºã€ŠPythoné¡¹ç›®å¼€å‘å®æˆ˜ã€‹å’Œâ€¦â€¦","image":"/icons/apple-touch-icon.png","license":"æœ¬æ–‡é‡‡ç”¨[ã€ŒCC BY-NC-SA 4.0ã€](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","publisher":{"@type":"Organization","name":"Hanxin","logo":{"@type":"ImageObject","url":"/icons/apple-touch-icon.png"},"url":"/"},"mainEntityOfPage":{"@type":"WebSite","@id":"/"}}</script><meta name=twitter:card content="summary"><meta property="og:title" content="95.ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›®"><meta property="og:description" content="ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›® è¯´æ˜ï¼šæœ¬æ–‡çš„éƒ¨åˆ†æ’å›¾æ¥è‡ªäºã€ŠPythoné¡¹ç›®å¼€å‘å®æˆ˜ã€‹å’Œâ€¦â€¦"><meta property="og:url" content="/python/95.%E4%BD%BF%E7%94%A8django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/"><meta property="og:site_name" content="Hanxin"><meta property="og:locale" content="zh"><meta property="og:image" content="/icons/apple-touch-icon.png"><meta property="og:type" content="website"></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>Hanxin</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/life/><span class=menu-item-name>ç”Ÿæ´»</span></a></li><li class=menu-item><a href=/tech/><span class=menu-item-name>æŠ€æœ¯</span></a></li><li class=menu-item><a href=/tags/><span class=menu-item-name>æ ‡ç­¾</span></a></li><li class=menu-item><a href=/about/><span class=menu-item-name>å…³äº</span></a></li><li class=menu-item><a href=/blogroll/><span class=menu-item-name>å‹é“¾</span></a></li><li class=menu-item><a href=/python/><span class=menu-item-name>Python-100å¤©</span></a></li><li class=menu-item><a id=theme-switcher href=#><span class="icon theme-icon-light">ğŸŒ</span><span class="icon theme-icon-dark">ğŸŒ™</span></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=python data-toc-num=true><h1 class="post-title p-name">95.ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›®</h1><div class=post-meta><time datetime=2021-08-23T17:33:53+08:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2021.8.23</time>
<time datetime=2022-01-16T09:24:35+00:00 class="post-meta-item modified dt-updated"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2022.1.16</time>
<span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;17800</span>
<span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;36&nbsp;åˆ†é’Ÿ</span></div><div class="post-body e-content"><h2 id=ä½¿ç”¨djangoå¼€å‘å•†ä¸šé¡¹ç›®><a href=#ä½¿ç”¨djangoå¼€å‘å•†ä¸šé¡¹ç›® class=anchor-link>#</a>ä½¿ç”¨Djangoå¼€å‘å•†ä¸šé¡¹ç›®</h2><blockquote><p><strong>è¯´æ˜</strong>ï¼šæœ¬æ–‡çš„éƒ¨åˆ†æ’å›¾æ¥è‡ªäºã€ŠPythoné¡¹ç›®å¼€å‘å®æˆ˜ã€‹å’Œã€Šç²¾é€šDjangoã€‹ï¼Œè¿™ä¸¤æœ¬ä¹¦ä¸­éƒ½åŒ…å«äº†å¯¹Djangoæ¡†æ¶ç²¾å½©çš„è®²è§£ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œè´­ä¹°é˜…è¯»ã€‚</p></blockquote><h3 id=webåº”ç”¨><a href=#webåº”ç”¨ class=anchor-link>#</a>Webåº”ç”¨</h3><p>é—®é¢˜1ï¼šæè¿°ä¸€ä¸ªWebåº”ç”¨çš„å·¥ä½œæµç¨‹ã€‚</p><p><img src=/res/web-application.png alt></p><p>é—®é¢˜2ï¼šæè¿°é¡¹ç›®çš„ç‰©ç†æ¶æ„ã€‚ï¼ˆä¸Šå›¾ä¸­è¡¥å……è´Ÿè½½å‡è¡¡ï¼ˆåå‘ä»£ç†ï¼‰æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ã€ç¼“å­˜æœåŠ¡å™¨ã€é˜²ç«å¢™ç­‰ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æ˜¯å¤šèŠ‚ç‚¹æ„æˆçš„é›†ç¾¤ã€‚å½“ç„¶ï¼Œæ¶æ„éƒ½æ˜¯æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ä¸€æ­¥æ­¥æ¼”è¿›è€Œä¸æ˜¯ä¸€è¹´è€Œå°±çš„ã€‚ï¼‰</p><p>é—®é¢˜3ï¼šæè¿°Djangoé¡¹ç›®çš„å·¥ä½œæµç¨‹ã€‚ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</p><p><img src=/res/django_request_response_cycle.png alt></p><h3 id=mvcæ¶æ„æ¨¡å¼><a href=#mvcæ¶æ„æ¨¡å¼ class=anchor-link>#</a>MVCæ¶æ„æ¨¡å¼</h3><p>é—®é¢˜1ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨MVCæ¶æ„æ¨¡å¼ï¼Ÿï¼ˆæ¨¡å‹å’Œè§†å›¾è§£è€¦åˆï¼‰</p><p>é—®é¢˜2ï¼šMVCæ¶æ„ä¸­æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼Ÿï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</p><p><img src=/res/mvc.png alt></p><h3 id=httpè¯·æ±‚å’Œå“åº”><a href=#httpè¯·æ±‚å’Œå“åº” class=anchor-link>#</a>HTTPè¯·æ±‚å’Œå“åº”</h3><h4 id=httpè¯·æ±‚--è¯·æ±‚è¡Œè¯·æ±‚å¤´ç©ºè¡Œæ¶ˆæ¯ä½“><a href=#httpè¯·æ±‚--è¯·æ±‚è¡Œè¯·æ±‚å¤´ç©ºè¡Œæ¶ˆæ¯ä½“ class=anchor-link>#</a>HTTPè¯·æ±‚ = è¯·æ±‚è¡Œ+è¯·æ±‚å¤´+ç©ºè¡Œ+[æ¶ˆæ¯ä½“]</h4><p><img src=/res/http-request.png alt></p><h4 id=httpå“åº”--å“åº”è¡Œå“åº”å¤´ç©ºè¡Œæ¶ˆæ¯ä½“><a href=#httpå“åº”--å“åº”è¡Œå“åº”å¤´ç©ºè¡Œæ¶ˆæ¯ä½“ class=anchor-link>#</a>HTTPå“åº” = å“åº”è¡Œ+å“åº”å¤´+ç©ºè¡Œ+æ¶ˆæ¯ä½“</h4><p><img src=/res/http-response.png alt></p><ol><li><p><code>HTTPRequest</code>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼š</p><ul><li><code>method</code> - è·å–è¯·æ±‚æ–¹æ³•</li><li><code>path</code> / <code>get_full_path()</code> - è·å–è¯·æ±‚è·¯å¾„/å¸¦æŸ¥è¯¢å­—ç¬¦ä¸²çš„è·¯å¾„</li><li><code>scheme</code> / <code>is_secure()</code> / <code>get_host()</code> / <code>get_port()</code> - è·å–è¯·æ±‚çš„åè®®/ä¸»æœº/ç«¯å£</li><li><code>META</code> / <code>COOKIES</code> - è·å–è¯·æ±‚å¤´/Cookieä¿¡æ¯</li><li><code>GET</code> / <code>POST</code> / <code>FILES</code> - è·å–GETæˆ–POSTè¯·æ±‚å‚æ•°/ä¸Šä¼ çš„æ–‡ä»¶</li><li><code>get_signed_cookie()</code> - è·å–å¸¦ç­¾åçš„Cookie</li><li><code>is_ajax()</code> - æ˜¯ä¸æ˜¯Ajaxå¼‚æ­¥è¯·æ±‚</li><li><code>body</code> / <code>content_type</code> / <code>encoding</code> - è·å–è¯·æ±‚çš„æ¶ˆæ¯ä½“ï¼ˆbytesæµï¼‰/MIMEç±»å‹/ç¼–ç </li></ul></li><li><p>ä¸­é—´ä»¶æ·»åŠ çš„å±æ€§ï¼š</p><ul><li><code>session</code> / <code>user</code> / <code>site</code></li></ul></li><li><p><code>HttpResponse</code>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼š</p><ul><li><code>set_cookie()</code> / <code>set_signed_cookie()</code> / <code>delete_cookie()</code> - æ·»åŠ /åˆ é™¤Cookie</li><li><code>__setitem__</code> / <code>__getitem__</code> / <code>__delitem__</code> - æ·»åŠ /è·å–/åˆ é™¤å“åº”å¤´</li><li><code>charset</code> / <code>content</code> / <code>status_code</code> - å“åº”çš„å­—ç¬¦é›†/æ¶ˆæ¯ä½“ï¼ˆbytesæµï¼‰/çŠ¶æ€ç <ul><li>1xxï¼šè¯·æ±‚å·²ç»æ”¶åˆ°ï¼Œç»§ç»­å¤„ç†</li><li>2xxï¼ˆæˆåŠŸï¼‰ï¼šè¯·æ±‚å·²ç»æˆåŠŸæ”¶åˆ°ã€ç†è§£å’Œæ¥æ”¶ã€‚</li><li>3xxï¼ˆé‡å®šå‘ï¼‰ï¼šä¸ºå®Œæˆè¯·æ±‚è¦ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚</li><li>4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯ï¼‰ï¼šè¯·æ±‚ä¸æ­£ç¡®æˆ–ä¸èƒ½å¤Ÿè¢«å—ç†ã€‚</li><li>5xxï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰ï¼šæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¤±è´¥ã€‚</li></ul></li></ul></li><li><p><code>JsonResponse</code>ï¼ˆ<code>HttpResponse</code>çš„å­ç±»å‹ï¼‰å¯¹è±¡</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.http</span> <span class=kn>import</span> <span class=n>HttpResponse</span><span class=p>,</span> <span class=n>JsonResponse</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span> <span class=o>=</span> <span class=n>JsonResponse</span><span class=p>({</span><span class=s1>&#39;foo&#39;</span><span class=p>:</span> <span class=s1>&#39;bar&#39;</span><span class=p>})</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span> <span class=o>=</span> <span class=n>JsonResponse</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>safe</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span> <span class=o>=</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;...&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;cotent-type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;application/pdf&#39;</span><span class=p>;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;content-disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;inline; filename=&#34;xyz.pdf&#34;&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;content-disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;attachment; filename=&#34;xyz.pdf&#34;&#39;</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=o>.</span><span class=n>set_signed_cookie</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=n>salt</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>=</span> <span class=mi>200</span>
</code></pre></td></tr></table></div></div></div></li></ol><h3 id=æ•°æ®æ¨¡å‹model><a href=#æ•°æ®æ¨¡å‹model class=anchor-link>#</a>æ•°æ®æ¨¡å‹(Model)</h3><p>é—®é¢˜1ï¼šå…³ç³»å‹æ•°æ®åº“è¡¨çš„è®¾è®¡åº”è¯¥æ³¨æ„å“ªäº›é—®é¢˜ï¼ˆèŒƒå¼ç†è®ºå’Œé€†èŒƒå¼ï¼‰ï¼Ÿå¦‚ä½•é€šè¿‡è¡¨æ¥åˆ›å»ºæ¨¡å‹ç±»ï¼ˆåå‘å·¥ç¨‹ï¼‰ï¼Ÿå¦‚ä½•é€šè¿‡æ¨¡å‹ç±»æ¥åˆ›å»ºè¡¨ï¼ˆæ­£å‘å·¥ç¨‹ï¼‰ï¼Ÿ</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>python manage.py makemigrations &lt;appname&gt;
python manage.py migrate

python manage.py inspectdb &gt; &lt;appname&gt;/models.py
</code></pre></td></tr></table></div></div></div><p>é—®é¢˜2ï¼šå…³ç³»å‹æ•°æ®åº“ä¸­æ•°æ®å®Œæ•´æ€§æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™éœ€è¦ç‰ºç‰²æ•°æ®å®Œæ•´æ€§ï¼Ÿï¼ˆå®ä½“å®Œæ•´æ€§/å‚ç…§å®Œæ•´æ€§/åŸŸå®Œæ•´æ€§ï¼‰</p><p>é—®é¢˜3ï¼šORMæ˜¯ä»€ä¹ˆä»¥åŠè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆå¯¹è±¡æ¨¡å‹-å…³ç³»æ¨¡å‹åŒå‘è½¬æ¢ï¼‰</p><ol><li><p><code>Field</code>åŠå…¶å­ç±»çš„å±æ€§ï¼š</p><ul><li>é€šç”¨é€‰é¡¹ï¼š<ul><li><code>db_column</code> / <code>db_tablespace</code></li><li><code>null</code> / <code>blank</code> / <code>default</code></li><li><code>primary_key</code></li><li><code>db_index</code> / <code>unqiue</code></li><li><code>choices</code> / <code>help_text</code> / <code>error_message</code> / <code>editable</code> / <code>hidden</code></li></ul></li><li>å…¶ä»–é€‰é¡¹ï¼š<ul><li><code>CharField</code>: <code>max_length</code></li><li><code>DateField</code>: <code>auto_now</code> / <code>auto_now_add</code></li><li><code>DecimalField</code>: <code>max_digits</code> / <code>decimal_places</code></li><li><code>FileField</code>: <code>storage</code> / <code>upload_to</code></li><li><code>ImageField</code>: <code>height_field</code> / <code>width_field</code></li></ul></li></ul></li><li><p><code>ForeignKey</code>çš„å±æ€§ï¼š</p><ul><li><p>é‡è¦å±æ€§ï¼š</p><ul><li><p><code>db_constraint</code>ï¼ˆæå‡æ€§èƒ½æˆ–è€…æ•°æ®åˆ†ç‰‡çš„æƒ…å†µå¯èƒ½éœ€è¦è®¾ç½®ä¸º<code>False</code>ï¼‰</p></li><li><p><code>on_delete</code></p><ul><li><code>CASCADE</code>ï¼šçº§è”åˆ é™¤ã€‚</li></ul><ul><li><code>PROTECT</code>ï¼šæŠ›å‡º<code>ProtectedError</code>å¼‚å¸¸ï¼Œé˜»æ­¢åˆ é™¤å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li><code>SET_NULL</code>ï¼šæŠŠå¤–é”®è®¾ç½®ä¸º<code>null</code>ï¼Œå½“<code>null</code>å±æ€§è¢«è®¾ç½®ä¸º<code>True</code>æ—¶æ‰èƒ½è¿™ä¹ˆåšã€‚</li><li><code>SET_DEFAULT</code>ï¼šæŠŠå¤–é”®è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œæä¾›äº†é»˜è®¤å€¼æ‰èƒ½è¿™ä¹ˆåšã€‚</li></ul></li><li><p><code>related_name</code></p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>Dept</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=k>pass</span>


<span class=k>class</span> <span class=nc>Emp</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>dept</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;+&#39;</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>


<span class=n>Dept</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>no</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>emp_set</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
<span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>dept__no</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼š<code>related_name</code>è®¾ç½®ä¸º<code>'+'</code>ï¼Œå¯ä»¥é˜²æ­¢ä¸€å¯¹å¤šå¤–é”®å…³è”ä»â€œä¸€â€çš„ä¸€æ–¹æŸ¥è¯¢â€œå¤šâ€çš„ä¸€æ–¹ã€‚</p></blockquote></li></ul></li><li><p>å…¶ä»–å±æ€§ï¼š</p><ul><li><code>to_field</code> / <code>limit_choices_to</code> / <code>swappable</code></li></ul></li></ul></li><li><p><code>Model</code>çš„å±æ€§å’Œæ–¹æ³•</p><ul><li><p><code>objects</code> / <code>pk</code></p></li><li><p><code>save()</code> / <code>delete()</code></p></li><li><p><code>clean()</code> / <code>validate_unique()</code> / <code>full_clean()</code></p></li></ul></li><li><p><code>QuerySet</code>çš„æ–¹æ³•</p><ul><li><p><code>get()</code> / <code>all()</code> / <code>values()</code></p><blockquote><p>è¯´æ˜ï¼š<code>values()</code>è¿”å›çš„<code>QuerySet</code>ä¸­ä¸æ˜¯æ¨¡å‹å¯¹è±¡è€Œæ˜¯å­—å…¸</p></blockquote></li><li><p><code>count()</code> / <code>order_by()</code> / <code>exists()</code> / <code>reverse()</code></p></li><li><p><code>filter()</code> / <code>exclude()</code></p><ul><li><p><code>exact</code> / <code>iexact</code>ï¼šç²¾ç¡®åŒ¹é…/å¿½ç•¥å¤§å°å†™çš„ç²¾ç¡®åŒ¹é…æŸ¥è¯¢</p></li><li><p><code>contains</code> / <code>icontains</code> / <code>startswith / istartswith / endswith / iendswith</code>ï¼šåŸºäº<code>like</code>çš„æ¨¡ç³ŠæŸ¥è¯¢</p></li><li><p><code>in</code>ï¼šé›†åˆè¿ç®—</p></li><li><p><code>gt</code> / <code>gte</code> / <code>lt</code> / <code>lte</code>ï¼šå¤§äº/å¤§äºç­‰äº/å°äº/å°äºç­‰äºå…³ç³»è¿ç®—</p></li><li><p><code>range</code>ï¼šæŒ‡å®šèŒƒå›´æŸ¥è¯¢ï¼ˆSQLä¸­çš„<code>betweenâ€¦andâ€¦</code>ï¼‰</p></li><li><p><code>year</code> / <code>month</code> / <code>day</code> / <code>week_day</code> / <code>hour</code> / <code>minute</code> / <code>second</code>ï¼šæŸ¥è¯¢æ—¶é—´æ—¥æœŸ</p></li><li><p><code>isnull</code>ï¼šæŸ¥è¯¢ç©ºå€¼ï¼ˆ<code>True</code>ï¼‰æˆ–éç©ºå€¼ï¼ˆ<code>False</code>ï¼‰</p></li><li><p><code>search</code>ï¼šåŸºäºå…¨æ–‡ç´¢å¼•çš„å…¨æ–‡æ£€ç´¢</p></li><li><p><code>regex</code> / <code>iregex</code>ï¼šåŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢</p></li><li><p><code>aggregate()</code> / <code>annotate()</code></p></li><li><p><code>Avg</code> / <code>Count</code> / <code>Sum</code> / <code>Max</code> / <code>Min</code></p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.db.models</span> <span class=kn>import</span> <span class=n>Avg</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>avg_sal</span><span class=o>=</span><span class=n>Avg</span><span class=p>(</span><span class=s1>&#39;sal&#39;</span><span class=p>))</span>
<span class=p>(</span><span class=mf>0.001</span><span class=p>)</span> <span class=n>SELECT</span> <span class=n>AVG</span><span class=p>(</span><span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>sal</span><span class=err>`</span><span class=p>)</span> <span class=n>AS</span> <span class=err>`</span><span class=n>avg_sal</span><span class=err>`</span> <span class=n>FROM</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=p>;</span> <span class=n>args</span><span class=o>=</span><span class=p>()</span>
<span class=p>{</span><span class=s1>&#39;avg_sal&#39;</span><span class=p>:</span> <span class=mf>3521.4286</span><span class=p>}</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=s1>&#39;dept&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>annotate</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=n>Count</span><span class=p>(</span><span class=s1>&#39;dept&#39;</span><span class=p>))</span>
<span class=p>(</span><span class=mf>0.001</span><span class=p>)</span> <span class=n>SELECT</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>dno</span><span class=err>`</span><span class=p>,</span> <span class=n>COUNT</span><span class=p>(</span><span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>dno</span><span class=err>`</span><span class=p>)</span> <span class=n>AS</span> <span class=err>`</span><span class=n>total</span><span class=err>`</span> <span class=n>FROM</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span> <span class=n>GROUP</span> <span class=n>BY</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>dno</span><span class=err>`</span> <span class=n>ORDER</span> <span class=n>BY</span> <span class=n>NULL</span> <span class=n>LIMIT</span> <span class=mi>21</span><span class=p>;</span> <span class=n>args</span><span class=o>=</span><span class=p>()</span>
<span class=o>&lt;</span><span class=n>QuerySet</span> <span class=p>[{</span><span class=s1>&#39;dept&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;dept&#39;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span> <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=mi>7</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;dept&#39;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span> <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>}]</span>
</code></pre></td></tr></table></div></div></div></li></ul></li><li><p><code>first()</code> / <code>last()</code></p><blockquote><p>è¯´æ˜ï¼šè°ƒç”¨<code>first()</code>æ–¹æ³•ç›¸å½“äºç”¨<code>[0]</code>å¯¹<code>QuerySet</code>è¿›è¡Œåˆ‡ç‰‡ã€‚</p></blockquote></li><li><p><code>only()</code> / <code>defer()</code></p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk</span><span class=o>=</span><span class=mi>7800</span><span class=p>)</span><span class=o>.</span><span class=n>only</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;sal&#39;</span><span class=p>)</span>
<span class=p>(</span><span class=mf>0.001</span><span class=p>)</span> <span class=n>SELECT</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>empno</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>ename</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>sal</span><span class=err>`</span> <span class=n>FROM</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span> <span class=n>WHERE</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>empno</span><span class=err>`</span> <span class=o>=</span> <span class=mi>7800</span> <span class=n>LIMIT</span> <span class=mi>21</span><span class=p>;</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>7800</span><span class=p>,)</span>
<span class=o>&lt;</span><span class=n>QuerySet</span> <span class=p>[</span><span class=o>&lt;</span><span class=n>Emp</span><span class=p>:</span> <span class=n>Emp</span> <span class=nb>object</span> <span class=p>(</span><span class=mi>7800</span><span class=p>)</span><span class=o>&gt;</span><span class=p>]</span><span class=o>&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk</span><span class=o>=</span><span class=mi>7800</span><span class=p>)</span><span class=o>.</span><span class=n>defer</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;sal&#39;</span><span class=p>)</span>
<span class=p>(</span><span class=mf>0.001</span><span class=p>)</span> <span class=n>SELECT</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>empno</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>job</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>mgr</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>comm</span><span class=err>`</span><span class=p>,</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>dno</span><span class=err>`</span> <span class=n>FROM</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span> <span class=n>WHERE</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>empno</span><span class=err>`</span> <span class=o>=</span> <span class=mi>7800</span> <span class=n>LIMIT</span> <span class=mi>21</span><span class=p>;</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>7800</span><span class=p>,)</span>
<span class=o>&lt;</span><span class=n>QuerySet</span> <span class=p>[</span><span class=o>&lt;</span><span class=n>Emp</span><span class=p>:</span> <span class=n>Emp</span> <span class=nb>object</span> <span class=p>(</span><span class=mi>7800</span><span class=p>)</span><span class=o>&gt;</span><span class=p>]</span><span class=o>&gt;</span>
</code></pre></td></tr></table></div></div></div></li><li><p><code>create()</code> / <code>update()</code> / <code>raw()</code></p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>dept__no</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>sal</span><span class=o>=</span><span class=n>F</span><span class=p>(</span><span class=s1>&#39;sal&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>100</span><span class=p>)</span>
<span class=p>(</span><span class=mf>0.011</span><span class=p>)</span> <span class=n>UPDATE</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span> <span class=n>SET</span> <span class=err>`</span><span class=n>sal</span><span class=err>`</span> <span class=o>=</span> <span class=p>(</span><span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>sal</span><span class=err>`</span> <span class=o>+</span> <span class=mi>100</span><span class=p>)</span> <span class=n>WHERE</span> <span class=err>`</span><span class=n>TbEmp</span><span class=err>`</span><span class=o>.</span><span class=err>`</span><span class=n>dno</span><span class=err>`</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>raw</span><span class=p>(</span><span class=s1>&#39;select empno, ename, job from TbEmp where dno=10&#39;</span><span class=p>)</span>
<span class=o>&lt;</span><span class=n>RawQuerySet</span><span class=p>:</span> <span class=n>select</span> <span class=n>empno</span><span class=p>,</span> <span class=n>ename</span><span class=p>,</span> <span class=n>job</span> <span class=kn>from</span> <span class=nn>TbEmp</span> <span class=n>where</span> <span class=n>dno</span><span class=o>=</span><span class=mi>10</span><span class=o>&gt;</span>
</code></pre></td></tr></table></div></div></div></li></ul></li><li><p><code>Q</code>å¯¹è±¡å’Œ<code>F</code>å¯¹è±¡</p><blockquote><p>è¯´æ˜ï¼šQå¯¹è±¡ä¸»è¦ç”¨æ¥è§£å†³å¤šæ¡ä»¶ç»„åˆçš„å¤æ‚æŸ¥è¯¢ï¼›Få¯¹è±¡ä¸»è¦ç”¨äºæ›´æ–°æ•°æ®ã€‚</p></blockquote><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.db.models</span> <span class=kn>import</span> <span class=n>Q</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
<span class=o>...</span>     <span class=n>Q</span><span class=p>(</span><span class=n>name__startswith</span><span class=o>=</span><span class=s1>&#39;å¼ &#39;</span><span class=p>),</span>
<span class=o>...</span>     <span class=n>Q</span><span class=p>(</span><span class=n>sal__lte</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span> <span class=o>|</span> <span class=n>Q</span><span class=p>(</span><span class=n>comm__gte</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
<span class=o>...</span> <span class=p>)</span> <span class=c1># æŸ¥è¯¢åå­—ä»¥â€œå¼ â€å¼€å¤´ä¸”å·¥èµ„å°äºç­‰äº5000æˆ–è¡¥è´´å¤§äºç­‰äº1000çš„å‘˜å·¥</span>
<span class=o>&lt;</span><span class=n>QuerySet</span> <span class=p>[</span><span class=o>&lt;</span><span class=n>Emp</span><span class=p>:</span> <span class=n>å¼ ä¸‰ä¸°</span><span class=o>&gt;</span><span class=p>]</span><span class=o>&gt;</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>backend.models</span> <span class=kn>import</span> <span class=n>Emp</span><span class=p>,</span> <span class=n>Dept</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>emps</span> <span class=o>=</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>dept__no</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.db.models</span> <span class=kn>import</span> <span class=n>F</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>emps</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>sal</span><span class=o>=</span><span class=n>F</span><span class=p>(</span><span class=s1>&#39;sal&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>100</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åŸç”ŸSQLæŸ¥è¯¢</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connections</span>


<span class=k>with</span> <span class=n>connections</span><span class=p>[</span><span class=s1>&#39;...&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE TbEmp SET sal=sal+10 WHERE dno=30&#34;</span><span class=p>)</span>
    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT ename, job FROM TbEmp WHERE dno=10&#34;</span><span class=p>)</span>
    <span class=n>row</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div></li><li><p>æ¨¡å‹ç®¡ç†å™¨</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>BookManager</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Manager</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>title_count</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>keyword</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>title__icontains</span><span class=o>=</span><span class=n>keyword</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>

<span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>

    <span class=n>objects</span> <span class=o>=</span> <span class=n>BookManager</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div></li></ol><h3 id=è§†å›¾å‡½æ•°controller><a href=#è§†å›¾å‡½æ•°controller class=anchor-link>#</a>è§†å›¾å‡½æ•°(Controller)</h3><h4 id=å¦‚ä½•è®¾è®¡è§†å›¾å‡½æ•°><a href=#å¦‚ä½•è®¾è®¡è§†å›¾å‡½æ•° class=anchor-link>#</a>å¦‚ä½•è®¾è®¡è§†å›¾å‡½æ•°</h4><ol><li><p>ç”¨æˆ·çš„æ¯ä¸ªè¯·æ±‚ï¼ˆç”¨æˆ·æ•…äº‹ï¼‰å¯¹åº”ä¸€ä¸ªè§†å›¾å‡½æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†ç”¨æˆ·è¦æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘å°è£…åˆ°ç‹¬ç«‹çš„å‡½æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸“é—¨çš„æ¨¡å—å¤„ç†ç¨‹åºä¸­çš„ä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p>ç”¨æˆ·çš„è¯·æ±‚å¯èƒ½ä¼šåŒ…å«å¤šä¸ªï¼ˆæŒä¹…åŒ–ï¼‰æ“ä½œï¼Œè¿™äº›æ“ä½œæœ‰å¯èƒ½éœ€è¦è®¾è®¡æˆä¸å¯åˆ†å‰²çš„åŸå­æ€§æ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œå°±å½¢æˆäº†äº‹åŠ¡çš„è¾¹ç•Œã€‚</p><ul><li><p>äº‹åŠ¡çš„ACIDç‰¹æ€§ã€‚</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä¸­å„é¡¹çš„æ“ä½œè¦ä¹ˆå…¨åšè¦ä¹ˆå…¨ä¸åšï¼›</li><li>ä¸€è‡´æ€§ï¼ˆConsistentcyï¼‰ï¼šäº‹åŠ¡å‰åç³»ç»Ÿçš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼›</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡æ— æ³•çœ‹åˆ°å½¼æ­¤çš„ä¸­é—´çŠ¶æ€ï¼›</li><li>æŒä¹…æ€§ï¼ˆDurationï¼‰ï¼šäº‹åŠ¡å®Œæˆåæ‰€åšçš„æ”¹åŠ¨éƒ½ä¼šè¢«æŒä¹…åŒ–ã€‚</li></ul></li><li><p>äº‹åŠ¡éš”ç¦»çº§åˆ« - è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä¸ºäº†æ•°æ®åº“åº•å±‚ä¾æ®äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºæ•°æ®åŠ ä¸Šé€‚å½“çš„é”ã€‚å¦‚æœéœ€è¦ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå…³ç³»å‹æ•°æ®åº“ä»ç„¶æ˜¯å”¯ä¸€çš„ä¹Ÿæ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå…³ç³»å‹æ•°æ®åº“å¯ä»¥é€šè¿‡é”æœºåˆ¶æ¥ä¿æŠ¤æ•°æ®ã€‚äº‹åŠ¡éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šRead Uncommittedï¼ˆè¯»æœªæäº¤ï¼‰ã€Read Committedï¼ˆè¯»æäº¤ï¼‰ã€Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰ã€Serializableï¼ˆä¸²è¡ŒåŒ–ï¼‰ã€‚äº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®å¹¶å‘è®¿é—®çš„é—®é¢˜è¶Šå°‘ï¼Œä½†æ˜¯æ€§èƒ½è¶Šå·®ï¼›äº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šä½ï¼Œæ•°æ®å¹¶å‘è®¿é—®çš„é—®é¢˜è¶Šå¤šï¼Œä½†æ˜¯æ€§èƒ½è¶Šå¥½ã€‚</p></li><li><p>æ•°æ®å¹¶å‘è®¿é—®ä¼šäº§ç”Ÿ5ç§é—®é¢˜ï¼ˆè¯·å‚è€ƒæˆ‘çš„<a href=https://blog.csdn.net/jackfrued/article/details/44921941 target=_blank rel=noopener>ã€ŠJavaé¢è¯•é¢˜å…¨é›†ï¼ˆä¸Šï¼‰ã€‹</a>ç¬¬80é¢˜å¯¹è¯¥é—®é¢˜çš„è®²è§£ï¼‰ï¼š</p><ul><li>ç¬¬1ç±»ä¸¢å¤±æ›´æ–°ï¼ˆAäº‹åŠ¡æ’¤é”€è¦†ç›–Bäº‹åŠ¡æ›´æ–°çš„æ•°æ®ï¼‰å’Œç¬¬2ç±»ä¸¢å¤±æ›´æ–°ï¼ˆAäº‹åŠ¡æäº¤è¦†ç›–Bäº‹åŠ¡æ›´æ–°çš„æ•°æ®ï¼‰ã€‚</li><li>è„è¯»ï¼ˆè¯»è„æ•°æ®ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°å…¶ä»–å°šæœªæäº¤çš„äº‹åŠ¡çš„æ•°æ®ã€‚</li><li>ä¸å¯é‡å¤è¯»ï¼š ä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–å®ƒçš„æŸ¥è¯¢ç»“æœæ—¶ï¼Œè¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†å®ƒçš„æŸ¥è¯¢è®°å½•å¯¼è‡´æ— æ³•è¯»åˆ°æ•°æ®ã€‚</li><li>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–å®ƒçš„æŸ¥è¯¢ç»“æœæ—¶ï¼Œå‘ç°è¯»åˆ°äº†è¢«å¦ä¸€ä¸ªäº‹åŠ¡æäº¤çš„æ–°æ•°æ®ã€‚</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=c1>-- è®¾ç½®å…¨å±€é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«
</span><span class=c1></span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=k>transaction</span><span class=w> </span><span class=k>isolation</span><span class=w> </span><span class=k>level</span><span class=w> </span><span class=k>repeatable</span><span class=w> </span><span class=k>read</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=c1>-- è®¾ç½®å½“å‰ä¼šè¯çš„äº‹åŠ¡éš”ç¦»çº§åˆ«
</span><span class=c1></span><span class=k>set</span><span class=w> </span><span class=k>session</span><span class=w> </span><span class=k>transaction</span><span class=w> </span><span class=k>isolation</span><span class=w> </span><span class=k>level</span><span class=w> </span><span class=k>read</span><span class=w> </span><span class=k>committed</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=c1>-- æŸ¥è¯¢å½“å‰ä¼šè¯çš„äº‹åŠ¡éš”ç¦»çº§åˆ«
</span><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>tx_isolation</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div></li><li><p>Djangoä¸­çš„äº‹åŠ¡æ§åˆ¶ã€‚</p><ul><li><p>ç»™æ¯ä¸ªè¯·æ±‚ç»‘å®šäº‹åŠ¡ç¯å¢ƒï¼ˆåæ¨¡å¼ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>ATOMIC_REQUESTS</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨äº‹åŠ¡è£…é¥°å™¨ï¼ˆç®€å•æ˜“ç”¨ï¼‰ - ç²—ç²’åº¦ï¼ˆæ§åˆ¶ä¸å¤Ÿç²¾ç»†ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@transaction</span><span class=o>.</span><span class=n>non_atomic_requests</span>
<span class=nd>@transaction</span><span class=o>.</span><span class=n>atomic</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨ä¸Šä¸‹æ–‡è¯­æ³•ï¼ˆç»†ç²’åº¦ - äº‹åŠ¡æ§åˆ¶çš„èŒƒå›´æ›´åŠ ç²¾å‡†ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>with</span> <span class=n>transaction</span><span class=o>.</span><span class=n>atomic</span><span class=p>():</span>
    <span class=k>pass</span>
</code></pre></td></tr></table></div></div></div></li><li><p>å…³é—­è‡ªåŠ¨æäº¤ä½¿ç”¨æ‰‹åŠ¨æäº¤ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>AUTOCOMMIT</span> <span class=o>=</span> <span class=kc>False</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>transaction</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
<span class=n>transaction</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div></li></ul></li></ul></li></ol><h4 id=urlé…ç½®><a href=#urlé…ç½® class=anchor-link>#</a>URLé…ç½®</h4><ol><li><p>å¯ä»¥è®©éƒ¨åˆ†URLåªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django.conf</span> <span class=kn>import</span> <span class=n>settings</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
<span class=p>]</span>

<span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>:</span>
    <span class=n>urlpatterns</span> <span class=o>+=</span> <span class=p>[</span> <span class=o>...</span> <span class=p>]</span>
</code></pre></td></tr></table></div></div></div></li><li><p>å¯ä»¥ä½¿ç”¨å‘½åæ•è·ç»„æ•è·è·¯å¾„å‚æ•°ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>url</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;api/code/(?P&lt;mobile&gt;1[3-9]\d</span><span class=si>{9}</span><span class=s1>)&#39;</span><span class=p>),</span>
<span class=n>path</span><span class=p>(</span><span class=s1>&#39;api/code/&lt;str:mobile&gt;&#39;</span><span class=p>),</span>
</code></pre></td></tr></table></div></div></div></li><li><p>URLé…ç½®ä¸å…³å¿ƒè¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼ˆä¸€ä¸ªè§†å›¾å‡½æ•°å¯ä»¥å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼ï¼‰ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨<code>url</code>å‡½æ•°æ•è·çš„è·¯å¾„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œ<code>path</code>å‡½æ•°å¯ä»¥æŒ‡å®šè·¯å¾„å‚æ•°ç±»å‹ã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨<code>include</code>å‡½æ•°å¼•å…¥å…¶ä»–URLé…ç½®å¹¶æŒ‡å®š<code>namespace</code>æ¥è§£å†³å‘½åå†²çªï¼Œæ•è·çš„å‚æ•°ä¼šå‘ä¸‹ä¼ é€’ã€‚</p></li><li><p>åœ¨<code>url</code>å’Œ<code>path</code>å‡½æ•°ç”šè‡³æ˜¯<code>include</code>å‡½æ•°ä¸­éƒ½å¯ä»¥ç”¨å­—å…¸å‘è§†å›¾ä¼ å…¥é¢å¤–çš„å‚æ•°ï¼Œå¦‚æœå‚æ•°ä¸æ•è·çš„å‚æ•°åŒåï¼Œåˆ™ä½¿ç”¨å­—å…¸ä¸­çš„å‚æ•°ã€‚</p></li><li><p>å¯ä»¥ç”¨<code>reverse</code>å‡½æ•°å®ç°URLçš„é€†å‘è§£æï¼ˆä»åå­—è§£æå‡ºURLï¼‰ï¼Œåœ¨æ¨¡æ¿ä¸­ä¹Ÿå¯ä»¥ç”¨<code>{% url %}</code>å®ç°åŒæ ·çš„æ“ä½œã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>path</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;index&#39;</span><span class=p>)</span>

<span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>))</span>
<span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div></li></ol><h3 id=æ¨¡æ¿view><a href=#æ¨¡æ¿view class=anchor-link>#</a>æ¨¡æ¿(View)</h3><h4 id=åç«¯æ¸²æŸ“><a href=#åç«¯æ¸²æŸ“ class=anchor-link>#</a>åç«¯æ¸²æŸ“</h4><ol><li><p>æ¨¡æ¿çš„é…ç½®å’Œæ¸²æŸ“å‡½æ•°ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>TEMPLATES</span> <span class=o>=</span> <span class=p>[</span>
    <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class=p>,</span>
        <span class=s1>&#39;DIRS&#39;</span><span class=p>:</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>BASE_DIR</span><span class=p>,</span> <span class=s1>&#39;templates&#39;</span><span class=p>),</span> <span class=p>],</span>
        <span class=s1>&#39;APP_DIRS&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;context_processors&#39;</span><span class=p>:</span> <span class=p>[</span>
                <span class=s1>&#39;django.template.context_processors.debug&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.template.context_processors.request&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.contrib.auth.context_processors.auth&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.contrib.messages.context_processors.messages&#39;</span><span class=p>,</span>
            <span class=p>],</span>
        <span class=p>},</span>
    <span class=p>},</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>resp</span> <span class=o>=</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;foo&#39;</span><span class=p>:</span> <span class=o>...</span><span class=p>})</span>
</code></pre></td></tr></table></div></div></div></li><li><p>æ¨¡æ¿é‡åˆ°å˜é‡åçš„æŸ¥æ‰¾é¡ºåºã€‚</p><ul><li>å­—å…¸æŸ¥æ‰¾ï¼ˆå¦‚ï¼š<code>foo['bar']</code>ï¼‰</li><li>å±æ€§æŸ¥æ‰¾ï¼ˆå¦‚ï¼š<code>foo.bar</code>ï¼‰</li><li>æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚ï¼š<code>foo.bar()</code>ï¼‰<ul><li>æ–¹æ³•ä¸èƒ½æœ‰å¿…é¡»ä¼ å€¼çš„å‚æ•°</li><li>åœ¨æ¨¡æ¿ä¸­ä¸èƒ½å¤Ÿç»™æ–¹æ³•ä¼ å‚</li><li>å¦‚æœæ–¹æ³•çš„<code>alters_data</code>è¢«è®¾ç½®ä¸º<code>True</code>åˆ™ä¸èƒ½è°ƒç”¨è¯¥æ–¹æ³•ï¼ˆé¿å…è¯¯æ“ä½œçš„é£é™©ï¼‰ï¼Œæ¨¡å‹å¯¹è±¡åŠ¨æ€ç”Ÿæˆçš„<code>delete()</code>å’Œ<code>save()</code>æ–¹æ³•éƒ½è®¾å®šäº†<code>alters_data = True</code>ã€‚</li></ul></li><li>åˆ—è¡¨ç´¢å¼•æŸ¥æ‰¾ï¼ˆå¦‚ï¼š<code>foo[0]</code>ï¼‰</li></ul></li><li><p>æ¨¡æ¿æ ‡ç­¾çš„ä½¿ç”¨ã€‚</p><ul><li><code>{% if %}</code> / <code>{% else %}</code> / <code>{% endif %}</code></li><li><code>{% for %}</code> / <code>{% endfor %}</code></li><li><code>{% ifequal %}</code> / <code>{% endifequal %}</code> / <code>{% ifnotequal %}</code> / <code>{% endifnotequal %}</code></li><li><code>{# comment #}</code> / <code>{% comment %}</code> / <code>{% endcomment %}</code></li></ul></li><li><p>è¿‡æ»¤å™¨çš„ä½¿ç”¨ã€‚</p><ul><li><code>lower</code> / <code>upper</code> / <code>first</code> / <code>last</code> / <code>truncatewords</code> / <code>date </code>/ <code>time</code> / <code>length</code> / <code>pluralize</code> / <code>center</code> / <code>ljust</code> / <code>rjust</code> / <code>cut</code> / <code>urlencode</code> / <code>default_if_none</code> / <code>filesizeformat</code> / <code>join</code> / <code>slice</code> / <code>slugify</code></li></ul></li><li><p>æ¨¡æ¿çš„åŒ…å«å’Œç»§æ‰¿ã€‚</p><ul><li><code>{% include %}</code> / <code>{% block %}</code></li><li><code>{% extends %}</code></li></ul></li><li><p>æ¨¡æ¿åŠ è½½å™¨ï¼ˆåé¢ä¼˜åŒ–éƒ¨åˆ†ä¼šè®²åˆ°ï¼‰ã€‚</p><ul><li><p>æ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>TEMPLATES</span> <span class=o>=</span> <span class=p>[{</span>
    <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class=p>,</span>
    <span class=s1>&#39;DIRS&#39;</span><span class=p>:</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>BASE_DIR</span><span class=p>,</span> <span class=s1>&#39;templates&#39;</span><span class=p>)],</span>
<span class=p>}]</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åº”ç”¨ç›®å½•åŠ è½½å™¨</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>TEMPLATES</span> <span class=o>=</span> <span class=p>[{</span>
    <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class=p>,</span>
    <span class=s1>&#39;APP_DIRS&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>}]</span>
</code></pre></td></tr></table></div></div></div></li></ul></li></ol><h4 id=å‰ç«¯æ¸²æŸ“><a href=#å‰ç«¯æ¸²æŸ“ class=anchor-link>#</a>å‰ç«¯æ¸²æŸ“</h4><ol><li>å‰ç«¯æ¨¡æ¿å¼•æ“ï¼šHandlebars / Mustacheã€‚</li><li>å‰ç«¯MV*æ¡†æ¶ã€‚<ul><li>MVC - AngularJS</li><li>MVVM(Model-View-ViewModel) - Vue.js</li></ul></li></ol><h4 id=å…¶ä»–è§†å›¾><a href=#å…¶ä»–è§†å›¾ class=anchor-link>#</a>å…¶ä»–è§†å›¾</h4><ol><li><p>MIMEï¼ˆå¤šç”¨é€”Interneté‚®ä»¶æ‰©å±•ï¼‰ç±»å‹ - å‘ŠçŸ¥æµè§ˆå™¨ä¼ è¾“çš„æ•°æ®ç±»å‹ã€‚</p><div class=table-container><table><thead><tr><th>Content-Type</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>application/json</td><td><a href=https://zh.wikipedia.org/wiki/JSON target=_blank rel=noopener>JSON</a>ï¼ˆJavaScript Object Notationï¼‰</td></tr><tr><td>application/pdf</td><td><a href=https://zh.wikipedia.org/wiki/PDF target=_blank rel=noopener>PDF</a>ï¼ˆPortable Document Formatï¼‰</td></tr><tr><td>audio/mpeg</td><td><a href=https://zh.wikipedia.org/wiki/MP3 target=_blank rel=noopener>MP3</a>æˆ–å…¶ä»–<a href=https://zh.wikipedia.org/wiki/MPEG target=_blank rel=noopener>MPEG</a>éŸ³é¢‘æ–‡ä»¶</td></tr><tr><td>audio/vnd.wave</td><td><a href=https://zh.wikipedia.org/wiki/WAV target=_blank rel=noopener>WAV</a>éŸ³é¢‘æ–‡ä»¶</td></tr><tr><td>image/gif</td><td><a href=https://zh.wikipedia.org/wiki/GIF target=_blank rel=noopener>GIF</a>å›¾åƒæ–‡ä»¶</td></tr><tr><td>image/jpeg</td><td><a href=https://zh.wikipedia.org/wiki/JPEG target=_blank rel=noopener>JPEG</a>å›¾åƒæ–‡ä»¶</td></tr><tr><td>image/png</td><td><a href=https://zh.wikipedia.org/wiki/PNG target=_blank rel=noopener>PNG</a>å›¾åƒæ–‡ä»¶</td></tr><tr><td>text/html</td><td><a href=https://zh.wikipedia.org/wiki/HTML target=_blank rel=noopener>HTML</a>æ–‡ä»¶</td></tr><tr><td>text/xml</td><td><a href=https://zh.wikipedia.org/wiki/XML target=_blank rel=noopener>XML</a></td></tr><tr><td>video/mp4</td><td><a href=https://zh.wikipedia.org/wiki/MP4 target=_blank rel=noopener>MP4</a>è§†é¢‘æ–‡ä»¶</td></tr><tr><td>video/quicktime</td><td><a href=https://zh.wikipedia.org/wiki/QuickTime target=_blank rel=noopener>QuickTime</a>è§†é¢‘æ–‡ä»¶</td></tr></tbody></table></div></li><li><p>å¦‚ä½•å¤„ç½®ç”Ÿæˆçš„å†…å®¹ï¼ˆinline / attachmentï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>quote</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;content-type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;application/pdf&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>filename</span> <span class=o>=</span> <span class=n>quote</span><span class=p>(</span><span class=s1>&#39;Pythonè¯­è¨€è§„èŒƒ.pdf&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>filename</span>
<span class=s1>&#39;Python</span><span class=si>%E</span><span class=s1>8%AF%AD</span><span class=si>%E</span><span class=s1>8%A8</span><span class=si>%80%</span><span class=s1>E8%A7</span><span class=si>%84%</span><span class=s1>E8%8C%83.pdf&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;content-disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;attachment; filename=&#34;</span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s1>&#34;&#39;</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>æé†’ï¼šURLä»¥åŠè¯·æ±‚å’Œå“åº”å¤´ä¸­çš„ä¸­æ–‡éƒ½åº”è¯¥å¤„ç†æˆ<a href=https://zh.wikipedia.org/zh-hans/%E7%99%BE%E5%88%86%E5%8F%B7%E7%BC%96%E7%A0%81 target=_blank rel=noopener>ç™¾åˆ†å·ç¼–ç </a>ã€‚</p></blockquote></li><li><p>ç”ŸæˆCSV / Excel / PDF / ç»Ÿè®¡æŠ¥è¡¨ã€‚</p><ul><li><p>å‘æµè§ˆå™¨ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>BytesIO</span>

<span class=n>buffer</span> <span class=o>=</span> <span class=n>BytesIO</span><span class=p>()</span>

<span class=n>resp</span> <span class=o>=</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=n>content_type</span><span class=o>=</span><span class=s1>&#39;...&#39;</span><span class=p>)</span>
<span class=n>resp</span><span class=p>[</span><span class=s1>&#39;Content-Disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;attachment; filename=&#34;...&#34;&#39;</span>
<span class=n>resp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>buffer</span><span class=o>.</span><span class=n>getvalue</span><span class=p>())</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>BytesIO</span>

<span class=kn>import</span> <span class=nn>xlwt</span>


<span class=k>def</span> <span class=nf>get_style</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>bold</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>italic</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
    <span class=n>font</span> <span class=o>=</span> <span class=n>xlwt</span><span class=o>.</span><span class=n>Font</span><span class=p>()</span>
    <span class=n>font</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>font</span><span class=o>.</span><span class=n>colour_index</span><span class=p>,</span> <span class=n>font</span><span class=o>.</span><span class=n>bold</span><span class=p>,</span> <span class=n>font</span><span class=o>.</span><span class=n>italic</span> <span class=o>=</span> \
    	<span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=n>bold</span><span class=p>,</span> <span class=n>italic</span>
    <span class=n>style</span> <span class=o>=</span> <span class=n>xlwt</span><span class=o>.</span><span class=n>XFStyle</span><span class=p>()</span>
    <span class=n>style</span><span class=o>.</span><span class=n>font</span> <span class=o>=</span> <span class=n>font</span>
    <span class=k>return</span> <span class=n>style</span>


<span class=k>def</span> <span class=nf>export_emp_excel</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=c1># åˆ›å»ºExcelå·¥ä½œç°¿(ä½¿ç”¨ä¸‰æ–¹åº“xlwt)</span>
    <span class=n>workbook</span> <span class=o>=</span> <span class=n>xlwt</span><span class=o>.</span><span class=n>Workbook</span><span class=p>()</span>
    <span class=c1># å‘å·¥ä½œç°¿ä¸­æ·»åŠ å·¥ä½œè¡¨</span>
    <span class=n>sheet</span> <span class=o>=</span> <span class=n>workbook</span><span class=o>.</span><span class=n>add_sheet</span><span class=p>(</span><span class=s1>&#39;å‘˜å·¥è¯¦ç»†ä¿¡æ¯&#39;</span><span class=p>)</span>
    <span class=c1># è®¾ç½®è¡¨å¤´</span>
    <span class=n>titles</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;ç¼–å·&#39;</span><span class=p>,</span> <span class=s1>&#39;å§“å&#39;</span><span class=p>,</span> <span class=s1>&#39;ä¸»ç®¡&#39;</span><span class=p>,</span> <span class=s1>&#39;èŒä½&#39;</span><span class=p>,</span> <span class=s1>&#39;å·¥èµ„&#39;</span><span class=p>,</span> <span class=s1>&#39;éƒ¨é—¨åç§°&#39;</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>col</span><span class=p>,</span> <span class=n>title</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>titles</span><span class=p>):</span>
        <span class=n>sheet</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>title</span><span class=p>,</span> <span class=n>get_style</span><span class=p>(</span><span class=s1>&#39;HanziPenSC-W3&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>True</span><span class=p>))</span>
    <span class=c1># ä½¿ç”¨Djangoçš„ORMæ¡†æ¶æŸ¥è¯¢å‘˜å·¥æ•°æ®</span>
    <span class=n>emps</span> <span class=o>=</span> <span class=n>Emp</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;dept&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;mgr&#39;</span><span class=p>)</span>
    <span class=n>cols</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;no&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;mgr&#39;</span><span class=p>,</span> <span class=s1>&#39;job&#39;</span><span class=p>,</span> <span class=s1>&#39;sal&#39;</span><span class=p>,</span> <span class=s1>&#39;dept&#39;</span><span class=p>]</span>
    <span class=c1># é€šè¿‡åµŒå¥—çš„å¾ªç¯å°†å‘˜å·¥è¡¨çš„æ•°æ®å†™å…¥Excelå·¥ä½œè¡¨çš„å•å…ƒæ ¼</span>
    <span class=k>for</span> <span class=n>row</span><span class=p>,</span> <span class=n>emp</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>emps</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>col</span><span class=p>,</span> <span class=n>prop</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>cols</span><span class=p>):</span>
            <span class=n>val</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>emp</span><span class=p>,</span> <span class=n>prop</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=p>(</span><span class=n>Dept</span><span class=p>,</span> <span class=n>Emp</span><span class=p>)):</span>
                <span class=n>val</span> <span class=o>=</span> <span class=n>val</span><span class=o>.</span><span class=n>name</span>
            <span class=n>sheet</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>row</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span>
    <span class=c1># å°†Excelæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®å†™å…¥å†…å­˜</span>
    <span class=n>buffer</span> <span class=o>=</span> <span class=n>BytesIO</span><span class=p>()</span>
    <span class=n>workbook</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span>
    <span class=c1># é€šè¿‡HttpResponseå¯¹è±¡å‘æµè§ˆå™¨è¾“å‡ºExcelæ–‡ä»¶</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=n>buffer</span><span class=o>.</span><span class=n>getvalue</span><span class=p>())</span>
    <span class=n>resp</span><span class=p>[</span><span class=s1>&#39;content-type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;application/msexcel&#39;</span>
    <span class=c1># å¦‚æœæ–‡ä»¶åæœ‰ä¸­æ–‡éœ€è¦å¤„ç†æˆç™¾åˆ†å·ç¼–ç </span>
    <span class=n>resp</span><span class=p>[</span><span class=s1>&#39;content-disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;attachment; filename=&#34;detail.xls&#34;&#39;</span>
    <span class=k>return</span> <span class=n>resp</span>
</code></pre></td></tr></table></div></div></div></li><li><p>å¤§æ–‡ä»¶çš„æµå¼å¤„ç†ï¼š<code>StreamingHttpResponse</code>ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>def</span> <span class=nf>download_file</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=n>file_stream</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span>
    <span class=c1># å¦‚æœæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®è¾ƒå¤§åˆ™æœ€å¥½ç”¨è¿­ä»£å™¨è¿›è¡Œå¤„ç†é¿å…è¿‡å¤šçš„å ç”¨æœåŠ¡å™¨å†…å­˜</span>
    <span class=n>file_iter</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>file_stream</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>4096</span><span class=p>),</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>StreamingHttpResponse</span><span class=p>(</span><span class=n>file_iter</span><span class=p>)</span>
    <span class=c1># ä¸­æ–‡æ–‡ä»¶åè¦å¤„ç†æˆç™¾åˆ†å·ç¼–ç </span>
    <span class=n>filename</span> <span class=o>=</span> <span class=n>quote</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
    <span class=n>resp</span><span class=p>[</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;...&#39;</span>
    <span class=n>resp</span><span class=p>[</span><span class=s1>&#39;Content-Disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;attachment; filename=&#34;</span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s1>&#34;&#39;</span>
    <span class=k>return</span> <span class=n>resp</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šå¦‚æœéœ€è¦ç”ŸæˆPDFæ–‡ä»¶ï¼Œå¯ä»¥éœ€è¦å®‰è£…<code>reportlab</code>ã€‚å¦å¤–ï¼Œä½¿ç”¨StreamingHttpResponseåªèƒ½å‡å°‘å†…å­˜çš„å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶ä¼šå¯¼è‡´ä¸€ä¸ªè¯·æ±‚é•¿æ—¶é—´å ç”¨æœåŠ¡å™¨èµ„æºï¼Œæ¯”è¾ƒå¥½çš„åšæ³•è¿˜æ˜¯æŠŠæŠ¥è¡¨æå‰ç”Ÿæˆå¥½ï¼ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼‰ï¼Œæ”¾åœ¨é™æ€èµ„æºæœåŠ¡å™¨æˆ–è€…æ˜¯äº‘å­˜å‚¨æœåŠ¡å™¨ä¸Šä»¥è®¿é—®é™æ€èµ„æºçš„æ–¹å¼è®¿é—®ã€‚</p></blockquote></li><li><p><a href=http://echarts.baidu.com/ target=_blank rel=noopener>ECharts</a>æˆ–<a href=https://www.chartjs.org/ target=_blank rel=noopener>Chart.js</a>ã€‚</p><ul><li>æ€è·¯ï¼šåç«¯åªæä¾›JSONæ ¼å¼çš„æ•°æ®ï¼Œå‰ç«¯JavaScriptæ¸²æŸ“ç”Ÿæˆå›¾è¡¨ã€‚</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>def</span> <span class=nf>get_charts_data</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;è·å–ç»Ÿè®¡å›¾è¡¨JSONæ•°æ®&#34;&#34;&#34;</span>
    <span class=n>names</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>totals</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=c1># é€šè¿‡connectionsè·å–æŒ‡å®šæ•°æ®åº“è¿æ¥å¹¶åˆ›å»ºæ¸¸æ ‡å¯¹è±¡</span>
    <span class=k>with</span> <span class=n>connections</span><span class=p>[</span><span class=s1>&#39;backend&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
        <span class=c1># åœ¨ä½¿ç”¨ORMæ¡†æ¶æ—¶å¯ä»¥ä½¿ç”¨å¯¹è±¡ç®¡ç†å™¨çš„aggregate()å’Œannotate()æ–¹æ³•å®ç°åˆ†ç»„å’Œèšåˆå‡½æ•°æŸ¥è¯¢</span>
        <span class=c1># æ‰§è¡ŒåŸç”ŸSQLæŸ¥è¯¢(å¦‚æœORMæ¡†æ¶ä¸èƒ½æ»¡è¶³ä¸šåŠ¡æˆ–æ€§èƒ½éœ€æ±‚)</span>
        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;select dname, total from vw_dept_emp&#39;</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>():</span>
            <span class=n>names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=n>totals</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
    <span class=k>return</span> <span class=n>JsonResponse</span><span class=p>({</span><span class=s1>&#39;names&#39;</span><span class=p>:</span> <span class=n>names</span><span class=p>,</span> <span class=s1>&#39;totals&#39;</span><span class=p>:</span> <span class=n>totals</span><span class=p>})</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=cp>&lt;!DOCTYPE html&gt;</span>
<span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>ç»Ÿè®¡å›¾è¡¨<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
        <span class=p>#</span><span class=nn>main</span> <span class=p>{</span>
            <span class=k>width</span><span class=p>:</span> <span class=mi>600</span><span class=kt>px</span><span class=p>;</span>
            <span class=k>height</span><span class=p>:</span> <span class=mi>400</span><span class=kt>px</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;main&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.bootcss.com/echarts/4.2.0-rc.2/echarts.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
        <span class=kd>var</span> <span class=nx>myChart</span> <span class=o>=</span> <span class=nx>echarts</span><span class=p>.</span><span class=nx>init</span><span class=p>(</span><span class=nx>$</span><span class=p>(</span><span class=s1>&#39;#main&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]);</span>
        <span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span>
            <span class=s1>&#39;url&#39;</span><span class=o>:</span> <span class=s1>&#39;charts_data&#39;</span><span class=p>,</span>
            <span class=s1>&#39;type&#39;</span><span class=o>:</span> <span class=s1>&#39;get&#39;</span><span class=p>,</span>
            <span class=s1>&#39;data&#39;</span><span class=o>:</span> <span class=p>{},</span>
            <span class=s1>&#39;dataType&#39;</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span>
            <span class=s1>&#39;success&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>json</span><span class=p>)</span> <span class=p>{</span>
                <span class=kd>var</span> <span class=nx>option</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=nx>title</span><span class=o>:</span> <span class=p>{</span>
                        <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;å‘˜å·¥åˆ†å¸ƒç»Ÿè®¡å›¾&#39;</span>
                    <span class=p>},</span>
                    <span class=nx>tooltip</span><span class=o>:</span> <span class=p>{},</span>
                    <span class=nx>legend</span><span class=o>:</span> <span class=p>{</span>
                        <span class=nx>data</span><span class=o>:</span><span class=p>[</span><span class=s1>&#39;äººæ•°&#39;</span><span class=p>]</span>
                    <span class=p>},</span>
                    <span class=nx>xAxis</span><span class=o>:</span> <span class=p>{</span>
                        <span class=nx>data</span><span class=o>:</span> <span class=nx>json</span><span class=p>.</span><span class=nx>names</span>
                    <span class=p>},</span>
                    <span class=nx>yAxis</span><span class=o>:</span> <span class=p>{},</span>
                    <span class=nx>series</span><span class=o>:</span> <span class=p>[{</span>
                        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;äººæ•°&#39;</span><span class=p>,</span>
                        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span>
                        <span class=nx>data</span><span class=o>:</span> <span class=nx>json</span><span class=p>.</span><span class=nx>totals</span>
                    <span class=p>}]</span>
                <span class=p>};</span>
                <span class=nx>myChart</span><span class=p>.</span><span class=nx>setOption</span><span class=p>(</span><span class=nx>option</span><span class=p>);</span>
            <span class=p>},</span>
            <span class=s1>&#39;error&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{}</span>
        <span class=p>});</span>
    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div></li></ul></li></ol><h3 id=ä¸­é—´ä»¶><a href=#ä¸­é—´ä»¶ class=anchor-link>#</a>ä¸­é—´ä»¶</h3><p>é—®é¢˜1ï¼šä¸­é—´ä»¶èƒŒåçš„è®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆåˆ†ç¦»æ¨ªåˆ‡å…³æ³¨åŠŸèƒ½/æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼‰</p><p>é—®é¢˜2ï¼šä¸­é—´ä»¶æœ‰å“ªäº›ä¸åŒçš„å®ç°æ–¹å¼ï¼Ÿï¼ˆå‚è€ƒä¸‹é¢çš„ä»£ç ï¼‰</p><p>é—®é¢˜3ï¼šæè¿°Djangoå†…ç½®çš„ä¸­é—´ä»¶åŠå…¶æ‰§è¡Œé¡ºåºã€‚ï¼ˆæ¨èé˜…è¯»ï¼š<a href=https://docs.djangoproject.com/zh-hans/2.0/ref/middleware/#middleware-ordering target=_blank rel=noopener>Djangoå®˜æ–¹æ–‡æ¡£ - ä¸­é—´ä»¶ - ä¸­é—´ä»¶é¡ºåº</a>ï¼‰</p><h4 id=æ¿€æ´»ä¸­é—´ä»¶><a href=#æ¿€æ´»ä¸­é—´ä»¶ class=anchor-link>#</a>æ¿€æ´»ä¸­é—´ä»¶</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>MIDDLEWARE</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.middleware.common.CommonMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class=p>,</span>
    <span class=s1>&#39;common.middlewares.block_sms_middleware&#39;</span><span class=p>,</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div><h4 id=è‡ªå®šä¹‰ä¸­é—´ä»¶><a href=#è‡ªå®šä¹‰ä¸­é—´ä»¶ class=anchor-link>#</a>è‡ªå®šä¹‰ä¸­é—´ä»¶</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>def</span> <span class=nf>simple_middleware</span><span class=p>(</span><span class=n>get_response</span><span class=p>):</span>
    
    <span class=k>def</span> <span class=nf>middleware</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        
		<span class=n>response</span> <span class=o>=</span> <span class=n>get_response</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        
		<span class=k>return</span> <span class=n>response</span>
    
    <span class=k>return</span> <span class=n>middleware</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>MyMiddleware</span><span class=p>:</span>
        
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>get_response</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>get_response</span> <span class=o>=</span> <span class=n>get_response</span>
        
    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
        
        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_response</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
       
        <span class=k>return</span> <span class=n>response</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>MyMiddleware</span><span class=p>(</span><span class=n>MiddlewareMixin</span><span class=p>):</span>
    
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>
    
    <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
        <span class=k>pass</span>
    
    <span class=k>def</span> <span class=nf>process_view</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>view_func</span><span class=p>,</span> <span class=n>view_args</span><span class=p>,</span> <span class=n>view_kwargs</span><span class=p>):</span>
        <span class=k>pass</span>
    
    <span class=k>def</span> <span class=nf>process_template_response</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
        <span class=k>pass</span>
    
    <span class=k>def</span> <span class=nf>process_response</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
        <span class=k>pass</span>
    
    <span class=k>def</span> <span class=nf>process_exception</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>exception</span><span class=p>):</span>
        <span class=k>pass</span>
</code></pre></td></tr></table></div></div></div><h4 id=å†…ç½®ä¸­é—´ä»¶><a href=#å†…ç½®ä¸­é—´ä»¶ class=anchor-link>#</a>å†…ç½®ä¸­é—´ä»¶</h4><ol><li><p>CommonMiddleware - åŸºç¡€è®¾ç½®ä¸­é—´ä»¶</p><ul><li>DISALLOWED_USER_AGENTS - ä¸è¢«å…è®¸çš„ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰</li><li>APPEND_SLASH - æ˜¯å¦è¿½åŠ <code>/</code></li><li>USE_ETAG - æµè§ˆå™¨ç¼“å­˜ç›¸å…³</li></ul></li><li><p>SecurityMiddleware - å®‰å…¨ç›¸å…³ä¸­é—´ä»¶</p><ul><li>SECURE_HSTS_SECONDS - å¼ºåˆ¶ä½¿ç”¨HTTPSçš„æ—¶é—´</li><li>SECURE_HSTS_INCLUDE_SUBDOMAINS - HTTPSæ˜¯å¦è¦†ç›–å­åŸŸå</li><li>SECURE_CONTENT_TYPE_NOSNIFF - æ˜¯å¦å…è®¸æµè§ˆå™¨æ¨æ–­å†…å®¹ç±»å‹</li><li>SECURE_BROWSER_XSS_FILTER - æ˜¯å¦å¯ç”¨è·¨ç«™è„šæœ¬æ”»å‡»è¿‡æ»¤å™¨</li><li>SECURE_SSL_REDIRECT - æ˜¯å¦é‡å®šå‘åˆ°HTTPSè¿æ¥</li><li>SECURE_REDIRECT_EXEMPT - å…é™¤é‡å®šå‘åˆ°HTTPS</li></ul></li><li><p>SessionMiddleware - ä¼šè¯ä¸­é—´ä»¶</p></li><li><p>CsrfViewMiddleware - é˜²èŒƒè·¨ç«™èº«ä»½ä¼ªé€ ä¸­é—´ä»¶</p></li><li><p>XFrameOptionsMiddleware - é˜²èŒƒç‚¹å‡»åŠ«æŒæ”»å‡»ä¸­é—´ä»¶</p><p><img src=/res/click-jacking.png alt></p></li></ol><p><img src=/res/builtin-middlewares.png alt></p><h3 id=è¡¨å•><a href=#è¡¨å• class=anchor-link>#</a>è¡¨å•</h3><ol><li>ç”¨æ³•ï¼šé€šå¸¸ä¸è¦ç”¨æ¥ç”Ÿæˆé¡µé¢ä¸Šçš„è¡¨å•æ§ä»¶ï¼ˆè€¦åˆåº¦å¤ªé«˜ä¸å®¹æ˜“å®šåˆ¶ï¼‰ï¼Œä¸»è¦ç”¨æ¥éªŒè¯æ•°æ®ã€‚</li><li>Formçš„å±æ€§å’Œæ–¹æ³•ï¼š<ul><li><code>is_valid()</code> / <code>is_multipart()</code></li><li><code>errors</code> / <code>fields</code> / <code>is_bound</code> / <code>changed_data</code> / <code>cleaned_data</code></li><li><code>add_error()</code> / <code>has_errors()</code> / <code>non_field_errors()</code></li><li><code>clean()</code></li></ul></li><li>Form.errorsçš„æ–¹æ³•ï¼š<ul><li><code>as_data()</code> / <code>as_json()</code> / <code>get_json_data()</code></li></ul></li></ol><p>é—®é¢˜1ï¼šDjangoä¸­çš„<code>Form</code>å’Œ<code>ModelForm</code>æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿï¼ˆé€šå¸¸ä¸ç”¨æ¥ç”Ÿæˆè¡¨å•ä¸»è¦ç”¨æ¥éªŒè¯æ•°æ®ï¼‰</p><p>é—®é¢˜2ï¼šè¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶åº”è¯¥æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿï¼ˆè¡¨å•çš„è®¾ç½®ã€å¤šæ–‡ä»¶ä¸Šä¼ ã€å›¾ç‰‡é¢„è§ˆï¼ˆFileReaderï¼‰ã€Ajaxä¸Šä¼ æ–‡ä»¶ã€ä¸Šä¼ åçš„æ–‡ä»¶å¦‚ä½•å­˜å‚¨ã€è°ƒç”¨äº‘å­˜å‚¨ï¼ˆå¦‚<a href=https://www.aliyun.com/product/oss target=_blank rel=noopener>é˜¿é‡Œäº‘OSS</a>ã€<a href=https://www.qiniu.com/ target=_blank rel=noopener>ä¸ƒç‰›äº‘</a>ã€<a href=https://leancloud.cn/storage/ target=_blank rel=noopener>LeanCloud</a>ç­‰ï¼‰ï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span> <span class=na>enctype</span><span class=o>=</span><span class=s>&#34;multipart/form-data&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;...&#34;</span> <span class=na>multiple</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;foo&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;foo&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;foo&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šä¸Šä¼ å›¾ç‰‡æ–‡ä»¶çš„é¢„è§ˆæ•ˆæœå¯ä»¥é€šè¿‡HTML5çš„FileReaderæ¥å®ç°ã€‚</p></blockquote><blockquote><p>è¯´æ˜ï¼šä½¿ç”¨äº‘å­˜å‚¨é€šå¸¸æ˜¯æ¯”è‡ªå·±é…ç½®åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¿™ç§æ–¹å¼æ›´é è°±çš„åšæ³•ï¼Œè€Œä¸”äº‘å­˜å‚¨é€šå¸¸æˆæœ¬å¹¶ä¸å¤ªé«˜ï¼Œä¸ä»…å¦‚æ­¤å¤§å¤šæ•°äº‘å­˜å‚¨è¿˜æä¾›äº†å¦‚å›¾ç‰‡å‰ªè£ã€ç”Ÿæˆæ°´å°ã€è§†é¢‘è½¬ç ã€CDNç­‰æœåŠ¡ã€‚å¦‚æœè¦è‡ªå·±åšä¸Šä¼ çš„è§†é¢‘æ–‡ä»¶è½¬ç ï¼Œéœ€è¦å®‰è£…ä¸‰æ–¹åº“ffmpegï¼Œåœ¨ç¨‹åºä¸­è°ƒç”¨è¯¥ä¸‰æ–¹åº“å¯ä»¥å®ç°è½¬ç ã€‚</p></blockquote><h3 id=cookieå’Œsession><a href=#cookieå’Œsession class=anchor-link>#</a>Cookieå’ŒSession</h3><p>é—®é¢˜1ï¼šä½¿ç”¨Cookieèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆç”¨æˆ·è·Ÿè¸ªï¼Œè§£å†³HTTPåè®®æ— çŠ¶æ€é—®é¢˜ï¼‰</p><ol><li><p>URLé‡å†™</p><pre tabindex=0><code>http://www.abc.com/path/resource?foo=bar
</code></pre></li><li><p>éšè—åŸŸï¼ˆéšå¼è¡¨å•åŸŸï¼‰- åŸ‹ç‚¹</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>&gt;</span>

    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;foo&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;bar&#34;</span><span class=p>&gt;</span>

<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>Cookie - æµè§ˆå™¨ä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰- BASE64</p></li></ol><p>é—®é¢˜2ï¼šCookieå’ŒSessionä¹‹é—´å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆSessionçš„æ ‡è¯†é€šè¿‡Cookieä¿å­˜å’Œä¼ è¾“ï¼‰</p><h4 id=sessionçš„é…ç½®><a href=#sessionçš„é…ç½® class=anchor-link>#</a>Sessionçš„é…ç½®</h4><ol><li><p>Sessionå¯¹åº”çš„ä¸­é—´ä»¶ï¼š<code>django.contrib.sessions.middleware.SessionMiddleware</code>ã€‚</p></li><li><p>Sessionå¼•æ“ã€‚</p><ul><li><p>åŸºäºæ•°æ®åº“ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;django.contrib.sessions&#39;</span><span class=p>,</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åŸºäºç¼“å­˜ï¼ˆæ¨èä½¿ç”¨ï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>SESSION_ENGINE</span> <span class=o>=</span> <span class=s1>&#39;django.contrib.sessions.backends.cache&#39;</span>
<span class=n>SESSION_CACHE_ALIAS</span> <span class=o>=</span> <span class=s1>&#39;session&#39;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åŸºäºæ–‡ä»¶ï¼ˆåŸºæœ¬ä¸è€ƒè™‘ï¼‰</p></li><li><p>åŸºäºCookieï¼ˆä¸é è°±ï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>SESSION_ENGINE</span> <span class=o>=</span> <span class=s1>&#39;django.contrib.sessions.backends.signed_cookies&#39;</span>
</code></pre></td></tr></table></div></div></div></li></ul></li><li><p>Cookieç›¸å…³çš„é…ç½®ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>SESSION_COOKIE_NAME</span> <span class=o>=</span> <span class=s1>&#39;djang_session_id&#39;</span>
<span class=n>SESSION_COOKIE_AGE</span> <span class=o>=</span> <span class=mi>1209600</span>
<span class=c1># å¦‚æœè®¾ç½®ä¸ºTrueï¼ŒCookieå°±æ˜¯åŸºäºæµè§ˆå™¨çª—å£çš„Cookieï¼Œä¸ä¼šæŒä¹…åŒ–</span>
<span class=n>SESSION_EXPIRE_AT_BROWSER_CLOSE</span> <span class=o>=</span> <span class=kc>False</span> 
<span class=n>SESSION_SAVE_EVERY_REQUEST</span> <span class=o>=</span> <span class=kc>False</span>
<span class=n>SESSION_COOKIE_HTTPONLY</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></td></tr></table></div></div></div></li><li><p>sessionçš„å±æ€§å’Œæ–¹æ³•ã€‚</p><ul><li><code>session_key</code> / <code>session_data</code> / <code>expire_date</code></li><li><code>__getitem__</code> / <code>__setitem__</code> / <code>__delitem__</code> / <code>__contains__</code></li><li><code>set_expiry()</code> / <code>get_expiry_age()</code> / <code>get_expiry_date()</code> - è®¾ç½®/è·å–ä¼šè¯è¶…æœŸæ—¶é—´</li><li><code>flush()</code> - é”€æ¯ä¼šè¯</li><li><code>set_test_cookie()</code> / <code>test_cookie_worked()</code> / <code>delete_test_cookie()</code> - æµ‹è¯•æµè§ˆå™¨æ˜¯å¦æ”¯æŒCookieï¼ˆæç¤ºç”¨æˆ·å¦‚æœæµè§ˆå™¨ç¦ç”¨Cookieå¯èƒ½ä¼šå½±å“ç½‘ç«™çš„ä½¿ç”¨ï¼‰</li></ul></li><li><p>sessionçš„åºåˆ—åŒ–ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>SESSION_SERIALIZER</span> <span class=o>=</span> <span class=s1>&#39;django.contrib.sessions.serializers.JSONSerializer&#39;</span>
</code></pre></td></tr></table></div></div></div><ul><li><p>JSONSerializerï¼ˆ1.6åŠä»¥åé»˜è®¤ï¼‰- å¦‚æœæƒ³å°†è‡ªå®šä¹‰çš„å¯¹è±¡æ”¾åˆ°sessionä¸­ï¼Œä¼šé‡åˆ°â€œObject of type 'XXX' is not JSON serializableâ€çš„é—®é¢˜ï¼ˆå¦‚æœé…ç½®ä½¿ç”¨Redisä¿å­˜Sessionï¼Œdjango-redisä½¿ç”¨äº†Pickleåºåˆ—åŒ–ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¸å­˜åœ¨äº†ï¼‰ã€‚</p></li><li><p>PickleSerializerï¼ˆ1.6ä»¥å‰çš„é»˜è®¤ï¼‰- å› ä¸ºå®‰å…¨é—®é¢˜ä¸æ¨èä½¿ç”¨ï¼Œä½†æ˜¯åªè¦ä¸å»ååºåˆ—åŒ–ç”¨æˆ·æ„é€ çš„æ¶æ„çš„Payloadå…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé£é™©ã€‚å…³äºè¿™ç§æ–¹å¼çš„å®‰å…¨æ¼æ´ï¼Œå¯ä»¥å‚è€ƒã€Š<a href=http://www.polaris-lab.com/index.php/archives/178/ target=_blank rel=noopener>Python Pickleçš„ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´å®è·µå’ŒPayloadæ„é€ ã€‹</a>ä¸€æ–‡æˆ–ã€Šè½¯ä»¶æ¶æ„-Pythonè¯­è¨€å®ç°ã€‹ä¸Šå…³äºè¿™ä¸ªé—®é¢˜çš„è®²è§£ã€‚</p><blockquote><p>è¯´æ˜ï¼šå¦‚æœä½¿ç”¨äº†django_redisæ•´åˆRedisä½œä¸ºsessionçš„å­˜å‚¨å¼•æ“ï¼Œé‚£ä¹ˆç”±äºdjango_redisåˆå°è£…äº†ä¸€ä¸ªPickleSerializeræ¥æä¾›åºåˆ—åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨ä¸Šè¿°çš„é—®é¢˜ï¼Œä¸”Redisä¸­ä¿å­˜çš„valueæ˜¯pickleåºåˆ—åŒ–ä¹‹åçš„ç»“æœã€‚</p></blockquote></li></ul></li></ol><h3 id=ç¼“å­˜><a href=#ç¼“å­˜ class=anchor-link>#</a>ç¼“å­˜</h3><h4 id=é…ç½®ç¼“å­˜><a href=#é…ç½®ç¼“å­˜ class=anchor-link>#</a>é…ç½®ç¼“å­˜</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>CACHES</span> <span class=o>=</span> <span class=p>{</span>
    <span class=c1># é»˜è®¤ç¼“å­˜</span>
    <span class=s1>&#39;default&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.cache.RedisCache&#39;</span><span class=p>,</span>
        <span class=s1>&#39;LOCATION&#39;</span><span class=p>:</span> <span class=p>[</span>
            <span class=s1>&#39;redis://1.2.3.4:6379/0&#39;</span><span class=p>,</span>
        <span class=p>],</span>
        <span class=s1>&#39;KEY_PREFIX&#39;</span><span class=p>:</span> <span class=s1>&#39;teamproject&#39;</span><span class=p>,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;CLIENT_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.client.DefaultClient&#39;</span><span class=p>,</span>
            <span class=s1>&#39;CONNECTION_POOL_KWARGS&#39;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s1>&#39;max_connections&#39;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=s1>&#39;yourpass&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=c1># é¡µé¢ç¼“å­˜</span>
    <span class=s1>&#39;page&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.cache.RedisCache&#39;</span><span class=p>,</span>
        <span class=s1>&#39;LOCATION&#39;</span><span class=p>:</span> <span class=p>[</span>
            <span class=s1>&#39;redis://1.2.3.4:6379/1&#39;</span><span class=p>,</span>
        <span class=p>],</span>
        <span class=s1>&#39;KEY_PREFIX&#39;</span><span class=p>:</span> <span class=s1>&#39;teamproject:page&#39;</span><span class=p>,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;CLIENT_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.client.DefaultClient&#39;</span><span class=p>,</span>
            <span class=s1>&#39;CONNECTION_POOL_KWARGS&#39;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s1>&#39;max_connections&#39;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=s1>&#39;yourpass&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=c1># ä¼šè¯ç¼“å­˜</span>
    <span class=s1>&#39;session&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.cache.RedisCache&#39;</span><span class=p>,</span>
        <span class=s1>&#39;LOCATION&#39;</span><span class=p>:</span> <span class=p>[</span>
            <span class=s1>&#39;redis://1.2.3.4:6379/2&#39;</span><span class=p>,</span>
        <span class=p>],</span>
        <span class=s1>&#39;KEY_PREFIX&#39;</span><span class=p>:</span> <span class=s1>&#39;teamproject:session&#39;</span><span class=p>,</span>
        <span class=s1>&#39;TIMEOUT&#39;</span><span class=p>:</span> <span class=mi>1209600</span><span class=p>,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;CLIENT_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.client.DefaultClient&#39;</span><span class=p>,</span>
            <span class=s1>&#39;CONNECTION_POOL_KWARGS&#39;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s1>&#39;max_connections&#39;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=s1>&#39;yourpass&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=c1># æ¥å£æ•°æ®ç¼“å­˜</span>
    <span class=s1>&#39;api&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.cache.RedisCache&#39;</span><span class=p>,</span>
        <span class=s1>&#39;LOCATION&#39;</span><span class=p>:</span> <span class=p>[</span>
            <span class=s1>&#39;redis://1.2.3.4:6379/3&#39;</span><span class=p>,</span>
        <span class=p>],</span>
        <span class=s1>&#39;KEY_PREFIX&#39;</span><span class=p>:</span> <span class=s1>&#39;teamproject:api&#39;</span><span class=p>,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;CLIENT_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;django_redis.client.DefaultClient&#39;</span><span class=p>,</span>
            <span class=s1>&#39;CONNECTION_POOL_KWARGS&#39;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s1>&#39;max_connections&#39;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=s1>&#39;yourpass&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>},</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šé€šè¿‡Redisåº•å±‚æä¾›çš„å¤šä¸ªæ•°æ®åº“æ¥éš”ç¦»ç¼“å­˜æ•°æ®æœ‰åŠ©äºç¼“å­˜æ•°æ®çš„ç®¡ç†ã€‚å¦‚æœé…ç½®äº†Redisçš„ä¸»ä»å¤åˆ¶ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰ï¼ŒLOCATIONåˆ—è¡¨ä¸­å¯ä»¥é…ç½®å¤šä¸ªRedisè¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¢«è§†ä¸ºmasterç”¨æ¥è¿›è¡Œå†™æ“ä½œï¼Œåé¢çš„è¢«è§†ä¸ºslaveç”¨æ¥è¿›è¡Œè¯»æ“ä½œã€‚</p></blockquote><h4 id=å…¨ç«™ç¼“å­˜><a href=#å…¨ç«™ç¼“å­˜ class=anchor-link>#</a>å…¨ç«™ç¼“å­˜</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>MIDDLEWARE_CLASSES</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;django.middleware.cache.UpdateCacheMiddleware&#39;</span><span class=p>,</span>
    <span class=o>...</span>
    <span class=s1>&#39;django.middleware.common.CommonMiddleware&#39;</span><span class=p>,</span>
    <span class=o>...</span>
    <span class=s1>&#39;django.middleware.cache.FetchFromCacheMiddleware&#39;</span><span class=p>,</span>
<span class=p>]</span>

<span class=n>CACHE_MIDDLEWARE_ALIAS</span> <span class=o>=</span> <span class=s1>&#39;default&#39;</span>
<span class=n>CACHE_MIDDLEWARE_SECONDS</span> <span class=o>=</span> <span class=mi>300</span>
<span class=n>CACHE_MIDDLEWARE_KEY_PREFIX</span> <span class=o>=</span> <span class=s1>&#39;djang:cache&#39;</span>
</code></pre></td></tr></table></div></div></div><h4 id=è§†å›¾å±‚ç¼“å­˜><a href=#è§†å›¾å±‚ç¼“å­˜ class=anchor-link>#</a>è§†å›¾å±‚ç¼“å­˜</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django.views.decorators.cache</span> <span class=kn>import</span> <span class=n>cache_page</span>
<span class=kn>from</span> <span class=nn>django.views.decorators.vary</span> <span class=kn>import</span> <span class=n>vary_on_cookie</span>


<span class=nd>@cache_page</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>60</span> <span class=o>*</span> <span class=mi>15</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=s1>&#39;page&#39;</span><span class=p>)</span>
<span class=nd>@vary_on_cookie</span>
<span class=k>def</span> <span class=nf>my_view</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=k>pass</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django.views.decorators.cache</span> <span class=kn>import</span> <span class=n>cache_page</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>url</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;^foo/([0-9]{1,2})/$&#39;</span><span class=p>,</span> <span class=n>cache_page</span><span class=p>(</span><span class=mi>60</span> <span class=o>*</span> <span class=mi>15</span><span class=p>)(</span><span class=n>my_view</span><span class=p>)),</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div><h4 id=å…¶ä»–å†…å®¹><a href=#å…¶ä»–å†…å®¹ class=anchor-link>#</a>å…¶ä»–å†…å®¹</h4><ol><li><p>æ¨¡æ¿ç‰‡æ®µç¼“å­˜ã€‚</p><ul><li><code>{% load cache %}</code></li><li><code>{% cache %}</code> / <code>{% endcache %}</code></li></ul></li><li><p>ä½¿ç”¨åº•å±‚APIè®¿é—®ç¼“å­˜ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.core.cache</span> <span class=kn>import</span> <span class=n>cache</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s1>&#39;my_key&#39;</span><span class=p>,</span> <span class=s1>&#39;hello, world!&#39;</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;my_key&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.core.cache</span> <span class=kn>import</span> <span class=n>caches</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache1</span> <span class=o>=</span> <span class=n>caches</span><span class=p>[</span><span class=s1>&#39;page&#39;</span><span class=p>]</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache2</span> <span class=o>=</span> <span class=n>caches</span><span class=p>[</span><span class=s1>&#39;page&#39;</span><span class=p>]</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache1</span> <span class=ow>is</span> <span class=n>cache2</span>
<span class=kc>True</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache3</span> <span class=o>=</span> <span class=n>caches</span><span class=p>[</span><span class=s1>&#39;session&#39;</span><span class=p>]</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cache2</span> <span class=ow>is</span> <span class=n>cache3</span>
<span class=kc>False</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django_redis</span> <span class=kn>import</span> <span class=n>get_redis_connection</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>redis_client</span> <span class=o>=</span> <span class=n>get_redis_connection</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>hgetall</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div></li></ol><h3 id=æ—¥å¿—><a href=#æ—¥å¿— class=anchor-link>#</a>æ—¥å¿—</h3><h4 id=æ—¥å¿—çº§åˆ«><a href=#æ—¥å¿—çº§åˆ« class=anchor-link>#</a>æ—¥å¿—çº§åˆ«</h4><p>NOTSET &lt; DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</p><h4 id=æ—¥å¿—é…ç½®><a href=#æ—¥å¿—é…ç½® class=anchor-link>#</a>æ—¥å¿—é…ç½®</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>LOGGING</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
    <span class=s1>&#39;disable_existing_loggers&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
    <span class=c1># é…ç½®æ—¥å¿—æ ¼å¼åŒ–å™¨</span>
    <span class=s1>&#39;formatters&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;simple&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;format&#39;</span><span class=p>:</span> <span class=s1>&#39;</span><span class=si>%(asctime)s</span><span class=s1> </span><span class=si>%(module)s</span><span class=s1>.</span><span class=si>%(funcName)s</span><span class=s1>: </span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>,</span>
            <span class=s1>&#39;datefmt&#39;</span><span class=p>:</span> <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M:%S&#39;</span><span class=p>,</span>
        <span class=p>},</span>
        <span class=s1>&#39;verbose&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;format&#39;</span><span class=p>:</span> <span class=s1>&#39;</span><span class=si>%(asctime)s</span><span class=s1> </span><span class=si>%(levelname)s</span><span class=s1> [</span><span class=si>%(process)d</span><span class=s1>-</span><span class=si>%(threadName)s</span><span class=s1>] &#39;</span>
                      <span class=s1>&#39;</span><span class=si>%(module)s</span><span class=s1>.</span><span class=si>%(funcName)s</span><span class=s1> line </span><span class=si>%(lineno)d</span><span class=s1>: </span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>,</span>
            <span class=s1>&#39;datefmt&#39;</span><span class=p>:</span> <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M:%S&#39;</span><span class=p>,</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=c1># é…ç½®æ—¥å¿—è¿‡æ»¤å™¨</span>
    <span class=s1>&#39;filters&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;require_debug_true&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;()&#39;</span><span class=p>:</span> <span class=s1>&#39;django.utils.log.RequireDebugTrue&#39;</span><span class=p>,</span>
        <span class=p>},</span>
    <span class=p>},</span>
    <span class=c1># é…ç½®æ—¥å¿—å¤„ç†å™¨</span>
    <span class=s1>&#39;handlers&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;console&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;logging.StreamHandler&#39;</span><span class=p>,</span>
            <span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=s1>&#39;DEBUG&#39;</span><span class=p>,</span>
            <span class=s1>&#39;filters&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;require_debug_true&#39;</span><span class=p>],</span>
            <span class=s1>&#39;formatter&#39;</span><span class=p>:</span> <span class=s1>&#39;simple&#39;</span><span class=p>,</span>
        <span class=p>},</span>
        <span class=s1>&#39;file1&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;logging.handlers.TimedRotatingFileHandler&#39;</span><span class=p>,</span>
            <span class=s1>&#39;filename&#39;</span><span class=p>:</span> <span class=s1>&#39;access.log&#39;</span><span class=p>,</span>
            <span class=s1>&#39;when&#39;</span><span class=p>:</span> <span class=s1>&#39;W0&#39;</span><span class=p>,</span>
            <span class=s1>&#39;backupCount&#39;</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span>
            <span class=s1>&#39;formatter&#39;</span><span class=p>:</span> <span class=s1>&#39;simple&#39;</span><span class=p>,</span>
            <span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=s1>&#39;INFO&#39;</span><span class=p>,</span>
        <span class=p>},</span>
        <span class=s1>&#39;file2&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;class&#39;</span><span class=p>:</span> <span class=s1>&#39;logging.handlers.TimedRotatingFileHandler&#39;</span><span class=p>,</span>
            <span class=s1>&#39;filename&#39;</span><span class=p>:</span> <span class=s1>&#39;error.log&#39;</span><span class=p>,</span>
            <span class=s1>&#39;when&#39;</span><span class=p>:</span> <span class=s1>&#39;D&#39;</span><span class=p>,</span>
            <span class=s1>&#39;backupCount&#39;</span><span class=p>:</span> <span class=mi>31</span><span class=p>,</span>
            <span class=s1>&#39;formatter&#39;</span><span class=p>:</span> <span class=s1>&#39;verbose&#39;</span><span class=p>,</span>
            <span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=s1>&#39;WARNING&#39;</span><span class=p>,</span>
        <span class=p>},</span>
    <span class=p>},</span>
    <span class=c1># é…ç½®æ—¥å¿—å™¨</span>
    <span class=s1>&#39;loggers&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;django&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;handlers&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;console&#39;</span><span class=p>,</span> <span class=s1>&#39;file1&#39;</span><span class=p>,</span> <span class=s1>&#39;file2&#39;</span><span class=p>],</span>
            <span class=s1>&#39;propagate&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
            <span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=s1>&#39;DEBUG&#39;</span><span class=p>,</span>
        <span class=p>},</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><p><a href=https://docs.djangoproject.com/zh-hans/2.0/topics/logging/#s-examples target=_blank rel=noopener>æ—¥å¿—é…ç½®å®˜æ–¹ç¤ºä¾‹</a>ã€‚</p><h4 id=æ—¥å¿—åˆ†æ><a href=#æ—¥å¿—åˆ†æ class=anchor-link>#</a>æ—¥å¿—åˆ†æ</h4><ol><li><p>Linuxç›¸å…³å‘½ä»¤ï¼šheadã€tailã€grepã€awkã€uniqã€sort</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>tail -10000 access.log <span class=p>|</span> awk <span class=s1>&#39;{print $1}&#39;</span> <span class=p>|</span> uniq -c <span class=p>|</span> sort -r
</code></pre></td></tr></table></div></div></div></li><li><p>å®æ—¶æ—¥å¿—æ–‡ä»¶åˆ†æï¼šPython + æ­£åˆ™è¡¨è¾¾å¼ + Crontab</p></li><li><p><a href=https://github.com/jkklee/web_log_analyse target=_blank rel=noopener>ã€ŠPythonæ—¥å¿—åˆ†æå·¥å…·ã€‹</a>ã€‚</p></li><li><p><a href=https://www.ibm.com/developerworks/cn/opensource/os-cn-elk/index.html target=_blank rel=noopener>ã€Šé›†ä¸­å¼æ—¥å¿—ç³»ç»ŸELKã€‹</a>ã€‚</p><ul><li>ElasticSearchï¼šæœç´¢å¼•æ“ï¼Œå®ç°å…¨æ–‡æ£€ç´¢ã€‚</li><li>Logstashï¼šè´Ÿè´£ä»æŒ‡å®šèŠ‚ç‚¹æ”¶é›†æ—¥å¿—ã€‚</li><li>Kibanaï¼šæ—¥å¿—å¯è§†åŒ–å·¥å…·ã€‚</li></ul></li><li><p>å¤§æ•°æ®æ—¥å¿—å¤„ç†ï¼šFlume+Kafkaæ—¥å¿—é‡‡é›†ã€Storm / Sparkå®æ—¶æ•°æ®å¤„ç†ã€Impalaå®æ—¶æŸ¥è¯¢ã€‚</p></li></ol><h3 id=restful><a href=#restful class=anchor-link>#</a>RESTful</h3><p>é—®é¢˜1ï¼šRESTfulæ¶æ„åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆURLå…·æœ‰è‡ªæè¿°æ€§ã€èµ„æºè¡¨è¿°ä¸è§†å›¾çš„è§£è€¦å’Œã€äº’æ“ä½œæ€§åˆ©ç”¨æ„å»ºå¾®æœåŠ¡ä»¥åŠé›†æˆç¬¬ä¸‰æ–¹ç³»ç»Ÿã€æ— çŠ¶æ€æ€§æé«˜æ°´å¹³æ‰©å±•èƒ½åŠ›ï¼‰</p><p>é—®é¢˜2ï¼šé¡¹ç›®åœ¨ä½¿ç”¨RESTfulæ¶æ„æ—¶æœ‰æ²¡æœ‰é‡åˆ°ä¸€äº›é—®é¢˜æˆ–éšæ‚£ï¼Ÿï¼ˆå¯¹èµ„æºè®¿é—®çš„é™åˆ¶ã€èµ„æºä»å±å…³ç³»æ£€æŸ¥ã€é¿å…æ³„éœ²ä¸šåŠ¡ä¿¡æ¯ã€é˜²èŒƒå¯èƒ½çš„æ”»å‡»ï¼‰</p><blockquote><p>è¡¥å……ï¼šä¸‹é¢çš„å‡ ä¸ªå’Œå®‰å…¨æ€§ç›¸å…³çš„å“åº”å¤´åœ¨å‰é¢è®²ä¸­é—´ä»¶çš„æ—¶å€™æåˆ°è¿‡çš„ã€‚</p><ul><li>X-Frame-Options: DENY</li><li>X-Content-Type-Options: nosniff</li><li>X-XSS-Protection: 1; mode=block;</li><li>StrictÂ­-Transport-Â­Security: max-age=31536000;</li></ul></blockquote><p>é—®é¢˜3ï¼šå¦‚ä½•ä¿æŠ¤APIä¸­çš„æ•æ„Ÿä¿¡æ¯ä»¥åŠé˜²èŒƒé‡æ”¾æ”»å‡»ï¼Ÿï¼ˆæ‘˜è¦å’Œä»¤ç‰Œï¼‰</p><p>æ¨èé˜…è¯»ï¼š<a href=https://help.aliyun.com/knowledge_detail/50041.html target=_blank rel=noopener>ã€Šå¦‚ä½•æœ‰æ•ˆé˜²æ­¢APIçš„é‡æ”¾æ”»å‡»ã€‹</a>ã€‚</p><h4 id=ä½¿ç”¨djangorestframework><a href=#ä½¿ç”¨djangorestframework class=anchor-link>#</a>ä½¿ç”¨djangorestframework</h4><p>å®‰è£…djangorestfrmeworkï¼ˆä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œä»¥ä¸‹ç»Ÿä¸€ç®€ç§°ä¸ºDRFï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install djangorestframework
</code></pre></td></tr></table></div></div></div><p>é…ç½®DRFã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    
    <span class=s1>&#39;rest_framework&#39;</span><span class=p>,</span>
    
<span class=p>]</span>

<span class=n>REST_FRAMEWORK</span> <span class=o>=</span> <span class=p>{</span>
    <span class=c1># é…ç½®é»˜è®¤é¡µé¢å¤§å°</span>
    <span class=s1>&#39;PAGE_SIZE&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
    <span class=c1># é…ç½®é»˜è®¤çš„åˆ†é¡µç±»</span>
    <span class=s1>&#39;DEFAULT_PAGINATION_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;rest_framework.pagination.PageNumberPagination&#39;</span><span class=p>,</span>
    <span class=c1># é…ç½®å¼‚å¸¸å¤„ç†å™¨</span>
    <span class=c1># &#39;EXCEPTION_HANDLER&#39;: &#39;api.exceptions.exception_handler&#39;,</span>
    <span class=c1># é…ç½®é»˜è®¤è§£æå™¨</span>
    <span class=c1># &#39;DEFAULT_PARSER_CLASSES&#39;: (</span>
    <span class=c1>#     &#39;rest_framework.parsers.JSONParser&#39;,</span>
    <span class=c1>#     &#39;rest_framework.parsers.FormParser&#39;,</span>
    <span class=c1>#     &#39;rest_framework.parsers.MultiPartParser&#39;,</span>
    <span class=c1># ),</span>
    <span class=c1># é…ç½®é»˜è®¤é™æµç±»</span>
    <span class=c1># &#39;DEFAULT_THROTTLE_CLASSES&#39;: (),</span>
    <span class=c1># é…ç½®é»˜è®¤æˆæƒç±»</span>
    <span class=c1># &#39;DEFAULT_PERMISSION_CLASSES&#39;: (</span>
    <span class=c1>#     &#39;rest_framework.permissions.IsAuthenticated&#39;,</span>
    <span class=c1># ),</span>
    <span class=c1># é…ç½®é»˜è®¤è®¤è¯ç±»</span>
    <span class=c1># &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (</span>
    <span class=c1>#     &#39;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#39;,</span>
    <span class=c1># ),</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><h4 id=ç¼–å†™åºåˆ—åŒ–å™¨><a href=#ç¼–å†™åºåˆ—åŒ–å™¨ class=anchor-link>#</a>ç¼–å†™åºåˆ—åŒ–å™¨</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>rest_framework</span> <span class=kn>import</span> <span class=n>serializers</span>
<span class=kn>from</span> <span class=nn>rest_framework.serializers</span> <span class=kn>import</span> <span class=n>ModelSerializer</span>

<span class=kn>from</span> <span class=nn>common.models</span> <span class=kn>import</span> <span class=n>District</span><span class=p>,</span> <span class=n>HouseType</span><span class=p>,</span> <span class=n>Estate</span><span class=p>,</span> <span class=n>Agent</span>


<span class=k>class</span> <span class=nc>DistrictSerializer</span><span class=p>(</span><span class=n>ModelSerializer</span><span class=p>):</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>model</span> <span class=o>=</span> <span class=n>District</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;distid&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>HouseTypeSerializer</span><span class=p>(</span><span class=n>ModelSerializer</span><span class=p>):</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>model</span> <span class=o>=</span> <span class=n>HouseType</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=s1>&#39;__all__&#39;</span>


<span class=k>class</span> <span class=nc>AgentSerializer</span><span class=p>(</span><span class=n>ModelSerializer</span><span class=p>):</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>model</span> <span class=o>=</span> <span class=n>Agent</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;agentid&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;tel&#39;</span><span class=p>,</span> <span class=s1>&#39;servstar&#39;</span><span class=p>,</span> <span class=s1>&#39;certificated&#39;</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>EstateSerializer</span><span class=p>(</span><span class=n>ModelSerializer</span><span class=p>):</span>
    <span class=n>district</span> <span class=o>=</span> <span class=n>serializers</span><span class=o>.</span><span class=n>SerializerMethodField</span><span class=p>()</span>
    <span class=n>agents</span> <span class=o>=</span> <span class=n>serializers</span><span class=o>.</span><span class=n>SerializerMethodField</span><span class=p>()</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span> <span class=nf>get_agents</span><span class=p>(</span><span class=n>estate</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>AgentSerializer</span><span class=p>(</span><span class=n>estate</span><span class=o>.</span><span class=n>agents</span><span class=p>,</span> <span class=n>many</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span> <span class=nf>get_district</span><span class=p>(</span><span class=n>estate</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>DistrictSerializer</span><span class=p>(</span><span class=n>estate</span><span class=o>.</span><span class=n>district</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>model</span> <span class=o>=</span> <span class=n>Estate</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=s1>&#39;__all__&#39;</span>
</code></pre></td></tr></table></div></div></div><h4 id=æ–¹æ³•1ä½¿ç”¨è£…é¥°å™¨><a href=#æ–¹æ³•1ä½¿ç”¨è£…é¥°å™¨ class=anchor-link>#</a>æ–¹æ³•1ï¼šä½¿ç”¨è£…é¥°å™¨</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@api_view</span><span class=p>([</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=nd>@cache_page</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=s1>&#39;api&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>provinces</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>District</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>parent__isnull</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>serializer</span> <span class=o>=</span> <span class=n>DistrictSerializer</span><span class=p>(</span><span class=n>queryset</span><span class=p>,</span> <span class=n>many</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>Response</span><span class=p>(</span><span class=n>serializer</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>


<span class=nd>@api_view</span><span class=p>([</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=nd>@cache_page</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=s1>&#39;api&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>cities</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>provid</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>District</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>parent__distid</span><span class=o>=</span><span class=n>provid</span><span class=p>)</span>
    <span class=n>serializer</span> <span class=o>=</span> <span class=n>DistrictSerializer</span><span class=p>(</span><span class=n>queryset</span><span class=p>,</span> <span class=n>many</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>Response</span><span class=p>(</span><span class=n>serializer</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;districts/&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>provinces</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;districts&#39;</span><span class=p>),</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;districts/&lt;int:provid&gt;/&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>cities</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;cities&#39;</span><span class=p>),</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šä¸Šé¢ä½¿ç”¨äº†Djangoè‡ªå¸¦çš„è§†å›¾è£…é¥°å™¨ï¼ˆ@cache_pageï¼‰æ¥å®ç°å¯¹APIæ¥å£è¿”å›æ•°æ®çš„ç¼“å­˜ã€‚</p></blockquote><h4 id=æ–¹æ³•2ä½¿ç”¨apiviewåŠå…¶å­ç±»><a href=#æ–¹æ³•2ä½¿ç”¨apiviewåŠå…¶å­ç±» class=anchor-link>#</a>æ–¹æ³•2ï¼šä½¿ç”¨APIViewåŠå…¶å­ç±»</h4><p>æ›´å¥½çš„å¤ç”¨ä»£ç ï¼Œä¸è¦é‡â€œå¤å‘æ˜è½®å­â€ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>HouseTypeApiView</span><span class=p>(</span><span class=n>CacheResponseMixin</span><span class=p>,</span> <span class=n>ListAPIView</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>HouseType</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>HouseTypeSerializer</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;housetypes/&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>HouseTypeApiView</span><span class=o>.</span><span class=n>as_view</span><span class=p>(),</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;housetypes&#39;</span><span class=p>),</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šä¸Šé¢ä½¿ç”¨äº†drf_extensionsæä¾›çš„CacheResponseMixinæ··å…¥ç±»å®ç°äº†å¯¹æ¥å£æ•°æ®çš„ç¼“å­˜ã€‚å¦‚æœé‡å†™äº†è·å–æ•°æ®çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨drf_extensionsæä¾›çš„@cache_responseæ¥å®ç°å¯¹æ¥å£æ•°æ®çš„ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ç”¨è‡ªå®šä¹‰çš„å‡½æ•°æ¥ç”Ÿæˆç¼“å­˜ä¸­çš„keyã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ªé€‰æ‹©å°±æ˜¯é€šè¿‡Djangoæä¾›çš„@method_decoratorè£…é¥°å™¨ï¼Œå°†@cache_pageè£…é¥°å™¨å¤„ç†ä¸ºè£…é¥°æ–¹æ³•çš„è£…é¥°å™¨ï¼Œè¿™æ ·ä¹Ÿèƒ½æä¾›ä½¿ç”¨ç¼“å­˜æœåŠ¡ã€‚</p></blockquote><p><code>drf-extensions</code>é…ç½®å¦‚ä¸‹æ‰€ç¤ºã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=c1># é…ç½®DRFæ‰©å±•æ¥æ”¯æŒç¼“å­˜APIæ¥å£è°ƒç”¨ç»“æœ</span>
<span class=n>REST_FRAMEWORK_EXTENSIONS</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;DEFAULT_CACHE_RESPONSE_TIMEOUT&#39;</span><span class=p>:</span> <span class=mi>300</span><span class=p>,</span>
    <span class=s1>&#39;DEFAULT_USE_CACHE&#39;</span><span class=p>:</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span>
    <span class=c1># é…ç½®é»˜è®¤ç¼“å­˜å•ä¸ªå¯¹è±¡çš„keyå‡½æ•°</span>
    <span class=s1>&#39;DEFAULT_OBJECT_CACHE_KEY_FUNC&#39;</span><span class=p>:</span> <span class=s1>&#39;rest_framework_extensions.utils.default_object_cache_key_func&#39;</span><span class=p>,</span>
    <span class=c1># é…ç½®é»˜è®¤ç¼“å­˜å¯¹è±¡åˆ—è¡¨çš„keyå‡½æ•°</span>
    <span class=s1>&#39;DEFAULT_LIST_CACHE_KEY_FUNC&#39;</span><span class=p>:</span> <span class=s1>&#39;rest_framework_extensions.utils.default_list_cache_key_func&#39;</span><span class=p>,</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><h4 id=æ–¹æ³•3ä½¿ç”¨viewsetåŠå…¶å­ç±»><a href=#æ–¹æ³•3ä½¿ç”¨viewsetåŠå…¶å­ç±» class=anchor-link>#</a>æ–¹æ³•3ï¼šä½¿ç”¨ViewSetåŠå…¶å­ç±»</h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>HouseTypeViewSet</span><span class=p>(</span><span class=n>CacheResponseMixin</span><span class=p>,</span> <span class=n>viewsets</span><span class=o>.</span><span class=n>ModelViewSet</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>HouseType</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>HouseTypeSerializer</span>
    <span class=n>pagination_class</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>router</span> <span class=o>=</span> <span class=n>DefaultRouter</span><span class=p>()</span>
<span class=n>router</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=s1>&#39;housetypes&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>HouseTypeViewSet</span><span class=p>)</span>

<span class=n>urlpatterns</span> <span class=o>+=</span> <span class=n>router</span><span class=o>.</span><span class=n>urls</span>
</code></pre></td></tr></table></div></div></div><p>djangorestframeworkæä¾›äº†åŸºäºBootstrapå®šåˆ¶çš„é¡µé¢æ¥æ˜¾ç¤ºæ¥å£è¿”å›çš„JSONæ•°æ®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<a href=https://www.getpostman.com/ target=_blank rel=noopener>POSTMAN</a>è¿™æ ·çš„å·¥å…·å¯¹APIæ¥å£è¿›è¡Œæµ‹è¯•ã€‚</p><h4 id=è¡¥å……è¯´æ˜><a href=#è¡¥å……è¯´æ˜ class=anchor-link>#</a>è¡¥å……è¯´æ˜</h4><p>åœ¨è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹è·Ÿå‰ç«¯ç›¸å…³çš„å‡ ä¸ªé—®é¢˜ã€‚</p><p>é—®é¢˜1ï¼šå¦‚ä½•è®©æµè§ˆå™¨èƒ½å¤Ÿå‘èµ·DELETE/PUT/PATCHï¼Ÿ</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>&gt;</span>
    
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;_method&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;delete&#34;</span><span class=p>&gt;</span>
    
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span> <span class=ow>and</span> <span class=s1>&#39;_method&#39;</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>:</span>
    <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>[</span><span class=s1>&#39;_method&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span>
        <span class=s1>&#39;url&#39;</span><span class=o>:</span> <span class=s1>&#39;/api/provinces&#39;</span><span class=p>,</span>
        <span class=s1>&#39;type&#39;</span><span class=o>:</span> <span class=s1>&#39;put&#39;</span><span class=p>,</span>
        <span class=s1>&#39;data&#39;</span><span class=o>:</span> <span class=p>{},</span>
        <span class=s1>&#39;dataType&#39;</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span>
        <span class=s1>&#39;success&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>json</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// Web = æ ‡ç­¾(å†…å®¹) + CSS(æ˜¾ç¤º) + JS(è¡Œä¸º)
</span><span class=c1></span>            <span class=c1>// JavaScript = ES + BOM + DOM
</span><span class=c1></span>            <span class=c1>// DOMæ“ä½œå®ç°é¡µé¢çš„å±€éƒ¨åˆ·æ–°
</span><span class=c1></span>        <span class=p>},</span>
        <span class=s1>&#39;error&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{}</span>
    <span class=p>});</span>
    <span class=nx>$</span><span class=p>.</span><span class=nx>getJSON</span><span class=p>(</span><span class=s1>&#39;/api/provinces&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>json</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// DOMæ“ä½œå®ç°é¡µé¢çš„å±€éƒ¨åˆ·æ–°
</span><span class=c1></span>    <span class=p>});</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><p>é—®é¢˜2ï¼šå¦‚ä½•è§£å†³å¤šä¸ªJavaScriptåº“ä¹‹é—´æŸä¸ªå®šä¹‰ï¼ˆå¦‚$å‡½æ•°ï¼‰å†²çªçš„é—®é¢˜ï¼Ÿ</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/abc.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=c1>// $å·²ç»è¢«ååŠ è½½çš„JavaScriptåº“å ç”¨äº†
</span><span class=c1></span>    <span class=c1>// ä½†æ˜¯å¯ä»¥ç›´æ¥ç”¨ç»‘å®šåœ¨windowå¯¹è±¡ä¸Šçš„jQueryå»ä»£æ›¿$
</span><span class=c1></span>    <span class=nx>jQuery</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>jQuery</span><span class=p>(</span><span class=s1>&#39;#okBtn&#39;</span><span class=p>).</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{});</span>
    <span class=p>});</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/abc.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=c1>// å°†$è®©å‡ºç»™å…¶ä»–çš„JavaScriptåº“ä½¿ç”¨
</span><span class=c1></span>	<span class=nx>jQuery</span><span class=p>.</span><span class=nx>noConflict</span><span class=p>();</span>
	<span class=nx>jQuery</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>jQuery</span><span class=p>(</span><span class=s1>&#39;#okBtn&#39;</span><span class=p>).</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{});</span>
    <span class=p>});</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><p>é—®é¢˜3ï¼šjQueryå¯¹è±¡ä¸åŸç”ŸDOMå¯¹è±¡ä¹‹é—´å¦‚ä½•è½¬æ¢ï¼Ÿ</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=p>&lt;</span><span class=nt>button</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;okBtn&#34;</span><span class=p>&gt;</span>ç‚¹æˆ‘<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=kd>var</span> <span class=nx>btn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;okBtn&#39;</span><span class=p>);</span>	<span class=c1>// åŸç”ŸJavaScriptå¯¹è±¡(ä½¿ç”¨ç›¸å¯¹éº»çƒ¦)
</span><span class=c1></span>    <span class=kd>var</span> <span class=nx>$btn</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s1>&#39;#okBtn&#39;</span><span class=p>);</span>	<span class=c1>// jQueryå¯¹è±¡(æ‹¥æœ‰æ›´å¤šçš„å±æ€§å’Œæ–¹æ³•è€Œä¸”æ²¡æœ‰æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜)
</span><span class=c1></span>    <span class=nx>$btn</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{});</span>
    <span class=c1>// $(btn)å¯ä»¥å°†åŸç”ŸJavaScriptå¯¹è±¡è½¬æˆjQueryå¯¹è±¡
</span><span class=c1></span>    <span class=c1>// $btn.get(0)æˆ–$btn[0]å¯ä»¥è·å¾—åŸç”Ÿçš„JavaScriptå¯¹è±¡
</span><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></td></tr></table></div></div></div><h4 id=è¿‡æ»¤æ•°æ®><a href=#è¿‡æ»¤æ•°æ® class=anchor-link>#</a>è¿‡æ»¤æ•°æ®</h4><p>å¦‚æœéœ€è¦è¿‡æ»¤æ•°æ®ï¼ˆå¯¹æ•°æ®æ¥å£è®¾ç½®ç­›é€‰æ¡ä»¶ã€æ’åºæ¡ä»¶ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨<code>django-filter</code>ä¸‰æ–¹åº“æ¥å®ç°ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install django-filter
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    
    <span class=s1>&#39;django_filters&#39;</span><span class=p>,</span>

<span class=p>]</span>
<span class=n>REST_FRAMEWORK</span> <span class=o>=</span> <span class=p>{</span>
  	
    <span class=s1>&#39;DEFAULT_FILTER_BACKENDS&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;django_filters.rest_framework.DjangoFilterBackend&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.filters.OrderingFilter&#39;</span><span class=p>,</span>
    <span class=p>),</span>
    
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django.utils.decorators</span> <span class=kn>import</span> <span class=n>method_decorator</span>
<span class=kn>from</span> <span class=nn>django.views.decorators.cache</span> <span class=kn>import</span> <span class=n>cache_page</span>
<span class=kn>from</span> <span class=nn>django_filters.rest_framework</span> <span class=kn>import</span> <span class=n>DjangoFilterBackend</span>
<span class=kn>from</span> <span class=nn>rest_framework.filters</span> <span class=kn>import</span> <span class=n>OrderingFilter</span>
<span class=kn>from</span> <span class=nn>rest_framework.generics</span> <span class=kn>import</span> <span class=n>RetrieveAPIView</span><span class=p>,</span> <span class=n>ListCreateAPIView</span>

<span class=kn>from</span> <span class=nn>api.serializers</span> <span class=kn>import</span> <span class=n>EstateSerializer</span>
<span class=kn>from</span> <span class=nn>common.models</span> <span class=kn>import</span> <span class=n>Estate</span>


<span class=nd>@method_decorator</span><span class=p>(</span><span class=n>decorator</span><span class=o>=</span><span class=n>cache_page</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=n>key_prefix</span><span class=o>=</span><span class=s1>&#39;estates&#39;</span><span class=p>),</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;get&#39;</span><span class=p>)</span>
<span class=k>class</span> <span class=nc>EstateView</span><span class=p>(</span><span class=n>RetrieveAPIView</span><span class=p>,</span> <span class=n>ListCreateAPIView</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>Estate</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;district&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=s1>&#39;agents&#39;</span><span class=p>)</span>
    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>EstateSerializer</span>
    <span class=n>filter_backends</span> <span class=o>=</span> <span class=p>(</span><span class=n>DjangoFilterBackend</span><span class=p>,</span> <span class=n>OrderingFilter</span><span class=p>)</span>
    <span class=n>filter_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;district&#39;</span><span class=p>)</span>
    <span class=n>ordering</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;-hot&#39;</span><span class=p>,</span> <span class=p>)</span>
    <span class=n>ordering_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;hot&#39;</span><span class=p>,</span> <span class=s1>&#39;estateid&#39;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>django_filters</span> <span class=kn>import</span> <span class=n>rest_framework</span> <span class=k>as</span> <span class=n>drf</span>
<span class=kn>from</span> <span class=nn>common.models</span> <span class=kn>import</span> <span class=n>HouseInfo</span>


<span class=k>class</span> <span class=nc>HouseInfoFilter</span><span class=p>(</span><span class=n>drf</span><span class=o>.</span><span class=n>FilterSet</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;è‡ªå®šä¹‰æˆ¿æºæ•°æ®è¿‡æ»¤å™¨&#34;&#34;&#34;</span>

    <span class=n>title</span> <span class=o>=</span> <span class=n>drf</span><span class=o>.</span><span class=n>CharFilter</span><span class=p>(</span><span class=n>lookup_expr</span><span class=o>=</span><span class=s1>&#39;starts&#39;</span><span class=p>)</span>
    <span class=n>dist</span> <span class=o>=</span> <span class=n>drf</span><span class=o>.</span><span class=n>NumberFilter</span><span class=p>(</span><span class=n>field_name</span><span class=o>=</span><span class=s1>&#39;district&#39;</span><span class=p>)</span>
    <span class=n>min_price</span> <span class=o>=</span> <span class=n>drf</span><span class=o>.</span><span class=n>NumberFilter</span><span class=p>(</span><span class=n>field_name</span><span class=o>=</span><span class=s1>&#39;price&#39;</span><span class=p>,</span> <span class=n>lookup_expr</span><span class=o>=</span><span class=s1>&#39;gte&#39;</span><span class=p>)</span>
    <span class=n>max_price</span> <span class=o>=</span> <span class=n>drf</span><span class=o>.</span><span class=n>NumberFilter</span><span class=p>(</span><span class=n>field_name</span><span class=o>=</span><span class=s1>&#39;price&#39;</span><span class=p>,</span> <span class=n>lookup_expr</span><span class=o>=</span><span class=s1>&#39;lte&#39;</span><span class=p>)</span>
    <span class=nb>type</span> <span class=o>=</span> <span class=n>drf</span><span class=o>.</span><span class=n>NumberFilter</span><span class=p>()</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>model</span> <span class=o>=</span> <span class=n>HouseInfo</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;district&#39;</span><span class=p>,</span> <span class=s1>&#39;min_price&#39;</span><span class=p>,</span> <span class=s1>&#39;max_price&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>HouseInfoViewSet</span><span class=p>(</span><span class=n>CacheResponseMixin</span><span class=p>,</span> <span class=n>ReadOnlyModelViewSet</span><span class=p>):</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>HouseInfo</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span> \
        <span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>,</span> <span class=s1>&#39;district&#39;</span><span class=p>,</span> <span class=s1>&#39;estate&#39;</span><span class=p>,</span> <span class=s1>&#39;agent&#39;</span><span class=p>)</span> \
        <span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=s1>&#39;tags&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=s1>&#39;-pubdate&#39;</span><span class=p>)</span>
    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>HouseInfoSerializer</span>
    <span class=n>filter_backends</span> <span class=o>=</span> <span class=p>(</span><span class=n>DjangoFilterBackend</span><span class=p>,</span> <span class=n>OrderingFilter</span><span class=p>)</span>
    <span class=n>filterset_class</span> <span class=o>=</span> <span class=n>HouseInfoFilter</span>
    <span class=n>ordering</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>,)</span>
    <span class=n>ordering_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>,</span> <span class=s1>&#39;area&#39;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div><h4 id=èº«ä»½è®¤è¯><a href=#èº«ä»½è®¤è¯ class=anchor-link>#</a>èº«ä»½è®¤è¯</h4><p>æŸ¥çœ‹DRFä¸­APIViewç±»çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒDRFé»˜è®¤çš„è®¤è¯æ–¹æ¡ˆæ˜¯ <code>DEFAULT_AUTHENTICATION_CLASSES</code>ï¼Œå¦‚æœä¿®æ”¹authentication_classeså°±å¯ä»¥è‡ªè¡Œå®šåˆ¶èº«ä»½è®¤è¯çš„æ–¹æ¡ˆã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>APIView</span><span class=p>(</span><span class=n>View</span><span class=p>):</span>

    <span class=c1># The following policies may be set at either globally, or per-view.</span>
    <span class=n>renderer_classes</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_RENDERER_CLASSES</span>
    <span class=n>parser_classes</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_PARSER_CLASSES</span>
    <span class=n>authentication_classes</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_AUTHENTICATION_CLASSES</span>
    <span class=n>throttle_classes</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_THROTTLE_CLASSES</span>
    <span class=n>permission_classes</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_PERMISSION_CLASSES</span>
    <span class=n>content_negotiation_class</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_CONTENT_NEGOTIATION_CLASS</span>
    <span class=n>metadata_class</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_METADATA_CLASS</span>
    <span class=n>versioning_class</span> <span class=o>=</span> <span class=n>api_settings</span><span class=o>.</span><span class=n>DEFAULT_VERSIONING_CLASS</span>

   	<span class=c1># æ­¤å¤„çœç•¥ä¸‹é¢çš„ä»£ç </span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>DEFAULTS</span> <span class=o>=</span> <span class=p>{</span>
    <span class=c1># Base API policies</span>
    <span class=s1>&#39;DEFAULT_RENDERER_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.renderers.JSONRenderer&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.renderers.BrowsableAPIRenderer&#39;</span><span class=p>,</span>
    <span class=p>),</span>
    <span class=s1>&#39;DEFAULT_PARSER_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.parsers.JSONParser&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.parsers.FormParser&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.parsers.MultiPartParser&#39;</span>
    <span class=p>),</span>
    <span class=s1>&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.authentication.BasicAuthentication&#39;</span>
    <span class=p>),</span>
    <span class=s1>&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.permissions.AllowAny&#39;</span><span class=p>,</span>
    <span class=p>),</span>
    <span class=s1>&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class=p>:</span> <span class=p>(),</span>
    <span class=s1>&#39;DEFAULT_CONTENT_NEGOTIATION_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;rest_framework.negotiation.DefaultContentNegotiation&#39;</span><span class=p>,</span>
    <span class=s1>&#39;DEFAULT_METADATA_CLASS&#39;</span><span class=p>:</span> <span class=s1>&#39;rest_framework.metadata.SimpleMetadata&#39;</span><span class=p>,</span>
    <span class=s1>&#39;DEFAULT_VERSIONING_CLASS&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>

    <span class=c1># æ­¤å¤„çœç•¥ä¸‹é¢çš„ä»£ç </span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><p>è‡ªå®šä¹‰è®¤è¯ç±»ï¼Œç»§æ‰¿<code>BaseAuthentication</code>å¹¶é‡å†™<code>authenticate(self, request)</code>æ–¹æ³•ï¼Œé€šè¿‡è¯·æ±‚ä¸­çš„useridå’Œtokenæ¥ç¡®å®šç”¨æˆ·èº«ä»½ã€‚å¦‚æœè®¤è¯æˆåŠŸï¼Œè¯¥æ–¹æ³•åº”è¿”å›ä¸€ä¸ªäºŒå…ƒç»„ï¼ˆç”¨æˆ·å’Œä»¤ç‰Œçš„ä¿¡æ¯ï¼‰ï¼Œå¦åˆ™äº§ç”Ÿå¼‚å¸¸ã€‚ä¹Ÿå¯ä»¥é‡å†™ <code>authenticate_header(self, request)</code>æ–¹æ³•æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°†ç”¨äº<code>HTTP 401 Unauthorized</code>å“åº”ä¸­çš„WWW-Authenticateå“åº”å¤´çš„å€¼ã€‚å¦‚æœæœªé‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå½“æœªç»èº«ä»½éªŒè¯çš„è¯·æ±‚è¢«æ‹’ç»è®¿é—®æ—¶ï¼Œèº«ä»½éªŒè¯æ–¹æ¡ˆå°†è¿”å›<code>HTTP 403 Forbidden</code>å“åº”ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>MyAuthentication</span><span class=p>(</span><span class=n>BaseAuthentication</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;è‡ªå®šä¹‰ç”¨æˆ·èº«ä»½è®¤è¯ç±»&#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=nf>authenticate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>token</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>GET</span><span class=p>[</span><span class=s1>&#39;token&#39;</span><span class=p>]</span> <span class=ow>or</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>[</span><span class=s1>&#39;token&#39;</span><span class=p>]</span>
            <span class=n>user_token</span> <span class=o>=</span> <span class=n>UserToken</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>token</span><span class=o>=</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
            <span class=k>if</span> <span class=n>user_token</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>user_token</span><span class=o>.</span><span class=n>user</span><span class=p>,</span> <span class=n>user_token</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>AuthenticationFailed</span><span class=p>(</span><span class=s1>&#39;è¯·æä¾›æœ‰æ•ˆçš„ç”¨æˆ·èº«ä»½æ ‡è¯†&#39;</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>AuthenticationFailed</span><span class=p>(</span><span class=s1>&#39;è¯·æä¾›æœ‰æ•ˆçš„ç”¨æˆ·èº«ä»½æ ‡è¯†&#39;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>authenticate_header</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
        <span class=k>pass</span>
</code></pre></td></tr></table></div></div></div><p>ä½¿ç”¨è‡ªå®šä¹‰çš„è®¤è¯ç±»ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>EstateViewSet</span><span class=p>(</span><span class=n>CacheResponseMixin</span><span class=p>,</span> <span class=n>ModelViewSet</span><span class=p>):</span>
    <span class=c1># é€šè¿‡querysetæŒ‡å®šå¦‚ä½•è·å–æ•°æ®ï¼ˆèµ„æºï¼‰</span>
    <span class=n>queryset</span> <span class=o>=</span> <span class=n>Estate</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;district&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=s1>&#39;agents&#39;</span><span class=p>)</span>
    <span class=c1># é€šè¿‡serializer_classæŒ‡å®šå¦‚ä½•åºåˆ—åŒ–æ•°æ®</span>
    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>EstateSerializer</span>
    <span class=c1># æŒ‡å®šæ ¹æ®å“ªäº›å­—æ®µè¿›è¡Œæ•°æ®ç­›é€‰</span>
    <span class=n>filter_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;district&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>)</span>
    <span class=c1># æŒ‡å®šæ ¹æ®å“ªäº›å­—æ®µå¯¹æ•°æ®è¿›è¡Œæ’åº</span>
    <span class=n>ordering_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;hot&#39;</span><span class=p>,</span> <span class=p>)</span>
    <span class=c1># æŒ‡å®šç”¨äºè¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯çš„ç±»</span>
    <span class=n>authentication_classes</span> <span class=o>=</span> <span class=p>(</span><span class=n>MyAuthentication</span><span class=p>,</span> <span class=p>)</span>
</code></pre></td></tr></table></div></div></div><blockquote><p>è¯´æ˜ï¼šä¹Ÿå¯ä»¥åœ¨Djangoé…ç½®æ–‡ä»¶ä¸­å°†è‡ªå®šä¹‰çš„è®¤è¯ç±»è®¾ç½®ä¸ºé»˜è®¤è®¤è¯æ–¹å¼ã€‚</p></blockquote><h4 id=æˆäºˆæƒé™><a href=#æˆäºˆæƒé™ class=anchor-link>#</a>æˆäºˆæƒé™</h4><p>æƒé™æ£€æŸ¥æ€»æ˜¯åœ¨è§†å›¾çš„æœ€å¼€å§‹å¤„è¿è¡Œï¼Œåœ¨ä»»ä½•å…¶ä»–ä»£ç è¢«å…è®¸è¿›è¡Œä¹‹å‰ã€‚æœ€ç®€å•çš„æƒé™æ˜¯å…è®¸é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ï¼Œå¹¶æ‹’ç»æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ï¼Œè¿™å¯¹åº”äºdfrä¸­çš„<code>IsAuthenticated</code>ç±»ï¼Œå¯ä»¥ç”¨å®ƒæ¥å–ä»£é»˜è®¤çš„<code>AllowAny</code>ç±»ã€‚æƒé™ç­–ç•¥å¯ä»¥åœ¨Djangoçš„DRFé…ç½®ä¸­ç”¨<code>DEFAULT_PERMISSION_CLASSES</code>å…¨å±€è®¾ç½®ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>REST_FRAMEWORK</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class=p>,</span>
    <span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><p>ä¹Ÿå¯ä»¥åœ¨åŸºäº<code>APIView</code>ç±»çš„è§†å›¾ä¸Šè®¾ç½®èº«ä»½éªŒè¯ç­–ç•¥ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>rest_framework.permissions</span> <span class=kn>import</span> <span class=n>IsAuthenticated</span>
<span class=kn>from</span> <span class=nn>rest_framework.views</span> <span class=kn>import</span> <span class=n>APIView</span>

<span class=k>class</span> <span class=nc>ExampleView</span><span class=p>(</span><span class=n>APIView</span><span class=p>):</span>
    <span class=n>permission_classes</span> <span class=o>=</span> <span class=p>(</span><span class=n>IsAuthenticated</span><span class=p>,</span> <span class=p>)</span>
    <span class=c1># æ­¤å¤„çœç•¥å…¶ä»–ä»£ç </span>
</code></pre></td></tr></table></div></div></div><p>æˆ–è€…åœ¨åŸºäº<code>@api_view</code>è£…é¥°å™¨çš„è§†å›¾å‡½æ•°ä¸Šè®¾ç½®ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>rest_framework.decorators</span> <span class=kn>import</span> <span class=n>api_view</span><span class=p>,</span> <span class=n>permission_classes</span>
<span class=kn>from</span> <span class=nn>rest_framework.permissions</span> <span class=kn>import</span> <span class=n>IsAuthenticated</span>

<span class=nd>@api_view</span><span class=p>([</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=nd>@permission_classes</span><span class=p>((</span><span class=n>IsAuthenticated</span><span class=p>,</span> <span class=p>))</span>
<span class=k>def</span> <span class=nf>example_view</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=c1># æ­¤å¤„çœç•¥å…¶ä»–ä»£ç </span>
</code></pre></td></tr></table></div></div></div><p>è‡ªå®šä¹‰æƒé™éœ€è¦ç»§æ‰¿<code>BasePermission</code>å¹¶å®ç°ä»¥ä¸‹æ–¹æ³•ä¸­çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªï¼Œä¸‹é¢æ˜¯BasePermissionçš„ä»£ç ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@six</span><span class=o>.</span><span class=n>add_metaclass</span><span class=p>(</span><span class=n>BasePermissionMetaclass</span><span class=p>)</span>
<span class=k>class</span> <span class=nc>BasePermission</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    A base class from which all permission classes should inherit.
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=nf>has_permission</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>view</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        Return `True` if permission is granted, `False` otherwise.
</span><span class=s2>        &#34;&#34;&#34;</span>
        <span class=k>return</span> <span class=kc>True</span>

    <span class=k>def</span> <span class=nf>has_object_permission</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>view</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        Return `True` if permission is granted, `False` otherwise.
</span><span class=s2>        &#34;&#34;&#34;</span>
        <span class=k>return</span> <span class=kc>True</span>
</code></pre></td></tr></table></div></div></div><p>å¦‚æœè¯·æ±‚è¢«æˆäºˆè®¿é—®æƒé™ï¼Œåˆ™æ–¹æ³•åº”è¯¥è¿”å›Trueï¼Œå¦åˆ™è¿”Falseã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†é˜»æ­¢é»‘åå•ä¸­çš„IPåœ°å€è®¿é—®æ¥å£æ•°æ®ï¼ˆè¿™ä¸ªåœ¨åçˆ¬è™«çš„æ—¶å€™å¾ˆæœ‰ç”¨å“Ÿï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>rest_framework</span> <span class=kn>import</span> <span class=n>permissions</span>


<span class=k>class</span> <span class=nc>BlacklistPermission</span><span class=p>(</span><span class=n>permissions</span><span class=o>.</span><span class=n>BasePermission</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Global permission check for blacklisted IPs.
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=nf>has_permission</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>view</span><span class=p>):</span>
        <span class=n>ip_addr</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>META</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>]</span>
        <span class=n>blacklisted</span> <span class=o>=</span> <span class=n>Blacklist</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>ip_addr</span><span class=o>=</span><span class=n>ip_addr</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
        <span class=k>return</span> <span class=ow>not</span> <span class=n>blacklisted</span>
</code></pre></td></tr></table></div></div></div><p>å¦‚æœè¦å®ç°æ›´ä¸ºå®Œæ•´çš„æƒé™éªŒè¯ï¼Œå¯ä»¥è€ƒè™‘RBACæˆ–ACLã€‚</p><ol><li><p>RBAC - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=/res/rbac-basic.png alt></p><p><img src=/res/rbac-full.png alt></p></li><li><p>ACL - è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆæ¯ä¸ªç”¨æˆ·ç»‘å®šè‡ªå·±çš„è®¿é—®ç™½åå•æˆ–é»‘åå•ï¼‰ã€‚</p></li></ol><h4 id=è®¿é—®é™æµ><a href=#è®¿é—®é™æµ class=anchor-link>#</a>è®¿é—®é™æµ</h4><p>å¯ä»¥ä¿®æ”¹dfré…ç½®çš„<code>DEFAULT_THROTTLE_CLASSES</code> å’Œ <code>DEFAULT_THROTTLE_RATES</code>ä¸¤ä¸ªå€¼æ¥è®¾ç½®å…¨å±€é»˜è®¤é™æµç­–ç•¥ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>REST_FRAMEWORK</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class=p>:</span> <span class=p>(</span>
        <span class=s1>&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class=p>,</span>
        <span class=s1>&#39;rest_framework.throttling.UserRateThrottle&#39;</span>
    <span class=p>),</span>
    <span class=s1>&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;anon&#39;</span><span class=p>:</span> <span class=s1>&#39;3/min&#39;</span><span class=p>,</span>
        <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=s1>&#39;10000/day&#39;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><p><code>DEFAULT_THROTTLE_RATES</code>ä¸­ä½¿ç”¨çš„é¢‘ç‡æè¿°å¯èƒ½åŒ…æ‹¬<code>second</code>ã€<code>minute</code>ã€<code>hour</code>æˆ–<code>day</code>ã€‚</p><p>å¦‚æœè¦ä¸ºæ¥å£å•ç‹¬è®¾ç½®é™æµï¼Œå¯ä»¥åœ¨æ¯ä¸ªè§†å›¾æˆ–è§†å›¾é›†ä¸Šè®¾ç½®é™æµç­–ç•¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>rest_framework.throttling</span> <span class=kn>import</span> <span class=n>UserRateThrottle</span>
<span class=kn>from</span> <span class=nn>rest_framework.views</span> <span class=kn>import</span> <span class=n>APIView</span>


<span class=k>class</span> <span class=nc>ExampleView</span><span class=p>(</span><span class=n>APIView</span><span class=p>):</span>
    <span class=n>throttle_classes</span> <span class=o>=</span> <span class=p>(</span><span class=n>UserRateThrottle</span><span class=p>,</span> <span class=p>)</span>
    <span class=c1># æ­¤å¤„çœç•¥ä¸‹é¢çš„ä»£ç </span>
</code></pre></td></tr></table></div></div></div><p>æˆ–</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@api_view</span><span class=p>([</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=nd>@throttle_classes</span><span class=p>([</span><span class=n>UserRateThrottle</span><span class=p>,</span> <span class=p>])</span>
<span class=k>def</span> <span class=nf>example_view</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=c1># æ­¤å¤„çœç•¥ä¸‹é¢çš„ä»£ç </span>
</code></pre></td></tr></table></div></div></div><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿<code>SimpleRateThrottle</code>æ¥è‡ªå®šä¹‰é™æµç­–ç•¥ï¼Œé€šå¸¸éœ€è¦é‡å†™<code>allow_request</code>å’Œ<code>wait</code>æ–¹æ³•ã€‚</p><h3 id=å¼‚æ­¥ä»»åŠ¡å’Œè®¡åˆ’ä»»åŠ¡><a href=#å¼‚æ­¥ä»»åŠ¡å’Œè®¡åˆ’ä»»åŠ¡ class=anchor-link>#</a>å¼‚æ­¥ä»»åŠ¡å’Œè®¡åˆ’ä»»åŠ¡</h3><h4 id=celeryçš„åº”ç”¨><a href=#celeryçš„åº”ç”¨ class=anchor-link>#</a>Celeryçš„åº”ç”¨</h4><p>Celery æ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ä¸”å¯é çš„ï¼Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æä¾›ç»´æŠ¤è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„å¿…éœ€å·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸“æ³¨äºå®æ—¶å¤„ç†çš„ä»»åŠ¡é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒä»»åŠ¡è°ƒåº¦ã€‚</p><p>æ¨èé˜…è¯»ï¼š<a href=http://docs.jinkan.org/docs/celery/ target=_blank rel=noopener>ã€ŠCeleryå®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆã€‹</a>ï¼Œä¸Šé¢æœ‰æä¸ºè¯¦ç»†çš„é…ç½®å’Œä½¿ç”¨æŒ‡å—ã€‚</p><p><img src=/res/celery_architecture.png alt></p><p>Celeryæ˜¯ä¸€ä¸ªæœ¬èº«ä¸æä¾›é˜Ÿåˆ—æœåŠ¡ï¼Œå®˜æ–¹æ¨èä½¿ç”¨RabbitMQæˆ–Redisæ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œå‰è€…æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå®ƒå¯¹AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰åšå‡ºäº†éå¸¸å¥½çš„å®ç°ã€‚</p><ol><li><p>å®‰è£…RabbitMQã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>docker pull rabbitmq
docker run -d -p 5672:5672 --name myrabbit rabbitmq
docker container <span class=nb>exec</span> -it myrabbit /bin/bash
</code></pre></td></tr></table></div></div></div></li><li><p>åˆ›å»ºç”¨æˆ·ã€èµ„æºä»¥åŠåˆ†é…æ“ä½œæƒé™ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>rabbitmqctl add_user luohao <span class=m>123456</span>
rabbitmqctl set_user_tags luohao administrator
rabbitmqctl add_vhost vhost1
rabbitmqctl set_permissions -p vhost1 luohao <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åˆ›å»ºCeleryå®ä¾‹ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=c1># æ³¨å†Œç¯å¢ƒå˜é‡</span>
<span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s1>&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class=p>,</span> <span class=s1>&#39;é¡¹ç›®å.settings&#39;</span><span class=p>)</span>

<span class=c1># åˆ›å»ºCeleryå®ä¾‹</span>
<span class=n>app</span> <span class=o>=</span> <span class=n>celery</span><span class=o>.</span><span class=n>Celery</span><span class=p>(</span>
    <span class=s1>&#39;fangtx&#39;</span><span class=p>,</span>
    <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;amqp://luohao:123456@1.2.3.4:5672/vhost1&#39;</span>
<span class=p>)</span>

<span class=c1># ä»é¡¹ç›®çš„é…ç½®æ–‡ä»¶è¯»å–Celeryé…ç½®ä¿¡æ¯</span>
<span class=c1># app.config_from_object(&#39;django.conf:settings&#39;)</span>
<span class=c1># ä»æŒ‡å®šçš„æ–‡ä»¶(ä¾‹å¦‚celery_config.py)ä¸­è¯»å–Celeryé…ç½®ä¿¡æ¯</span>
<span class=c1># app.config_from_object(&#39;celery_config&#39;)</span>

<span class=c1># è®©Celeryè‡ªåŠ¨ä»å‚æ•°æŒ‡å®šçš„åº”ç”¨ä¸­å‘ç°å¼‚æ­¥ä»»åŠ¡/å®šæ—¶ä»»åŠ¡</span>
<span class=c1># app.autodiscover_tasks([&#39;common&#39;, ])</span>
<span class=c1># è®©Celeryè‡ªåŠ¨ä»æ‰€æœ‰æ³¨å†Œçš„åº”ç”¨ä¸­å‘ç°å¼‚æ­¥ä»»åŠ¡/å®šæ—¶ä»»åŠ¡</span>
<span class=n>app</span><span class=o>.</span><span class=n>autodiscover_tasks</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>settings</span><span class=o>.</span><span class=n>INSTALLED_APPS</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div></li><li><p>å¯åŠ¨Celeryåˆ›å»ºwokerï¼ˆæ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>celery -A &lt;name&gt; worker -l debug <span class=p>&amp;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@app</span><span class=o>.</span><span class=n>task</span>
<span class=k>def</span> <span class=nf>send_email</span><span class=p>(</span><span class=n>from_user</span><span class=p>,</span> <span class=n>to_user</span><span class=p>,</span> <span class=n>cc_user</span><span class=p>,</span> <span class=n>subject</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
    <span class=k>pass</span>


<span class=c1># æ¶ˆæ¯çš„ç”Ÿäº§è€…</span>
<span class=n>send_email</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>[],</span> <span class=p>[],</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=c1># é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆè®¡åˆ’ä»»åŠ¡ï¼‰</span>
<span class=n>app</span><span class=o>.</span><span class=n>conf</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
    <span class=n>timezone</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>TIME_ZONE</span><span class=p>,</span>
    <span class=n>enable_utc</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=c1># å®šæ—¶ä»»åŠ¡ï¼ˆè®¡åˆ’ä»»åŠ¡ï¼‰ç›¸å½“äºæ˜¯æ¶ˆæ¯çš„ç”Ÿäº§è€…</span>
    <span class=c1># å¦‚æœåªæœ‰ç”Ÿäº§è€…æ²¡æœ‰æ¶ˆè´¹è€…é‚£ä¹ˆæ¶ˆæ¯å°±ä¼šåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§¯å‹</span>
    <span class=c1># å°†æ¥å®é™…éƒ¨ç½²é¡¹ç›®çš„æ—¶å€™ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€æ¶ˆæ¯é˜Ÿåˆ—å¯èƒ½éƒ½æ˜¯ä¸åŒèŠ‚ç‚¹</span>
    <span class=n>beat_schedule</span><span class=o>=</span><span class=p>{</span>
        <span class=s1>&#39;task1&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;task&#39;</span><span class=p>:</span> <span class=s1>&#39;common.tasks.scheduled_task&#39;</span><span class=p>,</span>
            <span class=s1>&#39;schedule&#39;</span><span class=p>:</span> <span class=n>crontab</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>),</span>
            <span class=s1>&#39;args&#39;</span><span class=p>:</span> <span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=p>)</span>
        <span class=p>},</span>
    <span class=p>},</span>
<span class=p>)</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=nd>@app</span><span class=o>.</span><span class=n>task</span>
<span class=k>def</span> <span class=nf>scheduled_task</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
    <span class=k>pass</span>
</code></pre></td></tr></table></div></div></div></li><li><p>å¯åŠ¨Celeryåˆ›å»ºæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„beatï¼ˆæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>celery -A &lt;name&gt; beat -l info
</code></pre></td></tr></table></div></div></div></li><li><p>æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—çŠ¶å†µã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>rabbitmqctl list_queues -p vhost1
</code></pre></td></tr></table></div></div></div></li><li><p>ç›‘æ§Celery - å¯ä»¥é€šè¿‡floweræ¥å¯¹Celeryè¿›è¡Œç›‘æ§ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install flower
celery flower --broker<span class=o>=</span>amqp://luohao:123456@120.77.222.217:5672/vhost1
</code></pre></td></tr></table></div></div></div></li></ol><h3 id=å…¶ä»–é—®é¢˜><a href=#å…¶ä»–é—®é¢˜ class=anchor-link>#</a>å…¶ä»–é—®é¢˜</h3><p>é—®é¢˜1ï¼šå¦‚ä½•è§£å†³JavaScriptè·¨åŸŸè·å–æ•°æ®çš„é—®é¢˜ï¼Ÿï¼ˆdjango-cors-headersï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;corsheaders&#39;</span><span class=p>,</span>
<span class=p>]</span>

<span class=n>MIDDLEWARE</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;corsheaders.middleware.CorsMiddleware&#39;</span><span class=p>,</span>
<span class=p>]</span>

<span class=n>CORS_ORIGIN_ALLOW_ALL</span> <span class=o>=</span> <span class=kc>True</span>
<span class=c1># é…ç½®è·¨åŸŸç™½åå•</span>
<span class=c1># CORS_ORIGIN_WHITELIST = (&#39;www.abc.com&#39;, &#39;www.baidu.com&#39;)</span>
<span class=c1># CORS_ORIGIN_REGEX_WHITELIST = (&#39;...&#39;, )</span>
<span class=c1># CORS_ALLOW_CREDENTIALS = True</span>
<span class=c1># CORS_ALLOW_METHODS = (&#39;GET&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELETE&#39;)</span>
</code></pre></td></tr></table></div></div></div><p>é—®é¢˜2ï¼šç½‘ç«™å›¾ç‰‡ï¼ˆæ°´å°ã€å‰ªè£ï¼‰å’Œè§†é¢‘ï¼ˆæˆªå›¾ã€æ°´å°ã€è½¬ç ï¼‰æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿï¼ˆäº‘å­˜å‚¨ã€FFmpegï¼‰</p><p>é—®é¢˜3ï¼šç½‘ç«™å¦‚ä½•æ¶è®¾ï¼ˆé™æ€èµ„æºï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Ÿï¼ˆFastDFSã€äº‘å­˜å‚¨ã€CDNï¼‰</p><h3 id=å®‰å…¨ä¿æŠ¤><a href=#å®‰å…¨ä¿æŠ¤ class=anchor-link>#</a>å®‰å…¨ä¿æŠ¤</h3><p>é—®é¢˜1ï¼šä»€ä¹ˆæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSS)ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿï¼ˆå¯¹æäº¤çš„å†…å®¹è¿›è¡Œæ¶ˆæ¯’ï¼‰</p><p>é—®é¢˜2ï¼šä»€ä¹ˆæ˜¯è·¨ç«™èº«ä»½ä¼ªé€ ï¼ˆCSRFï¼‰ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿï¼ˆä½¿ç”¨éšæœºä»¤ç‰Œï¼‰</p><p>é—®é¢˜3ï¼šä»€ä¹ˆæ˜¯SQLæ³¨å°„æ”»å‡»ï¼ˆSQL Injectionï¼‰ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿï¼ˆä¸æ‹¼æ¥SQLè¯­å¥ï¼Œé¿å…ä½¿ç”¨å•å¼•å·ï¼‰</p><p>é—®é¢˜4ï¼šä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒæ”»å‡»ï¼ˆClick-hackingï¼‰ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿï¼ˆä¸å…è®¸<code>&lt;iframe></code>åŠ è½½éåŒæºç«™ç‚¹å†…å®¹ï¼‰</p><h4 id=djangoæä¾›çš„å®‰å…¨æªæ–½><a href=#djangoæä¾›çš„å®‰å…¨æªæ–½ class=anchor-link>#</a>Djangoæä¾›çš„å®‰å…¨æªæ–½</h4><p>ç­¾åæ•°æ®çš„API</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.core.signing</span> <span class=kn>import</span> <span class=n>Signer</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span> <span class=o>=</span> <span class=n>Signer</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>value</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=s1>&#39;hello, world!&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>value</span>
<span class=s1>&#39;hello, world!:BYMlgvWMTSPLxC-DqxByleiMVXU&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span><span class=o>.</span><span class=n>unsign</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<span class=s1>&#39;hello, world!&#39;</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span> <span class=o>=</span> <span class=n>Signer</span><span class=p>(</span><span class=n>salt</span><span class=o>=</span><span class=s1>&#39;yoursalt&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=s1>&#39;hello, world!&#39;</span><span class=p>)</span>
<span class=s1>&#39;hello, world!:9vEvG6EA05hjMDB5MtUr33nRA_M&#39;</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.core.signing</span> <span class=kn>import</span> <span class=n>TimestampSigner</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span> <span class=o>=</span> <span class=n>TimestampSigner</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>value</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=s1>&#39;hello, world!&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>value</span>
<span class=s1>&#39;hello, world!:1fpmcQ:STwj464IFE6eUB-_-hyUVF3d2So&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span><span class=o>.</span><span class=n>unsign</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>max_age</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
<span class=n>Traceback</span> <span class=p>(</span><span class=n>most</span> <span class=n>recent</span> <span class=n>call</span> <span class=n>last</span><span class=p>):</span>
 <span class=n>File</span> <span class=s2>&#34;&lt;console&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span><span class=p>,</span> <span class=ow>in</span> <span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;</span>
 <span class=n>File</span> <span class=s2>&#34;/Users/Hao/Desktop/fang.com/venv/lib/python3.6/site-packages/django/core/signing.py&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>198</span><span class=p>,</span> <span class=ow>in</span> <span class=n>unsign</span>
 <span class=s1>&#39;Signature age </span><span class=si>%s</span><span class=s1> &gt; </span><span class=si>%s</span><span class=s1> seconds&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>age</span><span class=p>,</span> <span class=n>max_age</span><span class=p>))</span>
 <span class=n>django</span><span class=o>.</span><span class=n>core</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>SignatureExpired</span><span class=p>:</span> <span class=n>Signature</span> <span class=n>age</span> <span class=mf>21.020604848861694</span> <span class=o>&gt;</span> <span class=mi>5</span> <span class=n>seconds</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>signer</span><span class=o>.</span><span class=n>unsign</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>max_age</span><span class=o>=</span><span class=mi>120</span><span class=p>)</span>
<span class=s1>&#39;hello, world!&#39;</span>
</code></pre></td></tr></table></div></div></div><p>CSRFä»¤ç‰Œå’Œå°å·¥å…·</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML>{% csrf_token %}
</code></pre></td></tr></table></div></div></div><ul><li>@csrf_exemptï¼šå…é™¤ä»¤ç‰Œ</li><li>@csrf_protectï¼šæä¾›ä»¤ç‰Œä¿æŠ¤</li><li>@require_csrf_tokenï¼šæä¾›ä»¤ç‰Œä¿æŠ¤</li><li>@ensure_csrf_cookieï¼šå¼ºåˆ¶è§†å›¾å‘é€å¸¦ä»¤ç‰Œçš„cookie</li></ul><blockquote><p>è¯´æ˜ï¼šå¯ä»¥åœ¨Chromeæµè§ˆå™¨ä¸­å®‰è£…EditThisCookieæ’ä»¶æ¥æ–¹ä¾¿çš„æŸ¥çœ‹Cookieã€‚</p></blockquote><h4 id=ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤><a href=#ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤ class=anchor-link>#</a>ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤</h4><ol><li><p>å“ˆå¸Œæ‘˜è¦ï¼ˆç­¾åï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>hashlib</span>
<span class=o>&gt;&gt;&gt;</span> 
<span class=o>&gt;&gt;&gt;</span> <span class=n>md5_hasher</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>md5_hasher</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=s1>&#39;hello, world!&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>md5_hasher</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
<span class=s1>&#39;3adbbad1791fbae3ec908894c4963870&#39;</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>sha1_hasher</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>sha1_hasher</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=s1>&#39;hello, world!&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>sha1_hasher</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=s1>&#39;goodbye, world!&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>sha1_hasher</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
<span class=s1>&#39;1f09d30c707d53f3d16c530dd73d70a6ce7596a9&#39;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>åŠ å¯†å’Œè§£å¯†ï¼ˆå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼‰</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install pycrypto
</code></pre></td></tr></table></div></div></div><p>AESå¯¹ç§°åŠ å¯†ï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
<span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>Crypto</span> <span class=kn>import</span> <span class=n>Random</span>
<span class=o>&gt;&gt;&gt;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;mysecret&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>iv</span> <span class=o>=</span> <span class=n>Random</span><span class=o>.</span><span class=n>new</span><span class=p>()</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>str1</span> <span class=o>=</span> <span class=s1>&#39;æˆ‘çˆ±ä½ ä»¬ï¼&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>str2</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CFB</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>str1</span><span class=p>)</span>
<span class=sa>b</span><span class=s1>&#39;p</span><span class=se>\x96</span><span class=s1>o</span><span class=se>\x85\x0b</span><span class=s1>q</span><span class=se>\xc4</span><span class=s1>-Y</span><span class=se>\xc4\xbc</span><span class=s1>p</span><span class=se>\n</span><span class=s1>)&amp;&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>str3</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CFB</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>str2</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
<span class=s1>&#39;æˆ‘çˆ±ä½ ä»¬ï¼&#39;</span>
</code></pre></td></tr></table></div></div></div><p>RSAéå¯¹ç§°åŠ å¯†ï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># ç”Ÿæˆå¯†é’¥å¯¹</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>key_pair</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># å¯¼å…¥å…¬é’¥</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>pub_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>importKey</span><span class=p>(</span><span class=n>key_pair</span><span class=o>.</span><span class=n>publickey</span><span class=p>()</span><span class=o>.</span><span class=n>exportKey</span><span class=p>())</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># å¯¼å…¥ç§é’¥</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>pri_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>importKey</span><span class=p>(</span><span class=n>key_pair</span><span class=o>.</span><span class=n>exportKey</span><span class=p>())</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># æ˜æ–‡</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>message1</span> <span class=o>=</span> <span class=s1>&#39;hello, world!&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># åŠ å¯†æ•°æ®</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>message2</span> <span class=o>=</span> <span class=n>pub_key</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>message1</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x03\x86</span><span class=s1>t</span><span class=se>\xa0\x00\xc4\xea\xd2\x80\xed\xa7</span><span class=s1>YN7</span><span class=se>\x07\xff\x88\xaa\x1e</span><span class=s1>W</span><span class=se>\x0c</span><span class=s1>mH0</span><span class=se>\x06\xa7\&#39;\xbc</span><span class=s1>&lt;w@q</span><span class=se>\x8b\xaf\xf7</span><span class=s1>:g</span><span class=se>\x92</span><span class=s1>{=</span><span class=se>\xe2</span><span class=s1>E</span><span class=se>\xa5</span><span class=s1>@</span><span class=se>\x1a</span><span class=s1>s2</span><span class=se>\xdd\xcb\x8e</span><span class=s1>[</span><span class=se>\x98\x85\xdf</span><span class=s1>,X</span><span class=se>\xec</span><span class=s1>j.U</span><span class=se>\xd6\xa7</span><span class=s1>W&amp;u</span><span class=se>\&#39;</span><span class=s1>Uz&#34;</span><span class=se>\x0f\x0e\\</span><span class=s1>&lt;</span><span class=se>\xa4\xfa</span><span class=s1>vC</span><span class=se>\x93\xa7\xbc</span><span class=s1>O&#34;</span><span class=se>\xb9</span><span class=s1>a</span><span class=se>\x06</span><span class=s1>]&lt;.</span><span class=se>\xc1\r</span><span class=s1>1}*</span><span class=se>\xdf\xcc</span><span class=s1>dqXML</span><span class=se>\x93\x1b\xe9\xda\xdf\xab</span><span class=s1>|</span><span class=se>\xf8\x18\xe4\x99\xbb\x7f\x18</span><span class=s1>}</span><span class=se>\xd9\x9a\x1e</span><span class=s1>*J</span><span class=se>\\\xca\x1a\xd1\x85\xf7</span><span class=s1>t</span><span class=se>\x81\xd9</span><span class=s1>5{</span><span class=se>\x19\xc9\x81\xb6</span><span class=s1>^}</span><span class=se>\x9c</span><span class=s1>5</span><span class=se>\xca\xfe\xcf\xc8\xd8</span><span class=s1>M</span><span class=se>\x9a\x8c</span><span class=s1>-</span><span class=se>\xf1</span><span class=s1>t</span><span class=se>\xee\xf9\x12\x90\x01\xca\x92</span><span class=s1>~</span><span class=se>\x00</span><span class=s1>c5qg5g</span><span class=se>\x95</span><span class=s1>&amp;</span><span class=se>\x10\xb1\x0b\x1f</span><span class=s1>o</span><span class=se>\x95\xf2\xbc\x8d\xf3</span><span class=s1>f&#34;@</span><span class=se>\xc5\x18</span><span class=s1>8</span><span class=se>\x0b</span><span class=s1>X</span><span class=se>\x9c</span><span class=s1>fo</span><span class=se>\xea\x97\x05</span><span class=s1>@</span><span class=se>\xe5\xb2\xda\xb8\x97</span><span class=s1>a</span><span class=se>\xa5</span><span class=s1>w</span><span class=se>\xa8\x01\x9a\xa5</span><span class=s1>N</span><span class=se>\xc4\x81\x8d\x0f</span><span class=s1>&lt;</span><span class=se>\x96</span><span class=s1>iU</span><span class=se>\xd3\x95\xac</span><span class=s1>JZs</span><span class=se>\xab</span><span class=s1>_ #</span><span class=se>\xee\xf9\x0f\xf2\x12\xdb\xfc\xf8</span><span class=s1>g</span><span class=se>\x18</span><span class=s1>v</span><span class=se>\x02</span><span class=s1>k+</span><span class=se>\xda\x16</span><span class=s1>Si</span><span class=se>\xbf\xbb\xec\xf7</span><span class=s1>w</span><span class=se>\x90\xde\xae\x97\t\xed</span><span class=si>{}</span><span class=s1>5</span><span class=se>\xd0</span><span class=s1>&#39;</span><span class=p>,)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=c1># è§£å¯†æ•°æ®</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>message3</span> <span class=o>=</span> <span class=n>pri_key</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>message2</span><span class=p>)</span>
<span class=s1>&#39;hello, world!&#39;</span>
</code></pre></td></tr></table></div></div></div></li></ol><h4 id=å®‰å…¨ç›¸å…³å»ºè®®><a href=#å®‰å…¨ç›¸å…³å»ºè®® class=anchor-link>#</a>å®‰å…¨ç›¸å…³å»ºè®®</h4><ol><li>è™½ç„¶ Django è‡ªå¸¦äº†ç¨³å›ºçš„å®‰å…¨ä¿æŠ¤æªæ–½ï¼Œä½†æ˜¯ä¾ç„¶è¦é‡‡ç”¨æ­£ç¡®çš„æ–¹å¼éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œåˆ©ç”¨ Web æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç»„ä»¶æä¾›çš„å®‰å…¨ä¿æŠ¤æªæ–½ã€‚</li><li>è®°å¾—æŠŠ Python ä»£ç æ”¾åœ¨ Web æœåŠ¡å™¨çš„æ–‡æ¡£æ ¹ç›®å½•ä¹‹å¤–ï¼Œé¿å…ä»£ç æ„å¤–æ³„éœ²ã€‚</li><li>è°¨æ…å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ã€‚</li><li>Djangoæœ¬èº«æ²¡æœ‰å¯¹è¯·æ±‚æ¬¡æ•°åŠ ä»¥é™åˆ¶ï¼ˆåŒ…æ‹¬éªŒè¯ç”¨æˆ·èº«ä»½çš„è¯·æ±‚ï¼‰ï¼Œä¸ºäº†é˜²æ­¢æš´åŠ›æ”»å‡»å’Œç ´è§£ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…·æœ‰ä¸€æ¬¡æ¶ˆè´¹æ€§çš„éªŒè¯ç æˆ–å¯¹è¿™ç±»è¯·æ±‚çš„æ¬¡æ•°è¿›è¡Œé™åˆ¶ã€‚</li><li>å°†ç¼“å­˜ç³»ç»Ÿã€æ•°æ®åº“æœåŠ¡å™¨ä»¥åŠé‡è¦çš„èµ„æºæœåŠ¡å™¨éƒ½æ”¾åœ¨ç¬¬äºŒçº§é˜²ç«å¢™ä¹‹åï¼ˆä¸è¦æ”¾åœ¨DMZï¼‰ã€‚</li></ol><h3 id=æµ‹è¯•ç›¸å…³><a href=#æµ‹è¯•ç›¸å…³ class=anchor-link>#</a>æµ‹è¯•ç›¸å…³</h3><p>æµ‹è¯•æ˜¯å‘ç°å’Œæ ‡è®°ç¼ºé™·çš„è¿‡ç¨‹ã€‚æ‰€è°“çš„ç¼ºé™·æ˜¯æŒ‡å®é™…ç»“æœå’ŒæœŸæœ›ç»“æœä¹‹é—´çš„ä»»ä½•å·®åˆ«ã€‚æœ‰çš„åœ°æ–¹ï¼Œæµ‹è¯•ä¹Ÿè¢«è®¤ä¸ºæ˜¯æ‰§è¡Œä»¥æ‰¾å‡ºé”™è¯¯ä¸ºç›®çš„çš„ç¨‹åºçš„è¿‡ç¨‹ã€‚ æµ‹è¯•æ˜¯ä¸ºäº†è®©äº§å“è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š</p><ol><li>æ»¡è¶³éœ€æ±‚ç”¨æˆ·æ»¡æ„</li><li>æ”¹å–„äº§å“çš„å¸‚åœºå æœ‰ç‡</li><li>æ ‘ç«‹å¯¹äº§å“çš„ä¿¡ä»»</li><li>å‡å°‘å¼€å‘å’Œç»´æŠ¤çš„æˆæœ¬</li></ol><h4 id=åŠŸèƒ½æµ‹è¯•><a href=#åŠŸèƒ½æµ‹è¯• class=anchor-link>#</a>åŠŸèƒ½æµ‹è¯•</h4><p>å¦‚æœä¸€ä¸ªè½¯ä»¶å•å…ƒçš„è¡Œä¸ºæ–¹å¼ä¸å®ƒçš„å¼€å‘è§„èŒƒå®Œå…¨ä¸€æ ·ï¼Œé‚£ä¹ˆè¯¥è½¯ä»¶å•å…ƒå°±é€šè¿‡äº†å®ƒçš„åŠŸèƒ½æµ‹è¯•ã€‚</p><ul><li>ç™½ç›’æµ‹è¯•ï¼šå¼€å‘äººå‘˜è‡ªå·±å®ç°ï¼Œæœ€åŸºæœ¬çš„å½¢å¼æ˜¯å•å…ƒæµ‹è¯•ï¼Œè¿˜æœ‰é›†æˆæµ‹è¯•å’Œç³»ç»Ÿæµ‹è¯•ã€‚</li><li>é»‘ç›’æµ‹è¯•ï¼šç”±å¼€å‘å›¢é˜Ÿä¹‹å¤–çš„äººæ‰§è¡Œï¼Œå¯¹æµ‹è¯•ä»£ç æ²¡æœ‰å¯è§æ€§ï¼Œå°†è¢«æµ‹ç³»ç»Ÿè§†ä¸ºé»‘ç›’å­ã€‚é€šå¸¸ç”±æµ‹è¯•äººå‘˜æˆ–QAå·¥ç¨‹å¸ˆæ¥æ‰§è¡Œï¼ŒWebåº”ç”¨å¯ä»¥é€šè¿‡Seleniumè¿™æ ·çš„æµ‹è¯•æ¡†æ¶è‡ªåŠ¨åŒ–å®æ–½ã€‚</li></ul><h4 id=æ€§èƒ½æµ‹è¯•><a href=#æ€§èƒ½æµ‹è¯• class=anchor-link>#</a>æ€§èƒ½æµ‹è¯•</h4><p>è½¯ä»¶åœ¨é«˜å·¥ä½œè´Ÿè½½ä¸‹å¯¹å…¶å“åº”æ€§å’Œå¥å£®æ€§å±•å¼€çš„æµ‹è¯•ã€‚</p><ul><li><p>è´Ÿè½½æµ‹è¯•ï¼šåœ¨ç‰¹å®šè´Ÿè½½ä¸‹æ‰§è¡Œçš„æµ‹è¯•ã€‚</p></li><li><p>å‹åŠ›æµ‹è¯•ï¼šçªå‘æ¡ä»¶æˆ–æé™æ¡ä»¶ä¸‹çš„æ€§èƒ½æµ‹è¯•ã€‚</p></li></ul><h4 id=å®‰å…¨æ€§æµ‹è¯•><a href=#å®‰å…¨æ€§æµ‹è¯• class=anchor-link>#</a>å®‰å…¨æ€§æµ‹è¯•</h4><p>ç³»ç»Ÿçš„æ•æ„Ÿæ•°æ®éƒ½æ˜¯ç»è¿‡è®¤è¯å’Œæˆæƒä¹‹åæ‰èƒ½è®¿é—®ã€‚</p><h4 id=å…¶ä»–æµ‹è¯•><a href=#å…¶ä»–æµ‹è¯• class=anchor-link>#</a>å…¶ä»–æµ‹è¯•</h4><p>æ˜“ç”¨æ€§æµ‹è¯• / å®‰è£…æµ‹è¯• / å¯è®¿é—®æ€§æµ‹è¯•</p><h4 id=å•å…ƒæµ‹è¯•><a href=#å•å…ƒæµ‹è¯• class=anchor-link>#</a>å•å…ƒæµ‹è¯•</h4><p>æµ‹è¯•å‡½æ•°å’Œå¯¹è±¡çš„æ–¹æ³•ï¼ˆç¨‹åºä¸­æœ€å°æœ€åŸºæœ¬çš„å•å…ƒï¼‰ã€‚é€šè¿‡å¯¹å®é™…è¾“å‡ºå’Œé¢„æœŸè¾“å‡ºçš„æ¯”å¯¹ä»¥åŠå„ç§çš„æ–­è¨€æ¡ä»¶æ¥åˆ¤å®šè¢«æµ‹å•å…ƒæ˜¯å¦æ»¡è¶³è®¾è®¡éœ€æ±‚ã€‚</p><ul><li>æµ‹è¯•ç”¨ä¾‹</li><li>æµ‹è¯•å›ºä»¶ - æ¯æ¬¡æµ‹è¯•æ—¶éƒ½è¦ä½¿ç”¨çš„ä¸œè¥¿ã€‚</li><li>æµ‹è¯•å¥—ä»¶ï¼ˆæµ‹è¯•é›†ï¼‰- ç»„åˆäº†å¤šä¸ªæµ‹è¯•ç”¨ä¾‹è€Œæ„æˆçš„é›†åˆã€‚</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>UtilTest</span><span class=p>(</span><span class=n>unittest</span><span class=o>.</span><span class=n>TestCase</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\d</span><span class=si>{6}</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>test_gen_mobile_code</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>assertIsNotNone</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pattern</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>gen_mobile_code</span><span class=p>()))</span>

    <span class=k>def</span> <span class=nf>test_to_md5_hex</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>md5_dict</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s1>&#39;123456&#39;</span><span class=p>:</span> <span class=s1>&#39;e10adc3949ba59abbe56e057f20f883e&#39;</span><span class=p>,</span>
            <span class=s1>&#39;123123123&#39;</span><span class=p>:</span> <span class=s1>&#39;f5bb0c8de146c67b44babbf4e6584cc0&#39;</span><span class=p>,</span>
            <span class=s1>&#39;1qaz2wsx&#39;</span><span class=p>:</span> <span class=s1>&#39;1c63129ae9db9c60c3e8aa94d3e00495&#39;</span><span class=p>,</span>
        <span class=p>}</span>
        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>md5_dict</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>to_md5_hex</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</code></pre></td></tr></table></div></div></div><p><code>TestCase</code>çš„æ–­è¨€æ–¹æ³•ï¼š</p><ul><li>assertEqual / assertNotEqual</li><li>assertTrue / assertFalse / assertIsNot</li><li>assertRaise / assertRaiseRegexp</li><li>assertAlmostEqual / assertNotAlmostEqual</li><li>assertGreater / assertGreaterEqual / assertLess / assertLessEqual</li><li>assertRegexpMatches / assertNotRegexpMatches</li><li>assertListEqual / assertSetEqual / assertTupleEqual / assertDictEqual</li></ul><p>å¯ä»¥ä½¿ç”¨nose2æˆ–pytestæ¥è¾…åŠ©æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼ŒåŒæ—¶é€šè¿‡cov-coreæˆ–pytest-covå¯ä»¥å¯¹æµ‹è¯•è¦†åº¦è¿›è¡Œè¯„ä¼°ã€‚è¦†ç›–ç‡ç”±ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚æ¯”å¦‚æµ‹è¯•ä»£ç æ‰§è¡Œè¿‡äº†ç¨‹åºçš„æ¯ä¸€è¡Œï¼Œé‚£ä¹ˆè¦†ç›–ç‡å°±æ˜¯100%ã€‚è¿™ç§æ—¶å€™ï¼Œå‡ ä¹ä¸ä¼šå‡ºç°æ–°ç¨‹åºä¸Šçº¿åçªç„¶æ— æ³•è¿è¡Œçš„å°´å°¬æƒ…å†µã€‚è¦†ç›–ç‡ä¸å…³å¿ƒä»£ç å†…å®¹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œè¦†ç›–ç‡æ˜¯ç”¨æ¥æ£€æŸ¥â€œæµ‹è¯•ä»£ç ä¸è¶³ã€æµ‹è¯•å­˜åœ¨ç–æ¼â€çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œâ€œæµ‹è¯•å†…å®¹æ˜¯å¦å¦¥å½“â€å¹¶ä¸å½’å®ƒç®¡ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install nose2 pytest cov-core pytest-cov
</code></pre></td></tr></table></div></div></div><p>å¯ä»¥ä½¿ç”¨Seleniumæ¥å®ç°Webåº”ç”¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå®ƒè¿˜å¯ä»¥ç”¨äºå±å¹•æŠ“å–ä¸æµè§ˆå™¨è¡Œä¸ºæ¨¡æ‹Ÿï¼Œé€šè¿‡çˆ¬è™«æŠ“å–é¡µé¢ä¸Šçš„åŠ¨æ€æ•°æ®ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚Seleniumå…¶å®åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>Selenium IDEï¼šåµŒå…¥åˆ°æµè§ˆå™¨çš„æ’ä»¶ï¼Œå¯ä»¥å½•åˆ¶å’Œå›æ”¾è„šæœ¬ã€‚</p><p><img src=/res/selenium_ide.png alt></p></li><li><p>Selenium WebDriverï¼šæ”¯æŒå¤šç§è¯­è¨€å¯ä»¥æ“æ§æµè§ˆå™¨çš„APIã€‚</p></li><li><p>Selenium Standalone Serverï¼šSelenium Gridã€è¿œç¨‹æ§åˆ¶ã€åˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p></li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install selenium
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>from</span> <span class=nn>selenium</span> <span class=kn>import</span> <span class=n>webdriver</span>
<span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>import</span> <span class=nn>contextlib</span>


<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s1>&#39;session&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>chrome</span><span class=p>():</span>
    <span class=c1># è®¾ç½®ä½¿ç”¨æ— å¤´æµè§ˆå™¨(ä¸ä¼šæ‰“å¼€æµè§ˆå™¨çª—å£)</span>
    <span class=n>options</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>ChromeOptions</span><span class=p>()</span>
    <span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--headless&#39;</span><span class=p>)</span>
    <span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=n>options</span><span class=o>=</span><span class=n>options</span><span class=p>)</span>
    <span class=k>yield</span> <span class=n>driver</span>
    <span class=n>driver</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>


<span class=k>def</span> <span class=nf>test_baidu_index</span><span class=p>(</span><span class=n>chrome</span><span class=p>):</span>
    <span class=n>chrome</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://www.baidu.com&#39;</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>chrome</span><span class=o>.</span><span class=n>title</span> <span class=o>==</span> <span class=s1>&#39;ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“&#39;</span>
</code></pre></td></tr></table></div></div></div><p>é™¤äº†Seleniumä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªWebè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·åå«Robot Frameworkã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>nose2 -v -C
pytest --cov
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>Ran <span class=m>7</span> tests in 0.002s

OK
Name                       Stmts   Miss  Cover
----------------------------------------------
example01.py                  <span class=m>15</span>      <span class=m>0</span>   100%
example02.py                  <span class=m>49</span>     <span class=m>49</span>     0%
example03.py                  <span class=m>22</span>     <span class=m>22</span>     0%
example04.py                  <span class=m>61</span>     <span class=m>61</span>     0%
example05.py                  <span class=m>29</span>     <span class=m>29</span>     0%
example06.py                  <span class=m>39</span>     <span class=m>39</span>     0%
example07.py                  <span class=m>19</span>     <span class=m>19</span>     0%
example08.py                  <span class=m>27</span>     <span class=m>27</span>     0%
example09.py                  <span class=m>18</span>     <span class=m>18</span>     0%
example10.py                  <span class=m>19</span>     <span class=m>19</span>     0%
example11.py                  <span class=m>22</span>     <span class=m>22</span>     0%
example12.py                  <span class=m>28</span>     <span class=m>28</span>     0%
example13.py                  <span class=m>28</span>     <span class=m>28</span>     0%
test_ddt_example.py           <span class=m>18</span>      <span class=m>0</span>   100%
test_pytest_example.py        <span class=m>11</span>      <span class=m>6</span>    45%
test_unittest_example.py      <span class=m>22</span>      <span class=m>0</span>   100%
----------------------------------------------
TOTAL                        <span class=m>427</span>    <span class=m>367</span>    14%
</code></pre></td></tr></table></div></div></div><p>åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦å­¤ç«‹å„ç§å¤–éƒ¨ä¾èµ–ï¼ˆæ•°æ®åº“ã€å¤–éƒ¨æ¥å£è°ƒç”¨ã€æ—¶é—´ä¾èµ–ï¼‰ï¼Œå…·ä½“åˆåŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li><p>æ•°æ®æºï¼šæ•°æ®æœ¬åœ°åŒ– / ç½®äºå†…å­˜ä¸­ / æµ‹è¯•ä¹‹åå›æ»š</p></li><li><p>èµ„æºè™šæ‹ŸåŒ–ï¼šå­˜æ ¹/æ¡©ï¼ˆstubï¼‰ã€ä»¿åˆ¶/æ¨¡æ‹Ÿï¼ˆmockï¼‰ã€ä¼ªé€ ï¼ˆfakeï¼‰</p><ul><li>stubï¼šæµ‹è¯•æœŸé—´ä¸ºæä¾›å“åº”çš„å‡½æ•°ç”Ÿæˆçš„æ›¿ä»£å“</li><li>mockï¼šä»£æ›¿å®é™…å¯¹è±¡ï¼ˆä»¥åŠè¯¥å¯¹è±¡çš„APIï¼‰çš„å¯¹è±¡</li><li>fakeï¼šæ²¡æœ‰è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„è½»é‡çº§å¯¹è±¡</li></ul></li></ol><h4 id=é›†æˆæµ‹è¯•><a href=#é›†æˆæµ‹è¯• class=anchor-link>#</a>é›†æˆæµ‹è¯•</h4><p>é›†æˆå¤šä¸ªå‡½æ•°æˆ–æ–¹æ³•çš„è¾“å…¥è¾“å‡ºçš„æµ‹è¯•ï¼Œæµ‹è¯•æ—¶éœ€è¦å°†å¤šä¸ªæµ‹è¯•å¯¹è±¡ç»„åˆåœ¨ä¸€èµ·ã€‚</p><ul><li>æµ‹è¯•ç»„ä»¶äº’æ“ä½œæ€§ / éœ€æ±‚å˜æ›´æµ‹è¯• / å¤–éƒ¨ä¾èµ–å’ŒAPI / è°ƒè¯•ç¡¬ä»¶é—®é¢˜ / åœ¨ä»£ç è·¯å¾„ä¸­å‘ç°å¼‚å¸¸</li></ul><h4 id=ç³»ç»Ÿæµ‹è¯•><a href=#ç³»ç»Ÿæµ‹è¯• class=anchor-link>#</a>ç³»ç»Ÿæµ‹è¯•</h4><p>å¯¹éœ€æ±‚çš„æµ‹è¯•ï¼Œæµ‹è¯•æˆå“æ˜¯å¦æœ€ç»ˆæ»¡è¶³äº†æ‰€æœ‰éœ€æ±‚ï¼Œåœ¨å®¢æˆ·éªŒæ”¶é¡¹ç›®æ—¶è¿›è¡Œã€‚</p><h4 id=æ•°æ®é©±åŠ¨æµ‹è¯•><a href=#æ•°æ®é©±åŠ¨æµ‹è¯• class=anchor-link>#</a>æ•°æ®é©±åŠ¨æµ‹è¯•</h4><p>ä½¿ç”¨å¤–éƒ¨æ•°æ®æºå®ç°å¯¹è¾“å…¥å€¼ä¸æœŸæœ›å€¼çš„å‚æ•°åŒ–ï¼Œé¿å…åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ç¡¬ç¼–ç çš„æ•°æ®ã€‚</p><p>è¢«æµ‹å‡½æ•°ï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span>
</code></pre></td></tr></table></div></div></div><p>data.csvæ–‡ä»¶ï¼š</p><pre tabindex=0><code>3,1,2
0,1,-1
100,50,50
100,1,99
15,7,8
</code></pre><p>æµ‹è¯•ä»£ç ï¼š</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=kn>import</span> <span class=nn>csv</span>

<span class=kn>from</span> <span class=nn>unittest</span> <span class=kn>import</span> <span class=n>TestCase</span>
<span class=kn>from</span> <span class=nn>ddt</span> <span class=kn>import</span> <span class=n>ddt</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>unpack</span>


<span class=nd>@ddt</span>
<span class=k>class</span> <span class=nc>TestAdd</span><span class=p>(</span><span class=n>TestCase</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>load_data_from_csv</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
        <span class=n>data_items</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fs</span><span class=p>:</span>
            <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>reader</span><span class=p>(</span><span class=n>fs</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span><span class=p>:</span>
                <span class=n>data_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=n>row</span><span class=p>)))</span>
        <span class=k>return</span> <span class=n>data_items</span>


    <span class=nd>@data</span><span class=p>(</span><span class=o>*</span><span class=n>load_data_from_csv</span><span class=p>(</span><span class=s1>&#39;data.csv&#39;</span><span class=p>))</span>
    <span class=nd>@unpack</span>
    <span class=k>def</span> <span class=nf>test_add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>param1</span><span class=p>,</span> <span class=n>param2</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>add</span><span class=p>(</span><span class=n>param1</span><span class=p>,</span> <span class=n>param2</span><span class=p>))</span>
</code></pre></td></tr></table></div></div></div><h4 id=djangoä¸­çš„æµ‹è¯•><a href=#djangoä¸­çš„æµ‹è¯• class=anchor-link>#</a>Djangoä¸­çš„æµ‹è¯•</h4><ol><li>æµ‹è¯•Djangoè§†å›¾ - Djangoä¸­æä¾›çš„<code>TestCase</code>æ‰©å±•äº†<code>unittest</code>ä¸­çš„<code>TestCase</code>ï¼Œç»‘å®šäº†ä¸€ä¸ªåä¸º<code>client</code>çš„å±æ€§ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿæµè§ˆå™¨å‘å‡ºçš„GETã€POSTã€DELETEã€PUTç­‰è¯·æ±‚ã€‚</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>SomeViewTest</span><span class=p>(</span><span class=n>TestCase</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>test_example_view</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>resp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=n>resp</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>resp</span><span class=o>.</span><span class=n>context</span><span class=p>[</span><span class=s1>&#39;num&#39;</span><span class=p>])</span>
</code></pre></td></tr></table></div></div></div><ol start=2><li>è¿è¡Œæµ‹è¯• - é…ç½®æµ‹è¯•æ•°æ®åº“ã€‚</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>DATABASES</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;default&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;ENGINE&#39;</span><span class=p>:</span> <span class=s1>&#39;django.db.backends.mysql&#39;</span><span class=p>,</span>
        <span class=s1>&#39;HOST&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
        <span class=s1>&#39;PORT&#39;</span><span class=p>:</span> <span class=mi>3306</span><span class=p>,</span>
        <span class=s1>&#39;NAME&#39;</span><span class=p>:</span> <span class=s1>&#39;DbName&#39;</span><span class=p>,</span>
        <span class=s1>&#39;USER&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;DB_USER&#39;</span><span class=p>],</span>
        <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;DB_PASS&#39;</span><span class=p>],</span>
        <span class=s1>&#39;TEST&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;NAME&#39;</span><span class=p>:</span> <span class=s1>&#39;DbName_for_testing&#39;</span><span class=p>,</span>
            <span class=s1>&#39;CHARSET&#39;</span><span class=p>:</span> <span class=s1>&#39;utf8&#39;</span><span class=p>,</span>
        <span class=p>},</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>python manage.py <span class=nb>test</span>
python manage.py <span class=nb>test</span> common
python manage.py <span class=nb>test</span> common.tests.UtilsTest
python manage.py <span class=nb>test</span> common.tests.UtilsTest.test_to_md5_hex
</code></pre></td></tr></table></div></div></div><ol start=3><li>è¯„ä¼°æµ‹è¯•è¦†ç›–åº¦</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install coverage
coverage run --source<span class=o>=</span>&lt;path1&gt; --omit<span class=o>=</span>&lt;path2&gt; manage.py <span class=nb>test</span> common
coverage report

Name                            Stmts   Miss  Cover
---------------------------------------------------
common/__init__.py                  <span class=m>0</span>      <span class=m>0</span>   100%
common/admin.py                     <span class=m>1</span>      <span class=m>0</span>   100%
common/apps.py                      <span class=m>3</span>      <span class=m>3</span>     0%
common/forms.py                    <span class=m>16</span>     <span class=m>16</span>     0%
common/helper.py                   <span class=m>32</span>     <span class=m>32</span>     0%
common/middlewares.py              <span class=m>19</span>     <span class=m>19</span>     0%
common/migrations/__init__.py       <span class=m>0</span>      <span class=m>0</span>   100%
common/models.py                   <span class=m>71</span>      <span class=m>2</span>    97%
common/serializers.py              <span class=m>14</span>     <span class=m>14</span>     0%
common/tests.py                    <span class=m>14</span>      <span class=m>8</span>    43%
common/urls_api.py                  <span class=m>3</span>      <span class=m>3</span>     0%
common/urls_user.py                 <span class=m>3</span>      <span class=m>3</span>     0%
common/utils.py                    <span class=m>22</span>      <span class=m>7</span>    68%
common/views.py                    <span class=m>69</span>     <span class=m>69</span>     0%
---------------------------------------------------
TOTAL                             <span class=m>267</span>    <span class=m>176</span>    34%
</code></pre></td></tr></table></div></div></div><h4 id=æ€§èƒ½æµ‹è¯•-1><a href=#æ€§èƒ½æµ‹è¯•-1 class=anchor-link>#</a>æ€§èƒ½æµ‹è¯•</h4><p>é—®é¢˜1ï¼šæ€§èƒ½æµ‹è¯•çš„æŒ‡æ ‡æœ‰å“ªäº›ï¼Ÿ</p><ol><li><p>abï¼ˆ Apache Benchmarkï¼‰ / webbench / httpperf</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>yum -y install httpd
ab -c <span class=m>10</span> -n <span class=m>1000</span> http://www.baidu.com/
...
Benchmarking www.baidu.com <span class=o>(</span>be patient<span class=o>)</span>.....done
Server Software:        BWS/1.1
Server Hostname:        www.baidu.com
Server Port:            <span class=m>80</span>
Document Path:          /
Document Length:        <span class=m>118005</span> bytes
Concurrency Level:      <span class=m>10</span>
Time taken <span class=k>for</span> tests:   0.397 seconds
Complete requests:      <span class=m>100</span>
Failed requests:        <span class=m>98</span>
   <span class=o>(</span>Connect: 0, Receive: 0, Length: 98, Exceptions: 0<span class=o>)</span>
Write errors:           <span class=m>0</span>
Total transferred:      <span class=m>11918306</span> bytes
HTML transferred:       <span class=m>11823480</span> bytes
Requests per second:    252.05 <span class=o>[</span><span class=c1>#/sec] (mean)</span>
Time per request:       39.675 <span class=o>[</span>ms<span class=o>]</span> <span class=o>(</span>mean<span class=o>)</span>
Time per request:       3.967 <span class=o>[</span>ms<span class=o>]</span> <span class=o>(</span>mean, across all concurrent requests<span class=o>)</span>
Transfer rate:          29335.93 <span class=o>[</span>Kbytes/sec<span class=o>]</span> received
Connection Times <span class=o>(</span>ms<span class=o>)</span>
              min  mean<span class=o>[</span>+/-sd<span class=o>]</span> median   max
Connect:        <span class=m>6</span>    <span class=m>7</span>   0.6      <span class=m>7</span>       <span class=m>9</span>
Processing:    <span class=m>20</span>   <span class=m>27</span>  22.7     <span class=m>24</span>     <span class=m>250</span>
Waiting:        <span class=m>8</span>   <span class=m>11</span>  21.7      <span class=m>9</span>     <span class=m>226</span>
Total:         <span class=m>26</span>   <span class=m>34</span>  22.8     <span class=m>32</span>     <span class=m>258</span>
Percentage of the requests served within a certain <span class=nb>time</span> <span class=o>(</span>ms<span class=o>)</span>
  50%     <span class=m>32</span>
  66%     <span class=m>34</span>
  75%     <span class=m>34</span>
  80%     <span class=m>34</span>
  90%     <span class=m>36</span>
  95%     <span class=m>39</span>
  98%     <span class=m>51</span>
  99%    <span class=m>258</span>
 100%    <span class=m>258</span> <span class=o>(</span>longest request<span class=o>)</span>
</code></pre></td></tr></table></div></div></div></li><li><p>mysqlslap</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>mysqlslap -a -c <span class=m>100</span> -h 1.2.3.4 -u root -p
mysqlslap -a -c <span class=m>100</span> --number-of-queries<span class=o>=</span><span class=m>1000</span> --auto-generate-sql-load-type<span class=o>=</span><span class=nb>read</span> -h &lt;è´Ÿè½½å‡è¡¡æœåŠ¡å™¨IPåœ°å€&gt; -u root -p
mysqlslap -a --concurrency<span class=o>=</span>50,100 --number-of-queries<span class=o>=</span><span class=m>1000</span> --debug-info --auto-generate-sql-load-type<span class=o>=</span>mixed -h 1.2.3.4 -u root -p
</code></pre></td></tr></table></div></div></div></li><li><p>sysbench</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>sysbench --test<span class=o>=</span>threads --num-threads<span class=o>=</span><span class=m>64</span> --thread-yields<span class=o>=</span><span class=m>100</span> --thread-locks<span class=o>=</span><span class=m>2</span> run
sysbench --test<span class=o>=</span>memory --num-threads<span class=o>=</span><span class=m>512</span> --memory-block-size<span class=o>=</span>256M --memory-total-size<span class=o>=</span>32G run
</code></pre></td></tr></table></div></div></div></li><li><p>JMeter</p><p>è¯·æŸ¥çœ‹<a href=https://www.ibm.com/developerworks/cn/java/l-jmeter/index.html target=_blank rel=noopener>ã€Šä½¿ç”¨JMeterè¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‹</a>ã€‚</p></li><li><p>LoadRunner / QTP</p></li></ol><h3 id=é¡¹ç›®è°ƒè¯•><a href=#é¡¹ç›®è°ƒè¯• class=anchor-link>#</a>é¡¹ç›®è°ƒè¯•</h3><p>å¯ä»¥ä½¿ç”¨django-debug-toolbaræ¥è¾…åŠ©é¡¹ç›®è°ƒè¯•ã€‚</p><ol><li><p>å®‰è£…</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell>pip install django-debug-toolbar
</code></pre></td></tr></table></div></div></div></li><li><p>é…ç½® - ä¿®æ”¹settings.pyã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;debug_toolbar&#39;</span><span class=p>,</span>
<span class=p>]</span>

<span class=n>MIDDLEWARE</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span><span class=p>,</span>
<span class=p>]</span>

<span class=n>DEBUG_TOOLBAR_CONFIG</span> <span class=o>=</span> <span class=p>{</span>
    <span class=c1># å¼•å…¥jQueryåº“</span>
    <span class=s1>&#39;JQUERY_URL&#39;</span><span class=p>:</span> <span class=s1>&#39;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&#39;</span><span class=p>,</span>
    <span class=c1># å·¥å…·æ æ˜¯å¦æŠ˜å </span>
    <span class=s1>&#39;SHOW_COLLAPSED&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
    <span class=c1># æ˜¯å¦æ˜¾ç¤ºå·¥å…·æ </span>
    <span class=s1>&#39;SHOW_TOOLBAR_CALLBACK&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div></li><li><p>é…ç½® - ä¿®æ”¹urls.pyã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>:</span>

    <span class=kn>import</span> <span class=nn>debug_toolbar</span>

    <span class=n>urlpatterns</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>path</span><span class=p>(</span><span class=s1>&#39;__debug__/&#39;</span><span class=p>,</span> <span class=n>include</span><span class=p>(</span><span class=n>debug_toolbar</span><span class=o>.</span><span class=n>urls</span><span class=p>)))</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨ - åœ¨é¡µé¢å³ä¾§å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè°ƒè¯•å·¥å…·æ ï¼Œä¸Šé¢åŒ…æ‹¬äº†æ‰§è¡Œæ—¶é—´ã€é¡¹ç›®è®¾ç½®ã€è¯·æ±‚å¤´ã€SQLã€é™æ€èµ„æºã€æ¨¡æ¿ã€ç¼“å­˜ã€ä¿¡å·ç­‰è°ƒè¯•ä¿¡æ¯ï¼ŒæŸ¥çœ‹èµ·æ¥éå¸¸çš„æ–¹ä¾¿ã€‚</p></li><li><p>é¡¹ç›®ä¸Šçº¿ä¹‹å‰ï¼Œè¯·è®°ä½<strong>å»æ‰django-debug-toolbarç›¸å…³çš„æ‰€æœ‰é…ç½®</strong>ã€‚</p></li></ol><h3 id=éƒ¨ç½²ç›¸å…³><a href=#éƒ¨ç½²ç›¸å…³ class=anchor-link>#</a>éƒ¨ç½²ç›¸å…³</h3><p>è¯·å‚è€ƒ<a href=98.%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF%E5%92%8C%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98.md>ã€Šé¡¹ç›®éƒ¨ç½²ä¸Šçº¿å’Œæ€§èƒ½è°ƒä¼˜ã€‹</a>ã€‚</p><h3 id=æ€§èƒ½ç›¸å…³><a href=#æ€§èƒ½ç›¸å…³ class=anchor-link>#</a>æ€§èƒ½ç›¸å…³</h3><h4 id=ç½‘ç«™ä¼˜åŒ–ä¸¤å¤§å®šå¾‹><a href=#ç½‘ç«™ä¼˜åŒ–ä¸¤å¤§å®šå¾‹ class=anchor-link>#</a>ç½‘ç«™ä¼˜åŒ–ä¸¤å¤§å®šå¾‹ï¼š</h4><ol><li><p>å°½å¯èƒ½çš„ä½¿ç”¨ç¼“å­˜ - ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´ï¼ˆæ™®é€‚ç­–ç•¥ï¼‰ã€‚</p></li><li><p>èƒ½æ¨è¿Ÿçš„éƒ½æ¨è¿Ÿ - ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å°†å¹¶è¡Œä»»åŠ¡ä¸²è¡Œæ¥ç¼“è§£æœåŠ¡å™¨å‹åŠ›ã€‚</p><ul><li>æœåŠ¡å™¨CPUåˆ©ç”¨ç‡å‡ºç°ç¬æ—¶å³°å€¼ - å‰Šå³°ï¼ˆCPUåˆ©ç”¨ç‡å¹³ç¼“çš„å¢é•¿ï¼‰</li><li>ä¸Šä¸‹æ¸¸èŠ‚ç‚¹è§£è€¦åˆï¼ˆä¸‹è®¢å•å’Œå—ç†è®¢å•çš„ç³»ç»Ÿé€šå¸¸æ˜¯åˆ†ç¦»çš„ï¼‰</li></ul></li></ol><h4 id=djangoæ¡†æ¶><a href=#djangoæ¡†æ¶ class=anchor-link>#</a>Djangoæ¡†æ¶</h4><ol><li><p>é…ç½®ç¼“å­˜æ¥ç¼“è§£æ•°æ®åº“çš„å‹åŠ›ï¼Œå¹¶æœ‰åˆç†çš„æœºåˆ¶åº”å¯¹<a href=https://www.cnblogs.com/zhangweizhong/p/6258797.html target=_blank rel=noopener>ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©</a>ã€‚</p></li><li><p>å¼€å¯<a href=https://docs.djangoproject.com/en/2.0/ref/templates/api/#django.template.loaders.cached.Loader target=_blank rel=noopener>æ¨¡æ¿ç¼“å­˜</a>æ¥åŠ é€Ÿæ¨¡æ¿çš„æ¸²æŸ“ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=n>TEMPLATES</span> <span class=o>=</span> <span class=p>[</span>
    <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class=p>,</span>
        <span class=s1>&#39;DIRS&#39;</span><span class=p>:</span> <span class=p>[</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>BASE_DIR</span><span class=p>,</span> <span class=s1>&#39;templates&#39;</span><span class=p>),</span> <span class=p>],</span>
        <span class=c1># &#39;APP_DIRS&#39;: True,</span>
        <span class=s1>&#39;OPTIONS&#39;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s1>&#39;context_processors&#39;</span><span class=p>:</span> <span class=p>[</span>
                <span class=s1>&#39;django.template.context_processors.debug&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.template.context_processors.request&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.contrib.auth.context_processors.auth&#39;</span><span class=p>,</span>
                <span class=s1>&#39;django.contrib.messages.context_processors.messages&#39;</span><span class=p>,</span>
            <span class=p>],</span>
            <span class=s1>&#39;loaders&#39;</span><span class=p>:</span> <span class=p>[(</span>
                <span class=s1>&#39;django.template.loaders.cached.Loader&#39;</span><span class=p>,</span> <span class=p>[</span>
                    <span class=s1>&#39;django.template.loaders.filesystem.Loader&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;django.template.loaders.app_directories.Loader&#39;</span><span class=p>,</span>
                <span class=p>],</span> <span class=p>),</span>
            <span class=p>],</span>
        <span class=p>},</span>
    <span class=p>},</span>
<span class=p>]</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ç”¨æƒ°æ€§æ±‚å€¼ã€è¿­ä»£å™¨ã€<code>defer()</code>ã€<code>only()</code>ç­‰ç¼“è§£å†…å­˜å‹åŠ›ã€‚</p></li><li><p>ç”¨<code>select_related()</code>å’Œ<code>prefetch_related()</code>æ‰§è¡Œé¢„åŠ è½½é¿å…â€œ1+NæŸ¥è¯¢é—®é¢˜â€ã€‚</p></li></ol><h4 id=æ•°æ®åº“><a href=#æ•°æ®åº“ class=anchor-link>#</a>æ•°æ®åº“</h4><ol><li><p>ç”¨IDç”Ÿæˆå™¨ä»£æ›¿è‡ªå¢ä¸»é”®ï¼ˆæ€§èƒ½æ›´å¥½ã€é€‚ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒï¼‰ã€‚</p><ul><li><p>è‡ªå®šä¹‰IDç”Ÿæˆå™¨ - snowflake</p></li><li><p>UUID</p></li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=n>my_uuid</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid1</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_uuid</span>
<span class=n>UUID</span><span class=p>(</span><span class=s1>&#39;63f859d0-a03a-11e8-b0ad-60f81da8d840&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>my_uuid</span><span class=o>.</span><span class=n>hex</span>
<span class=s1>&#39;63f859d0a03a11e8b0ad60f81da8d840&#39;</span>
</code></pre></td></tr></table></div></div></div></li><li><p>é¿å…ä¸å¿…è¦çš„å¤–é”®åˆ—ä¸Šçš„çº¦æŸï¼ˆé™¤éå¿…é¡»ä¿è¯å‚ç…§å®Œæ•´æ€§ï¼‰ï¼Œæ›´ä¸è¦ä½¿ç”¨è§¦å‘å™¨ä¹‹ç±»çš„æœºåˆ¶ã€‚</p></li><li><p>ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼ˆç´¢å¼•æ”¾åœ¨è¦ç”¨äºæŸ¥è¯¢çš„å­—æ®µä¸Šï¼‰ã€‚InnoDBç”¨çš„æ˜¯BTREEç´¢å¼•ï¼Œä½¿ç”¨>ã€&lt;ã€>=ã€&lt;=ã€BETWEENæˆ–è€…LIKE 'pattern'ï¼ˆpatternä¸ä»¥é€šé…ç¬¦å¼€å¤´ï¼‰æ—¶éƒ½å¯ä»¥ç”¨åˆ°ç´¢å¼•ã€‚å› ä¸ºå»ºç«‹ç´¢å¼•éœ€è¦é¢å¤–çš„ç£ç›˜ç©ºé—´ï¼Œè€Œä¸»é”®ä¸Šæ˜¯æœ‰é»˜è®¤çš„ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®è¦å°½å¯èƒ½é€‰æ‹©è¾ƒçŸ­çš„æ•°æ®ç±»å‹æ¥å‡å°‘ç£ç›˜å ç”¨ï¼Œæé«˜ç´¢å¼•çš„ç¼“å­˜æ•ˆæœã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=k>create</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=n>idx_goods_name</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>tb_goods</span><span class=w> </span><span class=p>(</span><span class=n>gname</span><span class=p>(</span><span class=mi>10</span><span class=p>));</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=c1>-- æ— æ³•ä½¿ç”¨ç´¢å¼•
</span><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_goods</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>gname</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;%iPhone%&#39;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=c1>-- å¯ä»¥ä½¿ç”¨ç´¢å¼•
</span><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_goods</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>gname</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;iPhone%&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=c1># æ— æ³•ä½¿ç”¨ç´¢å¼•</span>
<span class=n>Goods</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_icontains</span><span class=o>=</span><span class=s1>&#39;iPhone&#39;</span><span class=p>)</span>
<span class=c1># å¯ä»¥ä½¿ç”¨ç´¢å¼•</span>
<span class=n>Goods</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name__istartswith</span><span class=o>=</span><span class=s1>&#39;iPhone&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼ˆå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ç¼–è¯‘è¿‡çš„ä¸€ç»„SQLè¯­å¥ï¼‰ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=k>drop</span><span class=w> </span><span class=k>procedure</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sp_avg_sal_by_dept</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>procedure</span><span class=w> </span><span class=n>sp_avg_sal_by_dept</span><span class=p>(</span><span class=n>deptno</span><span class=w> </span><span class=nb>integer</span><span class=p>,</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>avg_sal</span><span class=w> </span><span class=nb>float</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>begin</span><span class=w> 
</span><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>sal</span><span class=p>)</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>avg_sal</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>TbEmp</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>dno</span><span class=o>=</span><span class=n>deptno</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>end</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>call</span><span class=w> </span><span class=n>sp_avg_sal_by_dept</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connection</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cursor</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cursor</span><span class=o>.</span><span class=n>callproc</span><span class=p>(</span><span class=s1>&#39;sp_avg_sal_by_dept&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;select @_sp_avg_sal_by_dept_1&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
<span class=p>(</span><span class=mf>2675.0</span><span class=p>,)</span>
</code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨æ•°æ®åˆ†åŒºã€‚é€šè¿‡åˆ†åŒºå¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€ä¼˜åŒ–æŸ¥è¯¢æ›´å¤§çš„ååé‡ã€å¯ä»¥å¿«é€Ÿåˆ é™¤è¿‡æœŸçš„æ•°æ®ã€‚å…³äºè¿™ä¸ªçŸ¥è¯†ç‚¹å¯ä»¥çœ‹çœ‹MySQLçš„<a href=https://dev.mysql.com/doc/refman/5.7/en/partitioning-overview.html target=_blank rel=noopener>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><ul><li>RANGEåˆ†åŒºï¼šåŸºäºè¿ç»­åŒºé—´èŒƒå›´ï¼ŒæŠŠæ•°æ®åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºã€‚</li><li>LISTåˆ†åŒºï¼šåŸºäºæšä¸¾å€¼çš„èŒƒå›´ï¼ŒæŠŠæ•°æ®åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºã€‚</li><li>HASHåˆ†åŒº / KEYåˆ†åŒºï¼šåŸºäºåˆ†åŒºä¸ªæ•°ï¼ŒæŠŠæ•°æ®åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºã€‚</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>tb_emp</span><span class=w> </span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=n>eno</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>ename</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>job</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>hiredate</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>dno</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span><span class=w></span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>HASH</span><span class=p>(</span><span class=n>dno</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=n>PARTITIONS</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>tb_emp</span><span class=w> </span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=n>eno</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>ename</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>job</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>hiredate</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>dno</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span><span class=w></span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>RANGE</span><span class=p>(</span><span class=w> </span><span class=k>YEAR</span><span class=p>(</span><span class=n>hiredate</span><span class=p>)</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p0</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=mi>1960</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p1</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=mi>1970</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p2</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=mi>1980</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p3</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=p>(</span><span class=mi>1990</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>PARTITION</span><span class=w> </span><span class=n>p4</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>LESS</span><span class=w> </span><span class=k>THAN</span><span class=w> </span><span class=k>MAXVALUE</span><span class=w>
</span><span class=w></span><span class=p>);</span><span class=w>
</span></code></pre></td></tr></table></div></div></div></li><li><p>ä½¿ç”¨<code>explain</code>æ¥åˆ†ææŸ¥è¯¢æ€§èƒ½ - æ‰§è¡Œè®¡åˆ’ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=k>explain</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>...;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><p><code>explain</code>ç»“æœè§£æï¼š</p><ul><li>select_typeï¼šè¡¨ç¤ºselectæ“ä½œçš„ç±»å‹ï¼Œå¸¸è§çš„å€¼æœ‰SIMPLEï¼ˆç®€å•æŸ¥è¯¢ï¼Œæ²¡æœ‰ä½¿ç”¨å­æŸ¥è¯¢æˆ–è€…è¡¨è¿æ¥æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆå¹¶é›†æ“ä½œä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢ï¼‰ã€SUBQUERYï¼ˆå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECTï¼‰ç­‰ã€‚</li><li>tableï¼šè¾“å‡ºç»“æœçš„è¡¨ã€‚</li><li>typeï¼šMySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œä¹Ÿç§°ä¸ºè®¿é—®ç±»å‹ï¼Œå¸¸è§çš„å€¼æœ‰ï¼š<ul><li>ALLï¼šå…¨è¡¨æ‰«æï¼ˆéå†å…¨è¡¨æ‰¾åˆ°åŒ¹é…çš„è¡Œï¼‰</li><li>indexï¼šç´¢å¼•å…¨æ‰«æï¼ˆéå†æ•´ä¸ªç´¢å¼•ï¼‰</li><li>rangeï¼šç´¢å¼•èŒƒå›´æ‰«æ</li><li>refï¼šéå”¯ä¸€ç´¢å¼•æ‰«ææˆ–å”¯ä¸€ç´¢å¼•çš„å‰ç¼€æ‰«æ</li><li>eq_refï¼šå”¯ä¸€ç´¢å¼•æ‰«æ</li><li>const / systemï¼šè¡¨ä¸­æœ€å¤šæœ‰ä¸€è¡ŒåŒ¹é…</li><li>NULLï¼šä¸ç”¨è®¿é—®è¡¨æˆ–è€…ç´¢å¼•</li></ul></li><li>possible_keysï¼šæŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ã€‚</li><li>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚</li><li>key_lenï¼šä½¿ç”¨åˆ°ç´¢å¼•å­—æ®µçš„é•¿åº¦ã€‚</li><li>rowsï¼šæ‰«æè¡Œçš„æ•°é‡ã€‚</li><li>Extraï¼šé¢å¤–çš„ä¿¡æ¯ï¼ˆæ‰§è¡Œæƒ…å†µçš„è¯´æ˜æˆ–æè¿°ï¼‰ã€‚</li></ul><blockquote><p>è¯´æ˜ï¼šå…³äºMySQLæ›´å¤šçš„çŸ¥è¯†å°¤å…¶æ˜¯æ€§èƒ½è°ƒä¼˜å’Œè¿ç»´æ–¹é¢çš„å†…å®¹ï¼Œæ¨èå¤§å®¶é˜…è¯»ç½‘æ˜“å‡ºå“çš„ã€Šæ·±å…¥æµ…å‡ºMySQLï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ï¼Œç½‘æ˜“å‡ºå“å¿…å±ç²¾å“ã€‚</p></blockquote></li><li><p>ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—æ¥å‘ç°æ€§èƒ½ä½ä¸‹çš„æŸ¥è¯¢ã€‚</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;slow_query%&#39;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------------------------------+
</span><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>                            </span><span class=o>|</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------------------------------+
</span><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>slow_query_log</span><span class=w>            </span><span class=o>|</span><span class=w> </span><span class=k>OFF</span><span class=w>                              </span><span class=o>|</span><span class=w>
</span><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>slow_query_log_file</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=o>/</span><span class=n>mysql</span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=n>localhost</span><span class=o>-</span><span class=n>slow</span><span class=p>.</span><span class=n>log</span><span class=w>   </span><span class=o>|</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------------------------------+
</span><span class=c1></span><span class=w>
</span><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;long_query_time&#39;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>-----------------+-----------+
</span><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>     </span><span class=o>|</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>-----------------+-----------+
</span><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>long_query_time</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>000000</span><span class=w> </span><span class=o>|</span><span class=w>
</span><span class=w></span><span class=o>+</span><span class=c1>-----------------+-----------+
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>slow_query_log</span><span class=o>=</span><span class=s1>&#39;ON&#39;</span><span class=p>;</span><span class=w> 
</span><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>long_query_time</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-INI data-lang=INI><span class=k>[mysqld]</span>
<span class=na>slow_query_log</span><span class=o>=</span><span class=s>ON</span>
<span class=na>slow_query_log_file</span><span class=o>=</span><span class=s>/usr/local/mysql/data/slow.log</span>
<span class=na>long_query_time</span><span class=o>=</span><span class=s>1</span>
</code></pre></td></tr></table></div></div></div></li></ol></div><ul class=post-copyright><li class="copyright-item author"><span class=copyright-item-text>ä½œè€…</span>ï¼š<span class="p-author h-card">éª†æ˜Š</span></li><li class="copyright-item link"><span class=copyright-item-text>é“¾æ¥</span>ï¼š<a href=https://github.com/jackfrued/Python-100-Days target=_blank rel=noopener>https://github.com/jackfrued/Python-100-Days</a></li><li class="copyright-item license"><span class=copyright-item-text>è®¸å¯</span>ï¼šæœ¬æ–‡é‡‡ç”¨<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>ã€ŒCC BY-NC-SA 4.0ã€</a>åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</li></ul></article><div class=related-posts><h2 class=related-title>ç›¸å…³æ–‡ç« ï¼š<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/python/01.%E5%88%9D%E8%AF%86python/ class=related-link>01.åˆè¯†Python</a></li><li class=related-item><a href=/python/02.%E8%AF%AD%E8%A8%80%E5%85%83%E7%B4%A0/ class=related-link>02.è¯­è¨€å…ƒç´ </a></li><li class=related-item><a href=/python/03.%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84/ class=related-link>03.åˆ†æ”¯ç»“æ„</a></li><li class=related-item><a href=/python/04.%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/ class=related-link>04.å¾ªç¯ç»“æ„</a></li><li class=related-item><a href=/python/05.%E6%9E%84%E9%80%A0%E7%A8%8B%E5%BA%8F%E9%80%BB%E8%BE%91/ class=related-link>05.æ„é€ ç¨‹åºé€»è¾‘</a></li></ul></div><div class=post-tags><a href=/tags/python/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>python</a></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>Â©&nbsp;2021â€“2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;hanxin</div><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script>
<text class=poem_sentence></text>
<text class=poem_info></text>
<script type=text/javascript>jinrishici.load(function(a){var b=document.querySelector(".poem_sentence"),c=document.querySelector(".poem_info");b.innerHTML=a.data.content,c.innerHTML='â€”â€”'+a.data.origin.author})</script></div></footer></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll('div.post-body img'),{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script></body></html>